!function(t){"function"==typeof define&&define.amd?define(t):t()}(function(){"use strict";var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function t(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function l(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}function e(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function i(t,e){return t(e={exports:{}},e.exports),e.exports}function a(t){if(null==t)throw TypeError("Can't call method on  "+t);return t}function p(t){return Object(a(t))}function m(t,e){return E.call(t,e)}function o(t){return k.call(t).slice(8,-1)}function h(t){return U(a(t))}function c(t){return isNaN(t=+t)?0:(0<t?x:A)(t)}function u(t){return"Symbol(".concat(void 0===t?"":t,")_",(++M+O).toString(36))}function s(t){return R[t]||(R[t]=u(t))}function d(t,e){var i,n=h(t),r=0,o=[];for(i in n)i!=V&&m(n,i)&&o.push(i);for(;e.length>r;)m(n,i=e[r++])&&(~F(o,i)||o.push(i));return o}function g(n,r,t){if(!function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!")}(n),void 0===r)return n;switch(t){case 1:return function(t){return n.call(r,t)};case 2:return function(t,e){return n.call(r,t,e)};case 3:return function(t,e,i){return n.call(r,t,e,i)}}return function(){return n.apply(r,arguments)}}function f(t){return"object"==typeof t?null!==t:"function"==typeof t}function y(t){if(!f(t))throw TypeError(t+" is not an object!");return t}function b(t){try{return!!t()}catch(t){return!0}}function _(t){return H?G.createElement(t):{}}function S(t,e){if(!f(t))return t;var i,n;if(e&&"function"==typeof(i=t.toString)&&!f(n=i.call(t)))return n;if("function"==typeof(i=t.valueOf)&&!f(n=i.call(t)))return n;if(!e&&"function"==typeof(i=t.toString)&&!f(n=i.call(t)))return n;throw TypeError("Can't convert object to primitive value")}function w(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}var T,E={}.hasOwnProperty,k={}.toString,U=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==o(t)?t.split(""):Object(t)},A=Math.ceil,x=Math.floor,C=Math.min,L=Math.max,D=Math.min,B=i(function(t){var e=t.exports={version:"2.6.11"};"number"==typeof __e&&(__e=e)}),I=(B.version,i(function(t){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)})),P=i(function(t){var e="__core-js_shared__",i=I[e]||(I[e]={});(t.exports=function(t,e){return i[t]||(i[t]=void 0!==e?e:{})})("versions",[]).push({version:B.version,mode:"pure",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})}),M=0,O=Math.random(),R=P("keys"),F=(T=!1,function(t,e,i){var n,r,o,s,a=h(t),u=0<(n=a.length)?C(c(n),9007199254740991):0,d=(o=u,(r=c(r=i))<0?L(r+o,0):D(r,o));if(T&&e!=e){for(;d<u;)if((s=a[d++])!=s)return!0}else for(;d<u;d++)if((T||d in a)&&a[d]===e)return T||d||0;return!T&&-1}),V=s("IE_PROTO"),j="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),N=Object.keys||function(t){return d(t,j)},z=!b(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),G=I.document,H=f(G)&&f(G.createElement),q=!z&&!b(function(){return 7!=Object.defineProperty(_("div"),"a",{get:function(){return 7}}).a}),X=Object.defineProperty,W={f:z?Object.defineProperty:function(t,e,i){if(y(t),e=S(e,!0),y(i),q)try{return X(t,e,i)}catch(t){}if("get"in i||"set"in i)throw TypeError("Accessors not supported!");return"value"in i&&(t[e]=i.value),t}},Y=z?function(t,e,i){return W.f(t,e,w(1,i))}:function(t,e,i){return t[e]=i,t},K="prototype",$=function(t,e,i){var n,r,o,s=t&$.F,a=t&$.G,u=t&$.S,d=t&$.P,h=t&$.B,l=t&$.W,p=a?B:B[e]||(B[e]={}),c=p[K],f=a?I:u?I[e]:(I[e]||{})[K];for(n in a&&(i=e),i)(r=!s&&f&&void 0!==f[n])&&m(p,n)||(o=r?f[n]:i[n],p[n]=a&&"function"!=typeof f[n]?i[n]:h&&r?g(o,I):l&&f[n]==o?function(n){function t(t,e,i){if(this instanceof n){switch(arguments.length){case 0:return new n;case 1:return new n(t);case 2:return new n(t,e)}return new n(t,e,i)}return n.apply(this,arguments)}return t[K]=n[K],t}(o):d&&"function"==typeof o?g(Function.call,o):o,d&&((p.virtual||(p.virtual={}))[n]=o,t&$.R&&c&&!c[n]&&Y(c,n,o)))};$.F=1,$.G=2,$.S=4,$.P=8,$.B=16,$.W=32,$.U=64,$.R=128;function J(t,e){var i=(B.Object||{})[t]||Object[t],n={};n[t]=e(i),Z(Z.S+Z.F*b(function(){i(1)}),"Object",n)}var Z=$;J("keys",function(){return function(t){return N(p(t))}});function Q(){}function tt(t,e,i){t&&!m(t=i?t:t.prototype,ct)&&pt(t,ct,{configurable:!0,value:e})}var et=B.Object.keys,it=e(i(function(t){t.exports={default:et,__esModule:!0}})),nt=Y,rt=z?Object.defineProperties:function(t,e){y(t);for(var i,n=N(e),r=n.length,o=0;o<r;)W.f(t,i=n[o++],e[i]);return t},ot=I.document,st=ot&&ot.documentElement,at=s("IE_PROTO"),ut="prototype",dt=function(){var t,e=_("iframe"),i=j.length;for(e.style.display="none",st.appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),dt=t.F;i--;)delete dt[ut][j[i]];return dt()},ht=Object.create||function(t,e){var i;return null!==t?(Q[ut]=y(t),i=new Q,Q[ut]=null,i[at]=t):i=dt(),void 0===e?i:rt(i,e)},lt=i(function(t){var e=P("wks"),i=I.Symbol,n="function"==typeof i;(t.exports=function(t){return e[t]||(e[t]=n&&i[t]||(n?i:u)("Symbol."+t))}).store=e}),pt=W.f,ct=lt("toStringTag"),ft={};Y(ft,lt("iterator"),function(){return this});function mt(t,e,i,n,r,o,s){var a,u,d;function h(t){if(!St&&t in y)return y[t];switch(t){case"keys":case wt:return function(){return new i(this,t)}}return function(){return new i(this,t)}}u=e,d=n,(a=i).prototype=ht(ft,{next:w(1,d)}),tt(a,u+" Iterator");var l,p,c,f=e+" Iterator",m=r==wt,g=!1,y=t.prototype,v=y[_t]||y["@@iterator"]||r&&y[r],b=v||h(r),_=r?m?h("entries"):b:void 0,S="Array"==e&&y.entries||v;if(S&&(c=bt(S.call(new t)))!==Object.prototype&&c.next&&tt(c,f,!0),m&&v&&v.name!==wt&&(g=!0,b=function(){return v.call(this)}),s&&(St||g||!y[_t])&&Y(y,_t,b),r)if(l={values:m?b:h(wt),keys:o?b:h("keys"),entries:_},s)for(p in l)p in y||nt(y,p,l[p]);else Z(Z.P+Z.F*(St||g),e,l);return l}var gt,yt=s("IE_PROTO"),vt=Object.prototype,bt=Object.getPrototypeOf||function(t){return t=p(t),m(t,yt)?t[yt]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?vt:null},_t=lt("iterator"),St=!([].keys&&"next"in[].keys()),wt="values",Tt=(gt=!0,function(t,e){var i,n,r=String(a(t)),o=c(e),s=r.length;return o<0||s<=o?gt?"":void 0:(i=r.charCodeAt(o))<55296||56319<i||o+1===s||(n=r.charCodeAt(o+1))<56320||57343<n?gt?r.charAt(o):i:gt?r.slice(o,o+2):n-56320+(i-55296<<10)+65536});mt(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,e=this._t,i=this._i;return i>=e.length?{value:void 0,done:!0}:(t=Tt(e,i),this._i+=t.length,{value:t,done:!1})});for(var Et=function(t,e){return{value:e,done:!!t}},kt=(mt(Array,"Array",function(t,e){this._t=h(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,i=this._i++;return!t||i>=t.length?(this._t=void 0,Et(1)):Et(0,"keys"==e?i:"values"==e?t[i]:[i,t[i]])},"values"),lt("toStringTag")),Ut="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),At=0;At<Ut.length;At++){var xt=Ut[At],Ct=I[xt],Lt=Ct&&Ct.prototype;Lt&&!Lt[kt]&&Y(Lt,kt,xt)}var Dt={f:lt},Bt=Dt.f("iterator"),It=i(function(t){t.exports={default:Bt,__esModule:!0}});e(It);function Pt(t){var e=B.Symbol||(B.Symbol={});"_"==t.charAt(0)||t in e||zt(e,t,{value:Dt.f(t)})}function Mt(t){var e=pe[t]=ht(re[ae]);return e._k=t,e}function Ot(t,e){y(t);for(var i,n=function(t){var e=N(t),i=Gt.f;if(i)for(var n,r=i(t),o=Ht.f,s=0;r.length>s;)o.call(t,n=r[s++])&&e.push(n);return e}(e=h(e)),r=0,o=n.length;r<o;)_e(t,i=n[r++],e[i]);return t}function Rt(t){var e=he.call(this,t=S(t,!0));return!(this===fe&&m(pe,t)&&!m(ce,t))&&(!(e||!m(this,t)||!m(pe,t)||m(this,ue)&&this[ue][t])||e)}function Ft(t,e){if(t=h(t),e=S(e,!0),t!==fe||!m(pe,e)||m(ce,e)){var i=ee(t,e);return!i||!m(pe,e)||m(t,ue)&&t[ue][e]||(i.enumerable=!0),i}}function Vt(t){for(var e,i=ne(h(t)),n=[],r=0;i.length>r;)m(pe,e=i[r++])||e==ue||e==te||n.push(e);return n}function jt(t){for(var e,i=t===fe,n=ne(i?ce:h(t)),r=[],o=0;n.length>o;)!m(pe,e=n[o++])||i&&!m(fe,e)||r.push(pe[e]);return r}var Nt=i(function(t){function i(t){e(t,n,{value:{i:"O"+ ++r,w:{}}})}var n=u("meta"),e=W.f,r=0,o=Object.isExtensible||function(){return!0},s=!b(function(){return o(Object.preventExtensions({}))}),a=t.exports={KEY:n,NEED:!1,fastKey:function(t,e){if(!f(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!m(t,n)){if(!o(t))return"F";if(!e)return"E";i(t)}return t[n].i},getWeak:function(t,e){if(!m(t,n)){if(!o(t))return!0;if(!e)return!1;i(t)}return t[n].w},onFreeze:function(t){return s&&a.NEED&&o(t)&&!m(t,n)&&i(t),t}}}),zt=(Nt.KEY,Nt.NEED,Nt.fastKey,Nt.getWeak,Nt.onFreeze,W.f),Gt={f:Object.getOwnPropertySymbols},Ht={f:{}.propertyIsEnumerable},qt=Array.isArray||function(t){return"Array"==o(t)},Xt=j.concat("length","prototype"),Wt={f:Object.getOwnPropertyNames||function(t){return d(t,Xt)}},Yt=Wt.f,Kt={}.toString,$t="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Jt={f:function(t){return $t&&"[object Window]"==Kt.call(t)?function(t){try{return Yt(t)}catch(t){return $t.slice()}}(t):Yt(h(t))}},Zt=Object.getOwnPropertyDescriptor,Qt={f:z?Zt:function(t,e){if(t=h(t),e=S(e,!0),q)try{return Zt(t,e)}catch(t){}if(m(t,e))return w(!Ht.f.call(t,e),t[e])}},te=Nt.KEY,ee=Qt.f,ie=W.f,ne=Jt.f,re=I.Symbol,oe=I.JSON,se=oe&&oe.stringify,ae="prototype",ue=lt("_hidden"),de=lt("toPrimitive"),he={}.propertyIsEnumerable,le=P("symbol-registry"),pe=P("symbols"),ce=P("op-symbols"),fe=Object[ae],me="function"==typeof re&&!!Gt.f,ge=I.QObject,ye=!ge||!ge[ae]||!ge[ae].findChild,ve=z&&b(function(){return 7!=ht(ie({},"a",{get:function(){return ie(this,"a",{value:7}).a}})).a})?function(t,e,i){var n=ee(fe,e);n&&delete fe[e],ie(t,e,i),n&&t!==fe&&ie(fe,e,n)}:ie,be=me&&"symbol"==typeof re.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof re},_e=function(t,e,i){return t===fe&&_e(ce,e,i),y(t),e=S(e,!0),y(i),m(pe,e)?(i.enumerable?(m(t,ue)&&t[ue][e]&&(t[ue][e]=!1),i=ht(i,{enumerable:w(0,!1)})):(m(t,ue)||ie(t,ue,w(1,{})),t[ue][e]=!0),ve(t,e,i)):ie(t,e,i)};me||(nt((re=function(t){if(this instanceof re)throw TypeError("Symbol is not a constructor!");var e=u(0<arguments.length?t:void 0),i=function(t){this===fe&&i.call(ce,t),m(this,ue)&&m(this[ue],e)&&(this[ue][e]=!1),ve(this,e,w(1,t))};return z&&ye&&ve(fe,e,{configurable:!0,set:i}),Mt(e)})[ae],"toString",function(){return this._k}),Qt.f=Ft,W.f=_e,Wt.f=Jt.f=Vt,Ht.f=Rt,Gt.f=jt,Dt.f=function(t){return Mt(lt(t))}),Z(Z.G+Z.W+Z.F*!me,{Symbol:re});for(var Se="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),we=0;Se.length>we;)lt(Se[we++]);for(var Te=N(lt.store),Ee=0;Te.length>Ee;)Pt(Te[Ee++]);Z(Z.S+Z.F*!me,"Symbol",{for:function(t){return m(le,t+="")?le[t]:le[t]=re(t)},keyFor:function(t){if(!be(t))throw TypeError(t+" is not a symbol!");for(var e in le)if(le[e]===t)return e},useSetter:function(){ye=!0},useSimple:function(){ye=!1}}),Z(Z.S+Z.F*!me,"Object",{create:function(t,e){return void 0===e?ht(t):Ot(ht(t),e)},defineProperty:_e,defineProperties:Ot,getOwnPropertyDescriptor:Ft,getOwnPropertyNames:Vt,getOwnPropertySymbols:jt});var ke=b(function(){Gt.f(1)});Z(Z.S+Z.F*ke,"Object",{getOwnPropertySymbols:function(t){return Gt.f(p(t))}}),oe&&Z(Z.S+Z.F*(!me||b(function(){var t=re();return"[null]"!=se([t])||"{}"!=se({a:t})||"{}"!=se(Object(t))})),"JSON",{stringify:function(t){for(var e,i,n=[t],r=1;r<arguments.length;)n.push(arguments[r++]);if(i=e=n[1],(f(e)||void 0!==t)&&!be(t))return qt(e)||(e=function(t,e){if("function"==typeof i&&(e=i.call(this,t,e)),!be(e))return e}),n[1]=e,se.apply(oe,n)}}),re[ae][de]||Y(re[ae],de,re[ae].valueOf),tt(re,"Symbol"),tt(Math,"Math",!0),tt(I.JSON,"JSON",!0),Pt("asyncIterator"),Pt("observable");var Ue=B.Symbol,Ae=i(function(t){t.exports={default:Ue,__esModule:!0}});e(Ae);var xe=e(i(function(t,e){e.__esModule=!0;var i=o(It),n=o(Ae),r="function"==typeof n.default&&"symbol"==typeof i.default?function(t){return typeof t}:function(t){return t&&"function"==typeof n.default&&t.constructor===n.default&&t!==n.default.prototype?"symbol":typeof t};function o(t){return t&&t.__esModule?t:{default:t}}e.default="function"==typeof n.default&&"symbol"===r(i.default)?function(t){return void 0===t?"undefined":r(t)}:function(t){return t&&"function"==typeof n.default&&t.constructor===n.default&&t!==n.default.prototype?"symbol":void 0===t?"undefined":r(t)}}));function Ce(t){return!!t&&"object"===(void 0===t?"undefined":xe(t))}function Le(t){return Ce(t)&&"[object Object]"===toString.call(t)&&t.constructor===Object}var De=function(t){return Ce(t)?it(t):[]};function Be(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n={};return t.forEach(function(t){var e,i;t&&(i=function(t,e){Le(t)?(Le(n[e])||(n[e]={}),n[e]=Be(n[e],t)):n[e]=t},De(e=t).forEach(function(t){return i(e[t],t)}))}),n}J("getOwnPropertyNames",function(){return Jt.f});function Ie(t){return Pe.getOwnPropertyNames(t)}var Pe=B.Object,Me=e(i(function(t){t.exports={default:Ie,__esModule:!0}}));function Oe(t){return t&&Ce(t)&&1===t.nodeType}function Re(t,r,e,i){void 0===t&&(t="div");var n,o=document.createElement(t);return Me(r).forEach(function(t){var e,i,n=r[t];"textContent"===t?(i=n,void 0===(e=o).textContent?e.innerText=i:e.textContent=i):o[t]=n}),Me(e).forEach(function(t){o.setAttribute(t,e[t])}),i&&(n=o,function(t){return"function"==typeof t&&(t=t()),(Array.isArray(t)?t:[t]).map(function(t){return"function"==typeof t&&(t=t()),Oe(t)||Ce(e=t)&&3===e.nodeType?t:"string"==typeof t&&/\S/.test(t)?document.createTextNode(t):void 0;var e}).filter(function(t){return t})}(i).forEach(function(t){return n.appendChild(t)})),o}var Fe=1;var Ve={errorMessage:{noStream:"直播流不存在",noString:"不是字符串",noMediaSource:"不支持MediaSource的API",loadError:"错误，请刷新后重新加载"},tips:{loadWaiting:"加载中！"}},je=(Ne.prototype.initChildren=function(){},Ne.prototype.createEl=function(t,e,i,n){return void 0===t&&(t="div"),void 0===e&&(e={}),void 0===i&&(i={}),Re(t,e,i,n)},Ne.prototype.hide=function(t){if(t)return Oe(t)&&(t.style.display="none"),t},Ne.prototype.show=function(t){if(t)return Oe(t)&&(t.style.display="block"),t},Ne.sendError=function(t){Ne.videoForegin.hooks.error&&Ne.videoForegin.hooks.error(t),Ne.options_.errorDom.dom.innerHTML=t.message,Ne.options_.errorDom.show(Ne.options_.errorDom.dom)},Ne.setAttribute=function(e,t){t.forEach(function(t){e.setAttribute(t.name,t.value)})},Ne.setComponents=function(t,e){if("string"!=typeof t||!t)throw new Error(""+t+Ne.languages.errorMessage.noString);return t=t.toLocaleLowerCase(),Ne.components_||(Ne.components_={}),Ne.components_[t]=e},Ne.getComponents=function(t){return t=t.toLocaleLowerCase(),Ne.components_[t]?Ne.components_[t]:null},Ne.languages=Ve,Ne.guid_=Fe++,Ne.ischangeSource=!1,Ne);function Ne(t,e,i){this.children=[],!t&&this.play_?this.play_=t=this:this.play_=t,this.options_=e}var ze,Ge,He=window.navigator&&window.navigator.userAgent||"",qe=/AppleWebKit\/([\d.]+)/i.exec(He),Xe=(qe&&parseFloat(qe.pop()),/iPad/i.test(He)),We=(/iPhone/i.test(He),/iPod/i.test(He),(ze=He.match(/OS (\d+)_/i))&&ze[1]&&ze[1],/Android/i.test(He)),Ye=(function(){var t=He.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!t)return;var e=t[1]&&parseFloat(t[1]),i=t[2]&&parseFloat(t[2]);e&&i&&parseFloat(t[1]+"."+t[2])}(),/Firefox/i.test(He),function(){var t=-1<He.indexOf("compatible")&&-1<He.indexOf("MSIE"),e=-1<He.indexOf("Edge")&&!t,i=-1<He.indexOf("Trident")&&-1<He.indexOf("rv:11.0");if(t){new RegExp("MSIE (\\d+\\.\\d+);").test(He);var n=parseFloat(RegExp.$1);return 7==n?7:8==n?8:9==n?9:10==n?10:6}return e?"edge":i?11:-1}()),Ke=/Edge/i.test(He),$e=!Ke&&(/Chrome/i.test(He)||/CriOS/i.test(He)),Je=((Ge=He.match(/(Chrome|CriOS)\/(\d+)/))&&Ge[2]&&parseFloat(Ge[2]),/Safari/i.test(He),function(){this.autoplay=null,this.preload="auto",this.loop=!1,this.width="100%",this.height="100%",this.teachOrder=["html5","flash"],this.streamTimeoutTime=3e4,this.streamLink={hls:null,flv:null,trmp:null,mp4:null},this.languages="cn",this.iconfont={play:"&#xC002;",pause:"&#xC006;",volume:"&#xC004;",volumeSilent:"&#xC005;",fullScreen:"&#xC001;",exitFullScreen:"&#xC003;"}});Je.teachModel=["html5"];var Ze,Qe=(t(ti,Ze=je),ti);function ti(t,e,i){var n,r=Ze.call(this,t,e,i)||this;if(r.options_.streamLink.mp4)n=je.getComponents("mp4");else if(r.options_.streamLink.flv)n=je.getComponents("flv");else{if(!r.options_.streamLink.hls)throw new Error(""+je.languages.errorMessage.noStream);n=je.getComponents("hls")}return new n(t,je.options_)}je.setComponents("html5",Qe);var ei,ii=(t(ni,ei=je),ni);function ni(t,e,i){return ei.call(this,t,e,i)||this}je.setComponents("flash",ii);var ri,oi,si,ai=(t(ui,ri=je),ui.prototype.switchplaymode=function(t){},ui.prototype.initplaymode=function(t,e){var i;function n(t){switch(t){case"html5":return ui.playhtml5(this.options_);case"flash":return ui.playflash(this.options_);default:throw new Error("直播流不存在")}}i=-1===Ye?0<this.options_.teachOrder.length&&this.options_.teachOrder[0].indexOf(Je.teachModel)?n.call(this,this.options_.teachOrder[0]):n.call(this,"html5"):n.call(this,"flash"),ui.playteach=new i(t,this.options_,e)},ui);function ui(t,e,i){var n=ri.call(this,t,e,i)||this;return n.initplaymode(t,i),n}ai.playhtml5=function(t){if(t.streamLink.flv||t.streamLink.hls||t.streamLink.mp4)return je.getComponents("html5");if(t.streamLink.trmp)return je.getComponents("flash");throw new Error(""+je.languages.errorMessage.noStream)},ai.playflash=function(){},je.setComponents("livStream",ai),(si=oi=oi||{})[si.flv=0]="flv",si[si.hls=1]="hls",si[si.mp4=2]="mp4";var di,hi=(t(li,di=je),li.prototype.renderDom=function(){var t=je.options_.iconfont.play,e=je.options_.iconfont.pause,i=je.options_.iconfont.volume,n=je.options_.iconfont.volumeSilent,r=je.options_.iconfont.fullScreen,o=je.options_.iconfont.exitFullScreen,s=this.createEl("div",{className:"video_toolbar_content",innerHTML:"\n                <div class = 'toolbar-container'>\n                    <div class = 'left'>\n                        <div class = 'play iconfont' title='播放'>"+t+"</div>\n                        <div class = 'pause iconfont' title='暂停'>"+e+"</div>\n                        <div class = 'reload' title='重新加载'></div>\n                        "+this.renderRoom()+"                   \n                    </div>\n                    <div class = 'right'>\n                        <div class='volume-box'>\n                            <div class = 'volume iconfont' title='设置静音'>"+i+"</div>\n                            <div class = 'volume-silent iconfont'  title='取消静音'>"+n+'</div>\n                        </div> \n                        <div class="volume-bar">\n                            <div class="volume-bar-container">\n                                <div class="back vcenter"></div>\n                                <div class="front vcenter" style="height: 60px;"></div>\n                                <div class="point vcenter" style="bottom: 56px;"></div>\n                            </div>\n                        </div>\n                        <div class=\'fullScreen iconfont\'>'+r+"</div>\n                        <div class='exit-fullScreen iconfont'>"+o+"</div>\n                    </div>\n                </div>\n            "}),a=this.createEl("div",{className:"video_danmu_box",id:"video_danmu_box",innerHTML:""});this.livePlayerEl=document.getElementsByClassName("live-player")[0],this.insertBeforeEl(s,this.livePlayerEl),this.insertBeforeEl(a,this.livePlayerEl),this.getVideiBarEls(),this.addtVideiBarListener(),this.renderPlayerProgress(),this.addForeignFn(),this.renderRoomNumberAndVisitorsNum(),this.livePlayerEl.oncontextmenu=function(){event.returnValue=!1}},li.prototype.renderRoom=function(){return je.options_.mode!==oi.mp4?"<div class = 'room-number-content'> \n                        '<span>房间号：</span>'\n                        <span class='room-number-val'></span>\n                    </div>\n                    <div class = 'visitors-number-content'>                                                        \n                        <span class='visitors-number-val'></span>\n                    </div>":""},li.prototype.renderRoomNumberAndVisitorsNum=function(){var t,e,i=this;je.options_.mode!==oi.mp4&&(t=document.getElementsByClassName("room-number-val")[0],e=document.getElementsByClassName("visitors-number-val")[0],je.options_.roomIdentifier&&(t.innerHTML=je.options_.roomIdentifier),je.options_.visitorsNumber&&(e.innerHTML=this.ransformationNum(je.options_.visitorsNumber)+"人正在观看"),je.videoForegin.operation.updateVisitorsNum=function(t){t&&(e.innerHTML=i.ransformationNum(je.options_.visitorsNumber)+"人正在观看")})},li.prototype.ransformationNum=function(t){var e=parseInt(t);return 1e4<=e?e/1e4+"万":t},li.prototype.renderPlayerProgress=function(){var t,e,i,n,r;je.options_.mode==oi.mp4?(t=this.createEl("div",{className:"player_progress",innerHTML:"\n                    <div class='range-container'></div>\n                    <div class='progress-played'></div>\n                    <div class='range-thumb'></div>\n                "}),i=(e=document.getElementsByClassName("video_toolbar_content ")[0]).firstChild,e.insertBefore(t,i),n=this.createEl("div",{className:"control-time ",innerHTML:'\n                    <span class="control-time-current">00:00</span>\n                    <span class="control-time-split">/</span>\n                    <span class="control-time-duration"></span>\n                '}),r=document.getElementsByClassName("left")[0],je.videoEmit.loadeddata=this.loadeddata.bind(this),je.videoEmit.timeupdate=this.timeupdate.bind(this),this.insertBeforeEl(n,r),this.addtProgressListener(),this.addRangeThumbListener()):(this.judgeMousePositionInRange(),this.show(this.reLoadEl)),this.isPc&&this.initShortcutOperation(),this.judgeIsInVideoContainer()},li.prototype.insertBeforeEl=function(t,e){e.insertBefore(t,e.lastChild)},li.prototype.getVideiBarEls=function(){var t,e=this,i=document.getElementsByClassName("toolbar-container")[0];this.playEl=i.getElementsByClassName("play")[0],this.pauseEl=i.getElementsByClassName("pause")[0],this.reLoadEl=i.getElementsByClassName("reload")[0],this.fullScreenEl=i.getElementsByClassName("fullScreen")[0],this.exitFullScreenEl=i.getElementsByClassName("exit-fullScreen")[0],this.volumeEl=i.getElementsByClassName("volume")[0],this.volumeSilentEl=i.getElementsByClassName("volume-silent")[0],this.pointEl=document.getElementsByClassName("point")[0],this.backEl=document.getElementsByClassName("back")[0],this.frontEl=document.getElementsByClassName("front")[0],this.volumebarEl=i.getElementsByClassName("volume-bar")[0],this.volumeBoxEl=i.getElementsByClassName("volume-box")[0],je.options_.autoplay&&(t=setInterval(function(){e.volumeEl.click(),je.options_.play.paused||(e.show(e.pauseEl),e.hide(e.playEl),clearTimeout(t))},1e3))},li.prototype.addtVideiBarListener=function(){var d=this,t=document.getElementsByClassName("video_toolbar_content")[0],h=this.backEl.offsetHeight-this.pointEl.offsetHeight,s=this;t.addEventListener("click",function(t){var e=t.target.className.split(" ")[0],i=je.options_.play;switch(e){case"play":case"pause":d.changeVideoPlayOrPause();break;case"fullScreen":d.fullScreen(d.livePlayerEl);break;case"exit-fullScreen":d.exitFullscreen();break;case"volume":i.muted=!0,d.hide(t.target),d.show(d.volumeSilentEl),d.updateVolumePosiontion(0,0,!0);break;case"volume-silent":i.muted=!1,d.hide(t.target),d.show(d.volumeEl),0===d.pointLeft&&0==d.currentVolume?d.initVolumePosiontion():d.updateVolumePosiontion(d.pointLeft,d.currentVolume);break;case"front vcenter":var n=void 0,r=t.target.offsetHeight-t.offsetY,n=h<r?h:r,o=Math.ceil(n/h*100);d.updateVolumePosiontion(n,o);break;case"back vcenter":var s=void 0,a=64-t.offsetY,s=h<a?h:a,u=Math.ceil(s/h*100);d.updateVolumePosiontion(s,u)}}),this.isPc?(this.pointEl.onmousedown=function(t){d.poinMousedownCallBack.call(s,t,h,t.clientY)},this.volumeBoxEl.onmouseenter=function(){s.showVolumebarTimeout&&clearTimeout(s.showVolumebarTimeout),s.showVolumebarTimeout=null,s.volumebarEl.style.visibility="initial"},this.volumeBoxEl.onmouseleave=function(t){s.showVolumebarTimeout=setTimeout(function(){s.volumebarEl.style.visibility="hidden"},350)},this.volumebarEl.onmouseenter=function(t){s.showVolumebarTimeout&&clearTimeout(s.showVolumebarTimeout),s.showVolumebarTimeout=null},this.volumebarEl.onmouseleave=function(t){s.volumebarEl.style.visibility="hidden"}):this.pointEl.ontouchstart=function(t){var r=64-s.pointEl.offsetTop,o=(t||window.event).changedTouches[0].clientY;window.ontouchmove=function(t){var e=(t||window.event).changedTouches[0].clientY,i=o-e+r;i<0&&(i=0),h<=i&&(i=h);var n=Math.ceil(i/h*100);0<n&&(je.options_.play.muted=!1),s.updateVolumePosiontion(i,n)},window.ontouchend=function(){window.ontouchmove=null,window.ontouchend=null,s.judgeIsInVideoContainer()}}},li.prototype.poinMousedownCallBack=function(t,o,e){var s=64-this.pointEl.offsetTop,a=e,u=this;return window.onmousemove=function(t){var e=t||window.event,i=a-e.clientY,n=s+i;n<0&&(n=0),o<=n&&(n=o);var r=Math.ceil(n/o*100);return 0<r&&(je.options_.play.muted=!1),u.updateVolumePosiontion(n,r),!1},!(window.onmouseup=function(){return window.onmousemove=null,u.judgeIsInVideoContainer(),!1})},li.prototype.changeVideoPlayOrPause=function(){1==je.options_.play.paused?(je.options_.play.play(),this.show(this.pauseEl),this.hide(this.playEl)):(je.options_.play.pause(),this.show(this.playEl),this.hide(this.pauseEl))},li.prototype.initVolumePosiontion=function(){this.currentVolume<=0&&(this.currentVolume=30);var t=(this.currentVolume-this.pointEl.offsetHeight)/(this.backEl.offsetHeight-this.pointEl.offsetHeight)*100;30<t&&(t-=this.pointEl.offsetHeight),this.updateVolumePosiontion(t,this.currentVolume)},li.prototype.updateVolumePosiontion=function(t,e,i){t===this.pointLeft&&this.currentVolume===e&&!0===i||(this.pointEl.style.bottom=t+"px",this.frontEl.style.height=t+this.pointEl.offsetHeight+"px",i||(this.pointLeft=t,this.frontWidth=t+this.pointEl.offsetHeight,this.updatevolume(e)))},li.prototype.updatevolume=function(t){0===t?(this.show(this.volumeSilentEl),this.hide(this.volumeEl)):(this.show(this.volumeEl),this.hide(this.volumeSilentEl)),this.currentVolume=t,je.options_.play.volume=this.currentVolume/100},li.prototype.fullScreen=function(t){var e=t.requestFullScreen||t.webkitRequestFullScreen||t.mozRequestFullScreen||t.msRequestFullScreen;void 0!==e&&e&&(this.isPc||this.changeFullScreenOrExit(),e.call(t))},li.prototype.exitFullscreen=function(){var t=document;this.isPc||this.changeFullScreenOrExit(),t.exitFullscreen?t.exitFullscreen():t.webkitExitFullscreen?t.webkitExitFullscreen():t.msExitFullscreen?t.msExitFullscreen():t.mozCancelFullScreen&&t.mozCancelFullScreen()},li.prototype.changeFullScreenOrExit=function(){this.isFullScreen?(this.isFullScreen=!1,this.show(this.fullScreenEl),this.hide(this.exitFullScreenEl)):(this.isFullScreen=!0,this.show(this.exitFullScreenEl),this.hide(this.fullScreenEl))},li.prototype.judgeMousePositionInRange=function(){var o=this,t=document.getElementsByClassName("video_toolbar_content")[0];this.showTimeOut=setTimeout(function(){t.className=t.className+" video_toolbar_content_hide",clearTimeout(o.showTimeOut)},3e3),document.onmousemove=function(t){var e=o.livePlayerEl.offsetHeight+o.livePlayerEl.offsetTop,i=o.livePlayerEl.offsetWidth+o.livePlayerEl.getBoundingClientRect().left,n=o.livePlayerEl.offsetHeight/2+o.livePlayerEl.offsetTop,r=document.getElementsByClassName("video_toolbar_content")[0];t.clientX<i&&t.clientX>=o.livePlayerEl.getBoundingClientRect().left&&t.clientY>n&&t.clientY<e?(clearTimeout(o.showTimeOut),o.showTimeOut=null,-1<r.className.indexOf("video_toolbar_content_hide")&&(r.className=""+r.className.replace(" video_toolbar_content_hide",""))):r.className.indexOf("video_toolbar_content_hide")<=-1&&(r.className=r.className+" video_toolbar_content_hide")}},li.prototype.judgeIsInVideoContainer=function(){var n=this,r=document.getElementsByClassName("video_toolbar_content")[0];window.onmousemove=function(t){var e=n.livePlayerEl.offsetHeight+n.livePlayerEl.offsetTop-r.offsetHeight,i=n.livePlayerEl.offsetWidth+n.livePlayerEl.getBoundingClientRect().left;return t.clientX<i&&t.clientX>n.livePlayerEl.getBoundingClientRect().left&&t.clientY>n.livePlayerEl.offsetTop&&t.clientY<e?n.isInVideoContainer=!0:n.isInVideoContainer=!1,!1};var t=document.getElementById("live-player");t.onmouseenter=function(){r.className=""+r.className.replace(" video_toolbar_content_hide","")},t.onmouseleave=function(){r.className.indexOf("video_toolbar_content_hide")<0&&(r.className=r.className+" video_toolbar_content_hide")}},li.prototype.initShortcutOperation=function(){var n=this,t=je.options_.play;je.options_.mode===oi.mp4?(t.onclick=function(t){clearTimeout(n.clickTimeId),n.clickTimeId=setTimeout(function(){n.changeVideoPlayOrPause()},250)},t.ondblclick=function(t){clearTimeout(n.clickTimeId),1==n.isFullScreen?n.exitFullscreen():n.fullScreen(n.livePlayerEl)}):t.ondblclick=function(t){1==n.isFullScreen?n.exitFullscreen():n.fullScreen(n.livePlayerEl)},window.onresize=function(){n.isPc&&n.changeFullScreenOrExit()},window.onkeydown=function(t){if(n.isInVideoContainer){if(je.options_.mode===oi.mp4){if(39==t.keyCode){if(je.options_.mode!==oi.mp4)return;je.options_.play.currentTime=je.options_.play.currentTime+10}if(37==t.keyCode){if(je.options_.mode!==oi.mp4)return;je.options_.play.currentTime=je.options_.play.currentTime-10}}if(32==t.keyCode&&n.isInVideoContainer)return n.changeVideoPlayOrPause(),!1;if(38==t.keyCode){if(100<=n.currentVolume&&87<=n.pointLeft)return;var e=n.pointLeft;87<=n.pointLeft+8.7?e=87:e+=8.7;var i=n.currentVolume;100<=n.currentVolume+10?i=100:i+=10,n.updateVolumePosiontion(e,i)}if(40==t.keyCode){if(n.currentVolume<=0&&n.pointLeft<=0)return;e=n.pointLeft,n.pointLeft-8.7<=0?e=0:e-=8.7,i=n.currentVolume,n.currentVolume-10<=0?i=0:i-=10,n.updateVolumePosiontion(e,i)}}}},li.prototype.getUserAgentInfo=function(){for(var t=navigator.userAgent,e=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],i=!0,n=0;n<e.length;n++)if(0<t.indexOf(e[n])){i=!1;break}this.isPc=i},li.prototype.loadeddata=function(){this.allTime=this.timeStamp(je.options_.play.duration),this.controlTimeDurationEl=document.getElementsByClassName("control-time-duration")[0],this.controlTimeDurationEl.innerHTML=this.allTime;var t=document.getElementsByClassName("control-time-split")[0];this.show(this.controlTimeDurationEl),this.show(t),this.videoStageDescription()},li.prototype.addtProgressListener=function(){var i=this;this.playerProgress=document.getElementsByClassName("player_progress")[0],this.progressPlayed=document.getElementsByClassName("progress-played")[0],this.rangeThumb=document.getElementsByClassName("range-thumb")[0],this.playerProgress.addEventListener("click",function(t){var e=(t.pageX-i.playerProgress.offsetLeft-i.livePlayerEl.getBoundingClientRect().left)/i.playerProgress.offsetWidth;i.progressPlayed.style.width=e*i.playerProgress.offsetWidth-2+"px";try{i.rangeThumb.style.left=e*i.playerProgress.offsetWidth-2+"px"}catch(t){}return je.options_.play.currentTime=e*je.options_.play.duration,!1})},li.prototype.addRangeThumbListener=function(){var s,e=this,a=this;this.rangeThumb.onmousedown=function(t){var n=e.rangeThumb.offsetLeft,r=(t||window.event).clientX,o=e.playerProgress.offsetWidth-e.rangeThumb.offsetWidth;return e.isRangeThumbDrop=!0,je.options_.play.pause(),window.onmousemove=function(t){var e=(t||window.event).clientX,i=Math.min(o,Math.max(-2,n+(e-r)));return a.rangeThumb.style.left=i+"px",a.progressPlayed.style.width=Math.max(0,i)+"px",s=i/o,!1},!(window.onmouseup=function(){return window.onmousemove=null,window.onmouseup=null,e.judgeIsInVideoContainer(),e.isRangeThumbDrop=!1,je.options_.play.currentTime=s*je.options_.play.duration,e.changeVideoPlayOrPause(),s=0,!1})},this.rangeThumb.ontouchstart=function(t){var n=e.rangeThumb.offsetLeft,r=(t||window.event).changedTouches[0].clientX,o=e.playerProgress.offsetWidth-e.rangeThumb.offsetWidth;e.isRangeThumbDrop=!0,je.options_.play.pause(),window.ontouchmove=function(t){var e=(t||window.event).changedTouches[0].clientX,i=Math.min(o,Math.max(-2,n+(e-r)));a.rangeThumb.style.left=i+"px",a.progressPlayed.style.width=Math.max(0,i)+"px",s=i/o},window.ontouchend=function(){window.ontouchmove=null,window.ontouchend=null,e.isRangeThumbDrop=!1,je.options_.play.currentTime=s*je.options_.play.duration,je.options_.play.play(),e.show(e.pauseEl),e.hide(e.playEl),s=0}}},li.prototype.timeupdate=function(){this.currentTime=this.timeStamp(je.options_.play.currentTime),this.controlTimeCurrentEl=document.getElementsByClassName("control-time-current")[0],this.controlTimeCurrentEl.innerHTML=this.currentTime,this.allTime===this.currentTime&&(this.hide(this.pauseEl),this.show(this.playEl));var t=je.options_.play.currentTime/je.options_.play.duration*100;this.isRangeThumbDrop||(this.progressPlayed.style.width=t+"%",this.rangeThumb.style.left=t+"%")},li.prototype.timeStamp=function(t){var e,i=parseInt(t),n=0,r=0;return 60<=i&&(n=parseInt((i/60).toString()),i=parseInt((i%60).toString()),60<=n&&(r=parseInt((n/60).toString()),n=parseInt((n%60).toString()))),e="0:"+this.formatNum(i),0<n&&(e=n+":"+this.formatNum(i)),0<r&&(e=r+":"+this.formatNum(n)+":"+this.formatNum(i)),e},li.prototype.formatNum=function(t){var e=t<10?"0"+t:""+t;return e},li.prototype.videoStageDescription=function(){var e,t,i,n=this;je.options_.mode===oi.mp4&&(e="",t=je.options_.stageDescriptionDatas,Array.isArray(t)&&t.forEach(function(t){e+="<span class ='progress-hightlights' style ='left:"+n.getPosition(t.time)+"%'>\n                            <span class='progress-hightlights-tips'>"+t.title+"</span>\n                        </span>"}),i=this.createEl("div",{innerHTML:e}),this.insertBeforeEl(i,this.playerProgress))},li.prototype.getPosition=function(t){return t/je.options_.play.duration*100},li.prototype.addForeignFn=function(){var e=this;je.videoForegin.operation.playVideo=function(){je.options_.play.play(),e.hide(e.playEl),e.show(e.pauseEl)},je.videoForegin.operation.pauseVideo=function(){je.options_.play.pause(),e.hide(e.pauseEl),e.show(e.playEl)},je.videoForegin.operation.fullScreenVideo=function(){e.fullScreen(e.livePlayerEl)},je.videoForegin.operation.muteVideo=function(){je.options_.play.muted=!0,e.hide(e.volumeEl),e.show(e.volumeSilentEl),e.updateVolumePosiontion(0,0,!0)},je.videoForegin.operation.restoreVoice=function(){je.options_.play.muted=!1,e.hide(e.volumeSilentEl),e.show(e.volumeEl),0===e.pointLeft&&0==e.currentVolume?e.initVolumePosiontion():e.updateVolumePosiontion(e.pointLeft,e.currentVolume)},je.videoForegin.operation.seekTo=function(t){je.options_.mode===oi.mp4?e.isNumber(t)?null!=t&&""!==t?t>je.options_.play.duration?je.sendError({message:"跳转时间大于视频总时长"}):je.options_.play.currentTime=t:je.sendError({message:"需要跳转的数值格式不正确"}):je.sendError({message:"非数值"}):je.sendError({message:"此播放模式不允许跳转时间"})},je.videoForegin.operation.reLoadVideo=function(){je.options_.mode==oi.mp4&&(je.options_.play.currentTime=0,je.options_.play.play(),e.hide(e.playEl),e.show(e.pauseEl))}},li.prototype.isNumber=function(t){return!(!/^\d+(\.\d+)?$/.test(t)&&!/^(-(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*)))$/.test(t))},li);function li(t,e,i){var n=di.call(this,t,e,i)||this;return n.ishide=!0,n.currentVolume=30,n.isRangeThumbDrop=!1,n.isClickFlag=!1,n.isFullScreen=!1,n.isInVideoContainer=!1,n.showVolumebarTimeout=null,n.getUserAgentInfo(),n.renderDom(),n.initVolumePosiontion(),n}je.setComponents("videoToolBar",hi);var pi,ci=(t(fi,pi=je),fi.prototype.create=function(){var t,e=document.getElementsByClassName("live-player")[0];je.options_.centerControlDom?(e.appendChild(je.options_.centerControlDom),t=je.options_.centerControlDom.clientHeight+50,e.removeChild(je.options_.centerControlDom),this.dom=this.createEl("div",{className:"center-control"},{},je.options_.centerControlDom),this.dom.style.top=" calc(50% - "+t+"px)"):(this.dom=this.createEl("div",{className:"center-control"}),this.dom.style.top=" calc(50%)"),e.appendChild(this.dom)},fi);function fi(t,e,i){var n=pi.call(this,t,e,i)||this;return n.create(),n}je.setComponents("centerControl",ci);var mi,gi=(t(yi,mi=je),yi.prototype.create=function(){je.options_.loadWaitingDom?this.dom=this.createEl("div",{className:"load-waiting"},{},je.options_.loadWaitingDom):this.dom=this.createEl("div",{className:"load-waiting",innerHTML:"                \n                    <div class='loader-content'></div>                \n                "}),document.getElementsByClassName("live-player")[0].appendChild(this.dom),je.videoForegin.operation.hideCenterControl=function(){je.options_.centerControlDom.hide(je.options_.centerControlDom.dom)},je.videoForegin.operation.showCenterControl=function(){je.options_.centerControlDom.show(je.options_.centerControlDom.dom)}},yi);function yi(t,e,i){var n=mi.call(this,t,e,i)||this;return n.create(),n}je.setComponents("loadWaitingBar",gi);var vi,bi=(t(_i,vi=je),_i.prototype.create=function(){je.options_.errorDom?this.dom=this.createEl("div",{className:"error-bar"},{},je.options_.errorDom):this.dom=this.createEl("div",{className:"error-bar",innerHTML:je.languages.errorMessage.loadError}),document.getElementsByClassName("live-player")[0].appendChild(this.dom)},_i);function _i(t,e,i){var n=vi.call(this,t,e,i)||this;return n.create(),n}je.setComponents("errorBar",bi);var Si=(wi.prototype.onvStalled=function(t){this.checkAndResumeStuckPlayback(!0)},wi.prototype.onvProgress=function(t){this.checkAndResumeStuckPlayback()},wi.prototype.checkAndResumeStuckPlayback=function(t){var e,i=je.options_.play;!(t||!this._receivedCanPlay||i.readyState<2)||0<(e=i.buffered).length&&i.currentTime<e.start(0)&&(this._requestSetTime=!0,je.options_.play.currentTime=e.end(0)-.5)},wi.prototype.videoListen=function(){je.videoEmit.stalled=this.onvStalled.bind(this),je.videoEmit.progress=this.onvProgress.bind(this)},wi.prototype.removevideoListen=function(){je.options_.play.removeEventListener("play",function(t){}),je.options_.play.removeEventListener("waiting",function(t){}),je.options_.play.removeEventListener("pause",function(t){}),je.options_.play.removeEventListener("canplay",function(t){}),je.options_.play.removeEventListener("seeked",function(t){}),je.options_.play.removeEventListener("seeking",function(t){}),je.options_.play.removeEventListener("loadstart",function(t){}),je.options_.play.removeEventListener("timeupdate",function(t){}),je.options_.play.removeEventListener("canplaythrough",function(t){}),je.options_.play.removeEventListener("loadeddata",function(t){}),je.options_.play.removeEventListener("loadedmetadata",function(t){}),je.options_.play.removeEventListener("progress",this.onvProgress.bind(this)),je.options_.play.removeEventListener("stalled",this.onvStalled.bind(this))},wi);function wi(){this._pendingSeekTime=null,this._receivedCanPlay=!1}var Ti=Object.assign,Ei=!Ti||b(function(){var t={},e={},i=Symbol(),n="abcdefghijklmnopqrst";return t[i]=7,n.split("").forEach(function(t){e[t]=t}),7!=Ti({},t)[i]||Object.keys(Ti({},e)).join("")!=n})?function(t,e){for(var i=p(t),n=arguments.length,r=1,o=Gt.f,s=Ht.f;r<n;)for(var a,u=U(arguments[r++]),d=o?N(u).concat(o(u)):N(u),h=d.length,l=0;l<h;)a=d[l++],z&&!s.call(u,a)||(i[a]=u[a]);return i}:Ti;Z(Z.S+Z.F,"Object",{assign:Ei});var ki=B.Object.assign,Ui=e(i(function(t){t.exports={default:ki,__esModule:!0}})),Ai=(xi.prototype.getTime=function(){this.arr=[];for(var t=0;t<this.Timestamp.length;t++)this.arr.push(1==this.Timestamp[t].toString(16).length?"0"+this.Timestamp[t].toString(16):this.Timestamp[t].toString(16));this.arr.pop();var e=this.arr.join("");return this.time=parseInt(e,16),parseInt(e,16)},xi);function xi(){this.tagType=-1,this.dataSize=-1,this.Timestamp=-1,this.StreamID=-1,this.body=-1,this.time=-1,this.arr=[],this.size=-1}function Ci(t){for(var e,i=[],n=t,r=0,o=t.length;r<o;)if(n[r]<128)i.push(String.fromCharCode(n[r])),++r;else{if(!(n[r]<192))if(n[r]<224){if(Li(n,r,1))if(128<=(e=(31&n[r])<<6|63&n[r+1])){i.push(String.fromCharCode(65535&e)),r+=2;continue}}else if(n[r]<240){if(Li(n,r,2))if(2048<=(e=(15&n[r])<<12|(63&n[r+1])<<6|63&n[r+2])&&55296!=(63488&e)){i.push(String.fromCharCode(65535&e)),r+=3;continue}}else if(n[r]<248){if(Li(n,r,3))if(65536<(e=(7&n[r])<<18|(63&n[r+1])<<12|(63&n[r+2])<<6|63&n[r+3])&&e<1114112){e-=65536,i.push(String.fromCharCode(e>>>10|55296)),i.push(String.fromCharCode(1023&e|56320)),r+=4;continue}}i.push(String.fromCharCode(65533)),++r}return i.join("")}function Li(t,e,i){var n=t;if(e+i<n.length){for(;i--;)if(128!=(192&n[++e]))return;return 1}}var Di,Bi=(Di=new ArrayBuffer(2),new DataView(Di).setInt16(0,256,!0),256===new Int16Array(Di)[0]),Ii=(Pi.parseObject=function(t,e,i){var n=Pi.parseString(t,e,i),r=Pi.parseScript(t,e+n.size),o=r.objectEnd;return{data:{name:n.data,value:r.data},size:r.size,objectEnd:o}},Pi.parseVariable=function(t,e,i){return Pi.parseObject(t,e,i)},Pi.parseLongString=function(t,e,i){var n=new DataView(t,e).getUint32(0,!Bi),r=0<n?Ci(new Uint8Array(t,e+4,n)):"";return{data:r,size:4+n}},Pi.parseDate=function(t,e,i){var n=new DataView(t,e),r=n.getFloat64(0,!Bi);return r+=60*n.getInt16(8,!Bi)*1e3,{data:new Date(r),size:10}},Pi.parseString=function(t,e,i){var n=new DataView(t,e).getUint16(0,!Bi),r=0<n?Ci(new Uint8Array(t,e+2,n)):"";return{data:r,size:2+n}},Pi.parseMetadata=function(t){var e=Pi.parseScript(t,0),i=Pi.parseScript(t,e.size,t.length-e.size),n={};return n[e.data]=i.data,n},Pi.parseScript=function(t,e,i){var n=e,r=new Uint8Array(t).buffer,o=new DataView(r,0,i),s=null,a=o.getUint8(n);switch(n+=1,a){case 0:s=o.getFloat64(n,!Bi),n+=8;break;case 1:s=!!o.getUint8(n),n+=1;break;case 2:var u=Pi.parseString(r,n);s=u.data,n+=u.size;break;case 3:s={};var d=0;for(9==(16777215&o.getUint32(i-4,!Bi))&&(d=3);n<i-4;){var h=Pi.parseObject(r,n,i-e-d);if(h.objectEnd)break;s[h.data.name]=h.data.value,n=h.size}n<=i-3&&9==(16777215&v.getUint32(n-1,!Bi))&&(n+=3);break;case 8:for(s={},n+=4,d=0,9==(16777215&o.getUint32(i-4,!Bi))&&(d=3);n<i-8;){var l=Pi.parseVariable(r,n);if(l.objectEnd)break;s[l.data.name]=l.data.value,n=l.size}n<=i-3&&9==(16777215&o.getUint32(n-1,!Bi))&&(n+=3);break;case 9:s=void 0,n=1;break;case 10:s=[];var p=o.getUint32(n,!Bi);n+=4;for(var c=0;c<p;c++){var f=Pi.parseScript(r,n);s.push(f.data),n=f.size}break;case 11:var m=Pi.parseDate(r,n+1,i-1);s=m.data,n+=m.size;break;case 12:var g=Pi.parseString(r,n+1,i-1);s=g.data,n+=g.size;break;default:n=i}return{data:s,size:n}},Pi);function Pi(){}var Mi=(Oi.prototype.isComplete=function(){var t=!1===this.hasAudio||!0===this.hasAudio&&null!=this.audioCodec&&null!=this.audioSampleRate&&null!=this.audioChannelCount,e=!1===this.hasVideo||!0===this.hasVideo&&null!=this.videoCodec&&null!=this.width&&null!=this.height&&null!=this.fps&&null!=this.profile&&null!=this.level&&null!=this.chromaFormat&&null!=this.sarNum&&null!=this.sarDen;return null!=this.mimeType&&null!=this.duration&&null!=this.metadata&&null!=this.hasKeyframesIndex&&t&&e},Oi.prototype.isSeekable=function(){return!0===this.hasKeyframesIndex},Oi);function Oi(){this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}var Ri=(Fi.prototype.destroy=function(){this._buffer=null},Fi.prototype._fillCurrentWord=function(){var t=this._total_bytes-this._buffer_index;if(t<=0)throw new IllegalStateException("ExpGolomb: _fillCurrentWord() but no bytes available");var e=Math.min(4,t),i=new Uint8Array(4);i.set(this._buffer.subarray(this._buffer_index,this._buffer_index+e)),this._current_word=new DataView(i.buffer).getUint32(0,!1),this._buffer_index+=e,this._current_word_bits_left=8*e},Fi.prototype.readBits=function(t){if(32<t)throw new InvalidArgumentException("ExpGolomb: readBits() bits exceeded max 32bits!");if(t<=this._current_word_bits_left){var e=this._current_word>>>32-t;return this._current_word<<=t,this._current_word_bits_left-=t,e}var i=this._current_word_bits_left?this._current_word:0;i>>>=32-this._current_word_bits_left;var n=t-this._current_word_bits_left;this._fillCurrentWord();var r=Math.min(n,this._current_word_bits_left),o=this._current_word>>>32-r;return this._current_word<<=r,this._current_word_bits_left-=r,i=i<<r|o},Fi.prototype.readBool=function(){return 1===this.readBits(1)},Fi.prototype.readByte=function(){return this.readBits(8)},Fi.prototype._skipLeadingZero=function(){for(var t=0;t<this._current_word_bits_left;t++)if(0!=(this._current_word&2147483648>>>t))return this._current_word<<=t,this._current_word_bits_left-=t,t;return this._fillCurrentWord(),t+this._skipLeadingZero()},Fi.prototype.readUEG=function(){var t=this._skipLeadingZero();return this.readBits(t+1)-1},Fi.prototype.readSEG=function(){var t=this.readUEG();return 1&t?t+1>>>1:-1*(t>>>1)},Fi);function Fi(t){this.TAG=this.constructor.name,this._buffer=t,this._buffer_index=0,this._total_bytes=t.byteLength,this._total_bits=8*t.byteLength,this._current_word=0,this._current_word_bits_left=0}var Vi=(ji._ebsp2rbsp=function(t){for(var e=t,i=e.byteLength,n=new Uint8Array(i),r=0,o=0;o<i;o++)2<=o&&3===e[o]&&0===e[o-1]&&0===e[o-2]||(n[r]=e[o],r++);return new Uint8Array(n.buffer,0,r)},ji.parseSPS=function(t){var e=ji._ebsp2rbsp(t),i=new Ri(e);i.readByte();var n=i.readByte();i.readByte();var r=i.readByte();i.readUEG();var o=ji.getProfileString(n),s=ji.getLevelString(r),a=1,u=420,d=8;if((100===n||110===n||122===n||244===n||44===n||83===n||86===n||118===n||128===n||138===n||144===n)&&(3===(a=i.readUEG())&&i.readBits(1),a<=3&&(u=[0,420,422,444][a]),d=i.readUEG()+8,i.readUEG(),i.readBits(1),i.readBool()))for(var h=3!==a?8:12,l=0;l<h;l++)i.readBool()&&ji._skipScalingList(i,l<6?16:64);i.readUEG();var p=i.readUEG();if(0===p)i.readUEG();else if(1===p){i.readBits(1),i.readSEG(),i.readSEG();for(var c=i.readUEG(),l=0;l<c;l++)i.readSEG()}i.readUEG(),i.readBits(1);var f=i.readUEG(),m=i.readUEG(),g=i.readBits(1);0===g&&i.readBits(1),i.readBits(1);var y=0,v=0,b=0,_=0;i.readBool()&&(y=i.readUEG(),v=i.readUEG(),b=i.readUEG(),_=i.readUEG());var S,w,T,E=1,k=1,U=0,A=!0,x=0,C=0;i.readBool()&&(i.readBool()&&(0<(S=i.readByte())&&S<16?(E=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][S-1],k=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][S-1]):255===S&&(E=i.readByte()<<8|i.readByte(),k=i.readByte()<<8|i.readByte())),i.readBool()&&i.readBool(),i.readBool()&&(i.readBits(4),i.readBool()&&i.readBits(24)),i.readBool()&&(i.readUEG(),i.readUEG()),i.readBool()&&(w=i.readBits(32),T=i.readBits(32),A=i.readBool(),U=(x=T)/(C=2*w)));var L=1;1===E&&1===k||(L=E/k);var D=0,B=0;B=0===a?(D=1,2-g):(D=3===a?1:2,(1===a?2:1)*(2-g));var I=16*(f+1),P=16*(m+1)*(2-g);I-=(y+v)*D,P-=(b+_)*B;var M=Math.ceil(I*L);return i.destroy(),i=null,{profile_string:o,level_string:s,bit_depth:d,chroma_format:u,chroma_format_string:ji.getChromaFormatString(u),frame_rate:{fixed:A,fps:U,fps_den:C,fps_num:x},sar_ratio:{width:E,height:k},codec_size:{width:I,height:P},present_size:{width:M,height:P}}},ji._skipScalingList=function(t,e){for(var i=8,n=8,r=0;r<e;r++)0!==n&&(n=(i+t.readSEG()+256)%256),i=0===n?i:n},ji.getProfileString=function(t){switch(t){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}},ji.getLevelString=function(t){return(t/10).toFixed(1)},ji.getChromaFormatString=function(t){switch(t){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}},ji);function ji(){}var Ni,zi=(Ni=new ArrayBuffer(2),new DataView(Ni).setInt16(0,256,!0),256===new Int16Array(Ni)[0]),Gi=(Hi.parseScriptData=function(t,e,i){var n={};try{var r=Hi.parseValue(t,e,i),o=Hi.parseValue(t,e+r.size,i-r.size);n[r.data]=o.data}catch(t){}return n},Hi.parseObject=function(t,e,i){if(!(i<3)){var n=Hi.parseString(t,e,i),r=Hi.parseValue(t,e+n.size,i-n.size),o=r.objectEnd;return{data:{name:n.data,value:r.data},size:n.size+r.size,objectEnd:o}}},Hi.parseVariable=function(t,e,i){return Hi.parseObject(t,e,i)},Hi.parseString=function(t,e,i){var n=new DataView(t,e,i).getUint16(0,!zi),r=0<n?Ci(new Uint8Array(t,e+2,n)):"";return{data:r,size:2+n}},Hi.parseLongString=function(t,e,i){if(!(i<4)){var n=new DataView(t,e,i).getUint32(0,!zi),r=0<n?Ci(new Uint8Array(t,e+4,n)):"";return{data:r,size:4+n}}},Hi.parseDate=function(t,e,i){if(!(i<10)){var n=new DataView(t,e,i),r=n.getFloat64(0,!zi);return r+=60*n.getInt16(8,!zi)*1e3,{data:new Date(r),size:10}}},Hi.parseValue=function(t,e,i){if(!(i<1)){var n=new DataView(t,e,i),r=1,o=n.getUint8(0),s=!1;try{switch(o){case 0:a=n.getFloat64(1,!zi),r+=8;break;case 1:var a=!!n.getUint8(1);r+=1;break;case 2:var u=Hi.parseString(t,e+1,i-1);a=u.data,r+=u.size;break;case 3:a={};var d=0;for(9==(16777215&n.getUint32(i-4,!zi))&&(d=3);r<i-4;){var h=Hi.parseObject(t,e+r,i-r-d);if(h.objectEnd)break;a[h.data.name]=h.data.value,r+=h.size}r<=i-3&&9==(16777215&n.getUint32(r-1,!zi))&&(r+=3);break;case 8:for(a={},r+=4,d=0,9==(16777215&n.getUint32(i-4,!zi))&&(d=3);r<i-8;){var l=Hi.parseVariable(t,e+r,i-r-d);if(l.objectEnd)break;a[l.data.name]=l.data.value,r+=l.size}r<=i-3&&9==(16777215&n.getUint32(r-1,!zi))&&(r+=3);break;case 9:r=1,s=!(a=void 0);break;case 10:a=[];var p=n.getUint32(1,!zi);r+=4;for(var c=0;c<p;c++){var f=Hi.parseValue(t,e+r,i-r);a.push(f.data),r+=f.size}break;case 11:var m=Hi.parseDate(t,e+1,i-1);a=m.data,r+=m.size;break;case 12:var g=Hi.parseString(t,e+1,i-1);a=g.data,r+=g.size;break;default:r=i}}catch(t){}return{data:a,size:r,objectEnd:s}}},Hi);function Hi(){}var qi=(Object.defineProperty(Xi.prototype,"hasAudio",{set:function(t){this._mediaInfo.hasAudio=this._hasAudio=t},enumerable:!1,configurable:!0}),Object.defineProperty(Xi.prototype,"hasVideo",{set:function(t){this._mediaInfo.hasVideo=this._hasVideo=t},enumerable:!1,configurable:!0}),Xi.prototype.onMediaInfo=function(t){this._onMediaInfo=t},Xi.prototype.parseMetadata=function(t){var e=Ii.parseMetadata(t);this._parseScriptData(e)},Xi.prototype._parseScriptData=function(t,e,i){var n=Gi.parseScriptData(t,e,i);if(n.hasOwnProperty("onMetaData")){if(null==n.onMetaData||"object"!==xe(n.onMetaData))return;this._metadata,this._metadata=n;var r,o,s,a,u=this._metadata.onMetaData;"boolean"==typeof u.hasAudio&&!1===this._hasAudioFlagOverrided&&(this._hasAudio=u.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),"boolean"==typeof u.hasVideo&&!1===this._hasVideoFlagOverrided&&(this._hasVideo=u.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),"number"==typeof u.audiodatarate&&(this._mediaInfo.audioDataRate=u.audiodatarate),"number"==typeof u.videodatarate&&(this._mediaInfo.videoDataRate=u.videodatarate),"number"==typeof u.width&&(this._mediaInfo.width=u.width),"number"==typeof u.height&&(this._mediaInfo.height=u.height),"number"==typeof u.duration?this._durationOverrided||(r=Math.floor(u.duration*this._timescale),this._duration=r,this._mediaInfo.duration=r):this._mediaInfo.duration=0,"number"!=typeof u.framerate||0<(o=Math.floor(1e3*u.framerate))&&(s=o/1e3,this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=s,this._referenceFrameRate.fps_num=o,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=s),"object"===xe(u.keyframes)?(this._mediaInfo.hasKeyframesIndex=!0,a=u.keyframes,this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(a),u.keyframes=null):this._mediaInfo.hasKeyframesIndex=!1,this._dispatch=!1,this._mediaInfo.metadata=u,this._mediaInfo.isComplete()&&this._onMediaInfo(this._mediaInfo)}0<it(n).length&&this._onScriptDataArrived&&this._onScriptDataArrived(Ui({},n))},Xi.prototype._parseKeyframesIndex=function(t){for(var e=[],i=[],n=1;n<t.times.length;n++){var r=this._timestampBase+Math.floor(1e3*t.times[n]);e.push(r),i.push(t.filepositions[n])}return{times:e,filepositions:i}},Xi.prototype.moofTag=function(t,e){return this.parseChunks(t,e)},Xi.prototype.parseChunks=function(t,e){var i=0,n=this._littleEndian;if(0===e){if(!(13<t.byteLength))return 0;i=Yi.probe(t).dataOffset}for(this._firstParse&&(this._firstParse=!1,this._dataOffset,(r=new DataView(t,i)).getUint32(0,!n),i+=4);i<t.byteLength;){this._dispatch=!0;var r=new DataView(t,i);if(i+11+4>t.byteLength)break;var o=r.getUint8(0),s=16777215&r.getUint32(0,!n);if(i+11+s+4>t.byteLength)break;if(8===o||9===o||18===o){var a=r.getUint8(4),u=r.getUint8(5),d=r.getUint8(6)|u<<8|a<<16|r.getUint8(7)<<24,h=(r.getUint32(7,!n),i+11);switch(o){case 8:this._parseAudioData(t,h,s,d);break;case 9:this._parseVideoData(t,h,s,d,e+i);break;case 18:this._parseScriptData(t,h,s)}r.getUint32(11+s,!n),i+=11+s+4}else i+=11+s+4}return this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack),i},Xi.prototype._parseVideoData=function(t,e,i,n,r){var o,s,a;n==this._timestampBase&&this._timestampBase,i<=1||(s=(240&(o=new Uint8Array(t,e,i)[0]))>>>4,7==(a=15&o)?this._parseAVCVideoPacket(t,e+1,i-1,n,r,s):this._onError&&this._onError("Flv: Unsupported codec in video frame: "+a))},Xi.prototype._parseAVCVideoPacket=function(t,e,i,n,r,o){if(!(i<4)){var s=this._littleEndian,a=new DataView(t,e,i),u=a.getUint8(0),d=(16777215&a.getUint32(0,!s))<<8>>8;if(0===u)this._parseAVCDecoderConfigurationRecord(t,e+4,i-4);else if(1===u)this._parseAVCVideoData(t,e+4,i-4,n,r,o,d);else if(2!==u)return void this._onError(DemuxErrors.FORMAT_ERROR,"Flv: Invalid video packet type "+u)}},Xi.prototype._parseAVCDecoderConfigurationRecord=function(t,e,i){if(!(i<7)){var n=this._videoMetadata,r=this._videoTrack,o=this._littleEndian,s=new DataView(t,e,i);n?n.avcc:((n=this._videoMetadata={}).type="video",n.id=r.id,n.timescale=this._timescale,n.duration=this._duration);var a=s.getUint8(0),u=s.getUint8(1);if(s.getUint8(2),s.getUint8(3),1===a&&0!==u)if(this._naluLengthSize=1+(3&s.getUint8(4)),3===this._naluLengthSize||4===this._naluLengthSize){var d=31&s.getUint8(5);if(0==d||1<d)this._onError(DemuxErrors.FORMAT_ERROR,"Flv: Invalid H264 SPS count: "+d);else{for(var h=6,l=0;l<d;l++){var p=s.getUint16(h,!o);if(h+=2,0!==p){var c=new Uint8Array(t,e+h,p);h+=p;var f=Vi.parseSPS(c);n.codecWidth=f.codec_size.width,n.codecHeight=f.codec_size.height,n.presentWidth=f.present_size.width,n.presentHeight=f.present_size.height,n.profile=f.profile_string,n.level=f.level_string,n.bitDepth=f.bit_depth,n.chromaFormat=f.chroma_format,n.sarRatio=f.sar_ratio,n.frameRate=f.frame_rate,!1!==f.frame_rate.fixed&&0!==f.frame_rate.fps_num&&0!==f.frame_rate.fps_den||(n.frameRate=this._referenceFrameRate);var m=n.frameRate.fps_den,g=n.frameRate.fps_num;n.refSampleDuration=Math.floor(n.timescale*(m/g));for(var y=c.subarray(1,4),v="avc1.",b=0;b<3;b++){var _=y[b].toString(16);_.length<2&&(_="0"+_),v+=_}n.codec=v;var S=this._mediaInfo;S.width=n.codecWidth,S.height=n.codecHeight,S.fps=n.frameRate.fps,S.profile=n.profile,S.level=n.level,S.chromaFormat=f.chroma_format_string,S.sarNum=n.sarRatio.width,S.sarDen=n.sarRatio.height,S.videoCodec=v,S.hasAudio?null!=S.audioCodec&&(S.mimeType='video/x-flv; codecs="'+S.videoCodec+","+S.audioCodec+'"'):S.mimeType='video/x-flv; codecs="'+S.videoCodec+'"',S.isComplete()&&this._onMediaInfo(S)}}var w=s.getUint8(h);if(0===w||1<w)this._onError(DemuxErrors.FORMAT_ERROR,"Flv: Invalid H264 PPS count: "+w);else{for(h++,l=0;l<w;l++)p=s.getUint16(h,!o),h+=2,0!==p&&(h+=p);n.avcc=new Uint8Array(i),n.avcc.set(new Uint8Array(t,e,i),0),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",n)}}}else this._onError(DemuxErrors.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));else this._onError(DemuxErrors.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord")}},Xi.prototype.timestampBase=function(t){this._timestampBase=t},Xi.prototype._parseAVCVideoData=function(t,e,i,n,r,o,s){for(var a,u,d=this._littleEndian,h=new DataView(t,e,i),l=[],p=0,c=0,f=this._naluLengthSize,m=this._timestampBase+n,g=1===o;c<i&&!(i<=c+4);){var y=h.getUint32(c,!d);if(3===f&&(y>>>=8),i-f<y)return;var v=31&h.getUint8(c+f);5==v&&(g=!0);var b=new Uint8Array(t,e+c,f+y),_={type:v,data:b};l.push(_),p+=b.byteLength,c+=f+y}l.length&&(a=this._videoTrack,u={units:l,length:p,isKeyframe:g,dts:m,cts:s,pts:m+s},g&&(u.fileposition=r),a.samples.push(u),a.length+=p)},Xi.prototype._parseAudioData=function(t,e,i,n){if(!(i<=1||!0===this._hasAudioFlagOverrided&&!1===this._hasAudio)){this._littleEndian;var r=new DataView(t,e,i).getUint8(0),o=r>>>4;if(2==o||10==o){var s=0,a=(12&r)>>>2;if(0<=a&&a<=4){s=this._flvSoundRateTable[a];var u=1&r,d=this._audioMetadata,h=this._audioTrack;if(d||(!1===this._hasAudio&&!1===this._hasAudioFlagOverrided&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),(d=this._audioMetadata={}).type="audio",d.id=h.id,d.timescale=this._timescale,d.duration=this._duration,d.audioSampleRate=s,d.channelCount=0==u?1:2),10==o){var l,p,c,f=this._parseAACAudioData(t,e+1,i-1);if(null==f)return;0===f.packetType?(d.config,l=f.data,d.audioSampleRate=l.samplingRate,d.channelCount=l.channelCount,d.codec=l.codec,d.originalCodec=l.originalCodec,d.config=l.config,d.refSampleDuration=1024/d.audioSampleRate*d.timescale,this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",d),(p=this._mediaInfo).audioCodec=d.originalCodec,p.audioSampleRate=d.audioSampleRate,p.audioChannelCount=d.channelCount,p.hasVideo?null!=p.videoCodec&&(p.mimeType='video/x-flv; codecs="'+p.videoCodec+","+p.audioCodec+'"'):p.mimeType='video/x-flv; codecs="'+p.audioCodec+'"',p.isComplete()&&this._onMediaInfo(p)):1===f.packetType?(g=this._timestampBase+n,c={unit:f.data,length:f.data.byteLength,dts:g,pts:g},h.samples.push(c),h.length+=f.data.length):Log.e(this.TAG,"Flv: Unsupported AAC data type "+f.packetType)}else if(2==o){if(!d.codec){if(null==(l=this._parseMP3AudioData(t,e+1,i-1,!0)))return;d.audioSampleRate=l.samplingRate,d.channelCount=l.channelCount,d.codec=l.codec,d.originalCodec=l.originalCodec,d.refSampleDuration=1152/d.audioSampleRate*d.timescale,this._audioInitialMetadataDispatched=!0,this._onTrackMetadata("audio",d),(p=this._mediaInfo).audioCodec=d.codec,p.audioSampleRate=d.audioSampleRate,p.audioChannelCount=d.channelCount,p.audioDataRate=l.bitRate,p.hasVideo?null!=p.videoCodec&&(p.mimeType='video/x-flv; codecs="'+p.videoCodec+","+p.audioCodec+'"'):p.mimeType='video/x-flv; codecs="'+p.audioCodec+'"',p.isComplete()&&this._onMediaInfo(p)}var m=this._parseMP3AudioData(t,e+1,i-1,!1);if(null==m)return;var g=this._timestampBase+n,y={unit:m,length:m.byteLength,dts:g,pts:g};h.samples.push(y),h.length+=m.length}}else this._onError(DemuxErrors.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+a)}else this._onError(DemuxErrors.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+o)}},Xi.prototype._parseAACAudioData=function(t,e,i){if(!(i<=1)){var n={},r=new Uint8Array(t,e,i);return n.packetType=r[0],0===r[0]?n.data=this._parseAACAudioSpecificConfig(t,e+1,i-1):n.data=r.subarray(1),n}},Xi.prototype._parseAACAudioSpecificConfig=function(t,e,i){var n,r=new Uint8Array(t,e,i),o=null,s=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],a=0,u=0,d=null,a=n=r[0]>>>3;if((u=(7&r[0])<<1|r[1]>>>7)<0||s.length<=u)this._onError(DemuxErrors.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");else{var h=s[u],l=(120&r[1])>>>3;if(!(l<0||8<=l)){5===a&&(d=(7&r[1])<<1|r[2]>>>7);var p=self.navigator.userAgent.toLowerCase();return-1!==p.indexOf("firefox")?d=6<=u?(a=5,o=new Array(4),u-3):(a=2,o=new Array(2),u):-1!==p.indexOf("android")?(a=2,o=new Array(2),d=u):(a=5,d=u,o=new Array(4),6<=u?d=u-3:1==l&&(a=2,o=new Array(2),d=u)),o[0]=a<<3,o[0]|=(15&u)>>>1,o[1]=(15&u)<<7,o[1]|=(15&l)<<3,5===a&&(o[1]|=(15&d)>>>1,o[2]=(1&d)<<7,o[2]|=8,o[3]=0),{config:o,samplingRate:h,channelCount:l,codec:"mp4a.40."+a,originalCodec:"mp4a.40."+n}}this._onError(DemuxErrors.FORMAT_ERROR,"Flv: AAC invalid channel configuration")}},Xi.prototype._isInitialMetadataDispatched=function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!this._hasAudio&&this._hasVideo?this._videoInitialMetadataDispatched:void 0},Xi.prototype.destroy=function(){this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null},Xi);function Xi(){var t;this._dataOffset=0,this._firstParse=!0,this._dispatch=!1,this._hasAudio=!1,this._hasVideo=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this.TAG=this.constructor.name,this._config={},this._onError=null,this._onMediaInfo=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._dataOffset=0,this._firstParse=!0,this._dispatch=!1,this._hasAudio=!1,this._hasVideo=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new Mi,this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._videoTrack={type:"video",id:1,sequenceNumber:0,addcoefficient:2,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:1,addcoefficient:2,samples:[],length:0},this._littleEndian=(t=new ArrayBuffer(2),new DataView(t).setInt16(0,256,!0),256===new Int16Array(t)[0])}function Wi(){this.arrTag=[],this.index=0,this.tempArr=[],this.stop=!1,this.offset=0,this.frist=!0,this._hasAudio=!1,this._hasVideo=!1,this.tempUint8=new Uint8Array}var Yi=new(Wi.prototype.setFlv=function(t){return this.stop=!1,this.arrTag=[],this.index=0,this.tempUint8=t,13<this.tempUint8.length&&70==this.tempUint8[0]&&76==this.tempUint8[1]&&86==this.tempUint8[2]?(this.probe(this.tempUint8.buffer),this.read(9),this.read(4),this.parse(),this.frist=!1,this.offset):this.frist?this.offset:this.parse()},Wi.prototype.probe=function(t){var e=new Uint8Array(t),i={match:!1};if(70!==e[0]||76!==e[1]||86!==e[2]||1!==e[3])return i;var n=(4&e[4])>>>2!=0,r=0!=(1&e[4]);if(!n&&!r)return i;var o=this.ReadBig32(e,5);return o<9?i:{match:!0,consumed:o,dataOffset:o,hasAudioTrack:this._hasAudio=qi._hasAudio=n,hasVideoTrack:this._hasVideo=qi._hasVideo=r}},Wi.prototype.parse=function(){for(;this.index<this.tempUint8.length&&!this.stop;){this.offset=this.index;var t=new Ai;11<=this.tempUint8.length-this.index?(t.tagType=this.read(1)[0],t.dataSize=this.read(3),t.Timestamp=this.read(4),t.StreamID=this.read(3),this.tempUint8.length-this.index>=this.getBodySum(t.dataSize)+4?(t.body=this.read(this.getBodySum(t.dataSize)),9==t.tagType&&this._hasVideo&&this.arrTag.push(t),8==t.tagType&&this._hasAudio&&this.arrTag.push(t),18==t.tagType&&this.arrTag.push(t),t.size=this.read(4),this.offset=this.index):this.stop=!0):this.stop=!0}return this.offset},Wi.prototype.read=function(t){var e=this.tempUint8.slice(this.index,this.index+t);return this.index+=t,e},Wi.prototype.getBodySum=function(t){var e="";return e+=1==t[0].toString(16).length?"0"+t[0].toString(16):t[0].toString(16),e+=1==t[1].toString(16).length?"0"+t[1].toString(16):t[1].toString(16),e+=1==t[2].toString(16).length?"0"+t[2].toString(16):t[2].toString(16),parseInt(e,16)},Wi.prototype.ReadBig32=function(t,e){return t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]},Wi),Ki=($i.init=function(){for(var t in $i.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]})$i.types.hasOwnProperty(t)&&($i.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var e=$i.constants={};e.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),e.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),e.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSC=e.STCO=e.STTS,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),e.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),e.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])},$i.box=function(t){for(var e=8,i=null,n=Array.prototype.slice.call(arguments,1),r=n.length,o=0;o<r;o++)e+=n[o].byteLength;(i=new Uint8Array(e))[0]=e>>>24&255,i[1]=e>>>16&255,i[2]=e>>>8&255,i[3]=255&e,i.set(t,4);for(var s=8,o=0;o<r;o++)i.set(n[o],s),s+=n[o].byteLength;return i},$i.generateInitSegment=function(t){t.constructor!=Array&&(t=[t]);var e=$i.box($i.types.ftyp,$i.constants.FTYP),i=$i.moov(t),n=new Uint8Array(e.byteLength+i.byteLength);return n.set(e,0),n.set(i,e.byteLength),n},$i.moov=function(t){var e,i=$i.mvhd(t[0].timescale,t[0].duration),n=$i.trak(t[0]);1<t.length&&(e=$i.trak(t[1]));var r=$i.mvex(t);return 1<t.length?$i.box($i.types.moov,i,n,e,r):$i.box($i.types.moov,i,n,r)},$i.mvhd=function(t,e){return $i.box($i.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t,e>>>24&255,e>>>16&255,e>>>8&255,255&e,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))},$i.trak=function(t){return $i.box($i.types.trak,$i.tkhd(t),$i.mdia(t))},$i.tkhd=function(t){var e=t.id,i=t.duration,n=t.presentWidth,r=t.presentHeight;return $i.box($i.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,e>>>24&255,e>>>16&255,e>>>8&255,255&e,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>>8&255,255&n,0,0,r>>>8&255,255&r,0,0]))},$i.mdia=function(t){return $i.box($i.types.mdia,$i.mdhd(t),$i.hdlr(t),$i.minf(t))},$i.mdhd=function(t){var e=t.timescale,i=t.duration;return $i.box($i.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,e>>>24&255,e>>>16&255,e>>>8&255,255&e,i>>>24&255,i>>>16&255,i>>>8&255,255&i,85,196,0,0]))},$i.hdlr=function(t){var e=null,e="audio"===t.type?$i.constants.HDLR_AUDIO:$i.constants.HDLR_VIDEO;return $i.box($i.types.hdlr,e)},$i.minf=function(t){var e=null,e="audio"===t.type?$i.box($i.types.smhd,$i.constants.SMHD):$i.box($i.types.vmhd,$i.constants.VMHD);return $i.box($i.types.minf,e,$i.dinf(),$i.stbl(t))},$i.dinf=function(){return $i.box($i.types.dinf,$i.box($i.types.dref,$i.constants.DREF))},$i.stbl=function(t){return $i.box($i.types.stbl,$i.stsd(t),$i.box($i.types.stts,$i.constants.STTS),$i.box($i.types.stsc,$i.constants.STSC),$i.box($i.types.stsz,$i.constants.STSZ),$i.box($i.types.stco,$i.constants.STCO))},$i.stsd=function(t){return"audio"===t.type?$i.box($i.types.stsd,$i.constants.STSD_PREFIX,$i.mp4a(t)):$i.box($i.types.stsd,$i.constants.STSD_PREFIX,$i.avc1(t))},$i.mp4a=function(t){var e=t.channelCount,i=t.audioSampleRate,n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e,0,16,0,0,0,0,i>>>8&255,255&i,0,0]);return $i.box($i.types.mp4a,n,$i.esds(t))},$i.esds=function(t){var e=t.config,i=e.length,n=new Uint8Array([0,0,0,0,3,23+i,0,1,0,4,15+i,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([i]).concat(e).concat([6,1,2]));return $i.box($i.types.esds,n)},$i.avc1=function(t){var e=t.avcc,i=t.codecWidth,n=t.codecHeight,r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,i>>>8&255,255&i,n>>>8&255,255&n,0,72,0,0,0,72,0,0,0,0,0,0,0,1,4,103,49,49,49,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return $i.box($i.types.avc1,r,$i.box($i.types.avcC,e))},$i.mvex=function(t){return 1<t.length?$i.box($i.types.mvex,$i.trex(t[0]),$i.trex(t[1])):$i.box($i.types.mvex,$i.trex(t[0]))},$i.trex=function(t){var e=t.id,i=new Uint8Array([0,0,0,0,e>>>24&255,e>>>16&255,e>>>8&255,255&e,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return $i.box($i.types.trex,i)},$i.moof=function(t,e){return $i.box($i.types.moof,$i.mfhd(t.sequenceNumber),$i.traf(t,e))},$i.mfhd=function(t){var e=new Uint8Array([0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t]);return $i.box($i.types.mfhd,e)},$i.traf=function(t,e){var i=t.id,n=$i.box($i.types.tfhd,new Uint8Array([0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i])),r=$i.box($i.types.tfdt,new Uint8Array([0,0,0,0,e>>>24&255,e>>>16&255,e>>>8&255,255&e])),o=$i.sdtp(t),s=$i.trun(t,o.byteLength+16+16+8+16+8+8);return $i.box($i.types.traf,n,r,s,o)},$i.sdtp=function(t){for(var e=t.samples||[],i=e.length,n=new Uint8Array(4+i),r=0;r<i;r++){var o=e[r].flags;n[r+4]=o.isLeading<<6|o.dependsOn<<4|o.isDependedOn<<2|o.hasRedundancy}return $i.box($i.types.sdtp,n)},$i.trun=function(t,e){var i=t.samples||[],n=i.length,r=12+16*n,o=new Uint8Array(r);e+=8+r,o.set([0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,255&n,e>>>24&255,e>>>16&255,e>>>8&255,255&e],0);for(var s=0;s<n;s++){var a=i[s].duration,u=i[s].size,d=i[s].flags,h=i[s].cts;o.set([a>>>24&255,a>>>16&255,a>>>8&255,255&a,u>>>24&255,u>>>16&255,u>>>8&255,255&u,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.isNonSync,0,0,h>>>24&255,h>>>16&255,h>>>8&255,255&h],12+16*s)}return $i.box($i.types.trun,o)},$i.mdat=function(t){return $i.box($i.types.mdat,t)},$i);function $i(){}Ki.init();var Ji=(Zi.getSilentFrame=function(t){return 1===t?new Uint8Array([0,200,0,128,35,128]):2===t?new Uint8Array([33,0,73,144,2,25,0,35,128]):3===t?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]):4===t?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]):5===t?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]):6===t?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]):null},Zi);function Zi(){}var Qi={};!function(){var t,e,i=self.navigator.userAgent.toLowerCase(),n=/(edge)\/([\w.]+)/.exec(i)||/(opr)[\/]([\w.]+)/.exec(i)||/(chrome)[ \/]([\w.]+)/.exec(i)||/(iemobile)[\/]([\w.]+)/.exec(i)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(i)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(i)||/(webkit)[ \/]([\w.]+)/.exec(i)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(i)||/(msie) ([\w.]+)/.exec(i)||0<=i.indexOf("trident")&&/(rv)(?::| )([\w.]+)/.exec(i)||i.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(i)||[],r=/(ipad)/.exec(i)||/(ipod)/.exec(i)||/(windows phone)/.exec(i)||/(iphone)/.exec(i)||/(kindle)/.exec(i)||/(android)/.exec(i)||/(windows)/.exec(i)||/(mac)/.exec(i)||/(linux)/.exec(i)||/(cros)/.exec(i)||[],o={browser:n[5]||n[3]||n[1]||"",version:n[2]||n[4]||"0",majorVersion:n[4]||n[2]||"0",platform:r[0]||""},s={};for(var a in o.browser&&(s[o.browser]=!0,t=o.majorVersion.split("."),s.version={major:parseInt(o.majorVersion,10),string:o.version},1<t.length&&(s.version.minor=parseInt(t[1],10)),2<t.length&&(s.version.build=parseInt(t[2],10))),o.platform&&(s[o.platform]=!0),(s.chrome||s.opr||s.safari)&&(s.webkit=!0),(s.rv||s.iemobile)&&(s.rv&&delete s.rv,o.browser="msie",s.msie=!0),s.edge&&(delete s.edge,o.browser="msedge",s.msedge=!0),s.opr&&(o.browser="opera",s.opera=!0),s.safari&&s.android&&(e="android",s[o.browser=e]=!0),s.name=o.browser,s.platform=o.platform,Qi)Qi.hasOwnProperty(a)&&delete Qi[a];Ui(Qi,s)}();var tn=function(t,e,i,n,r){this.dts=t,this.pts=e,this.duration=i,this.originalDts=n,this.isSyncPoint=r,this.fileposition=null},en=(nn.prototype.appendSyncPoint=function(t){t.isSyncPoint=!0,this.syncPoints.push(t)},nn);function nn(){this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}var rn=(Object.defineProperty(on.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(on.prototype,"length",{get:function(){return this._list.length},enumerable:!1,configurable:!0}),on.prototype.isEmpty=function(){return 0===this._list.length},on.prototype.clear=function(){this._list=[],this._lastAppendLocation=-1},on.prototype._searchNearestSegmentBefore=function(t){var e=this._list;if(0===e.length)return-2;var i,n=e.length-1,r=0,o=n,s=0;if(t<e[0].originalBeginDts)return s=-1;for(;r<=o;){if((i=r+Math.floor((o-r)/2))===n||t>e[i].lastSample.originalDts&&t<e[i+1].originalBeginDts){s=i;break}e[i].originalBeginDts<t?r=i+1:o=i-1}return s},on.prototype._searchNearestSegmentAfter=function(t){return this._searchNearestSegmentBefore(t)+1},on.prototype.append=function(t){var e=this._list,i=t,n=this._lastAppendLocation,r=0;-1!==n&&n<e.length&&i.originalBeginDts>=e[n].lastSample.originalDts&&(n===e.length-1||n<e.length-1&&i.originalBeginDts<e[n+1].originalBeginDts)?r=n+1:0<e.length&&(r=this._searchNearestSegmentBefore(i.originalBeginDts)+1),this._lastAppendLocation=r,this._list.splice(r,0,i)},on.prototype.getLastSegmentBefore=function(t){var e=this._searchNearestSegmentBefore(t);return 0<=e?this._list[e]:null},on.prototype.getLastSampleBefore=function(t){var e=this.getLastSegmentBefore(t);return null!=e?e.lastSample:null},on.prototype.getLastSyncPointBefore=function(t){for(var e=this._searchNearestSegmentBefore(t),i=this._list[e].syncPoints;0===i.length&&0<e;)e--,i=this._list[e].syncPoints;return 0<i.length?i[i.length-1]:null},on);function on(t){this._type=t,this._list=[],this._lastAppendLocation=-1}var sn=(an.prototype.destroy=function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null},an.prototype.bindDataSource=function(t){return t.onDataAvailable=this.remux.bind(this),t.onTrackMetadata=this._onTrackMetadataReceived.bind(this),this},Object.defineProperty(an.prototype,"onInitSegment",{get:function(){return this._onInitSegment},set:function(t){this._onInitSegment=t},enumerable:!1,configurable:!0}),Object.defineProperty(an.prototype,"onMediaSegment",{get:function(){return this._onMediaSegment},set:function(t){this._onMediaSegment=t},enumerable:!1,configurable:!0}),an.prototype.insertDiscontinuity=function(){this._audioNextDts=this._videoNextDts=void 0},an.prototype.seek=function(t){this._videoSegmentInfoList.clear(),this._audioSegmentInfoList.clear()},an.prototype.remux=function(t,e){if(!this._onMediaSegment)throw new IllegalStateException("MP4Remuxer: onMediaSegment callback must be specificed!");this._dtsBaseInited||this._calculateDtsBase(t,e),this._remuxVideo(e),this._remuxAudio(t)},an.prototype._onTrackMetadataReceived=function(t,e){var i=null;if("audio"===t)this._audioMeta=e,i=Ki.generateInitSegment(e),Log.v("msg+audio",e);else{if("video"!==t)return;this._videoMeta=e,i=Ki.generateInitSegment(e),Log.v("msg+video",e)}if(!this._onInitSegment)throw new IllegalStateException("MP4Remuxer: onInitSegment callback must be specified!");this._onInitSegment(t,{type:t,data:i.buffer,codec:e.codec,container:t+"/mp4"})},an.prototype._calculateDtsBase=function(t,e){this._dtsBaseInited||(t.samples&&t.samples.length&&(this._audioDtsBase=t.samples[0].dts),e.samples&&e.samples.length&&(this._videoDtsBase=e.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)},an.prototype._remuxAudio=function(t){if(null!=this._audioMeta){var e=t,i=e.samples,n=void 0,r=-1,o=!1,s=-1;if(this._audioMeta.refSampleDuration,i&&0!==i.length){var a=8+e.length,u=new Uint8Array(a);u[0]=a>>>24&255,u[1]=a>>>16&255,u[2]=a>>>8&255,u[3]=255&a,u.set(Ki.types.mdat,4);for(var d=8,h=[];i.length;){var l,p,c=i.shift(),f=c.unit,m=c.dts-this._dtsBase;null==n&&(null==this._audioNextDts?this._audioSegmentInfoList.isEmpty()?(n=0,this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()&&(o=!0)):n=null!=(l=this._audioSegmentInfoList.getLastSampleBefore(m))?((p=m-(l.originalDts+l.duration))<=3&&(p=0),m-(l.dts+l.duration+p)):0:n=m-this._audioNextDts);var g,y=m-n;if(o&&(null!=(g=this._videoSegmentInfoList.getLastSegmentBefore(m))&&g.beginDts<y?(s=y-g.beginDts,y=g.beginDts):o=!1),-1===r&&(r=y),o){o=!1,i.unshift(c);var v=this._generateSilentAudio(y,s);if(null==v)continue;var b=v.mp4Sample,_=v.unit;h.push(b),a+=_.byteLength,(u=new Uint8Array(a))[0]=a>>>24&255,u[1]=a>>>16&255,u[2]=a>>>8&255,u[3]=255&a,u.set(Ki.types.mdat,4),u.set(_,d),d+=_.byteLength}else{var S=0;S=1<=i.length?i[0].dts-this._dtsBase-n-y:1<=h.length?h[h.length-1].duration:this._audioMeta.refSampleDuration;var w={dts:y,pts:y,cts:0,size:f.byteLength,duration:S,originalDts:m,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};h.push(w),u.set(f,d),d+=f.byteLength}}var T=h[h.length-1],E=T.dts+T.duration;this._audioNextDts=E;var k=new en;k.beginDts=r,k.endDts=E,k.beginPts=r,k.endPts=E,k.originalBeginDts=h[0].originalDts,k.originalEndDts=T.originalDts+T.duration,k.firstSample=new tn(h[0].dts,h[0].pts,h[0].duration,h[0].originalDts,!1),k.lastSample=new tn(T.dts,T.pts,T.duration,T.originalDts,!1),this._isLive||this._audioSegmentInfoList.append(k),e.samples=h,e.sequenceNumber+=e.addcoefficient;var U=Ki.moof(e,r);e.samples=[],e.length=0,this._onMediaSegment("audio",{type:"audio",data:this._mergeBoxes(U,u).buffer,sampleCount:h.length,info:k})}}},an.prototype._generateSilentAudio=function(t,e){Log.v(this.TAG,"GenerateSilentAudio: dts = "+t+", duration = "+e);var i=Ji.getSilentFrame(this._audioMeta.channelCount);return null==i?(Log.w(this.TAG,"Cannot generate silent aac frame for channelCount = "+this._audioMeta.channelCount),null):{unit:i,mp4Sample:{dts:t,pts:t,cts:0,size:i.byteLength,duration:e,originalDts:t,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}}},an.prototype._remuxVideo=function(t){var e=t,i=e.samples,n=-1,r=-1;if(i&&0!==i.length){var o=8+t.length,s=new Uint8Array(o);s[0]=o>>>24&255,s[1]=o>>>16&255,s[2]=o>>>8&255,s[3]=255&o,s.set(Ki.types.mdat,4);for(var a=8,u=[],d=new en;i.length;){var h,l,p,c=i.shift(),f=c.isKeyframe,m=c.dts-this._dtsBase;null==p&&(p=null==this._videoNextDts?this._videoSegmentInfoList.isEmpty()||null==(h=this._videoSegmentInfoList.getLastSampleBefore(m))?0:((l=m-(h.originalDts+h.duration))<=3&&(l=0),m-(h.dts+h.duration+l)):m-this._videoNextDts);var g=m-p,y=c.cts,v=g+y;-1===n&&(n=g,r=v);for(var b=0;c.units.length;){var _=c.units.shift().data;s.set(_,a),a+=_.byteLength,b+=_.byteLength}var S,w=0;w=1<=i.length?i[0].dts-this._dtsBase-p-g:1<=u.length?u[u.length-1].duration:this._videoMeta.refSampleDuration,f&&((S=new tn(g,v,w,c.dts,!0)).fileposition=c.fileposition,d.appendSyncPoint(S));var T={dts:g,pts:v,cts:y,size:b,isKeyframe:f,duration:w,originalDts:m,flags:{isLeading:0,dependsOn:f?2:1,isDependedOn:f?1:0,hasRedundancy:0,isNonSync:f?0:1}};u.push(T)}var E,k=u[u.length-1],U=k.dts+k.duration,A=k.pts+k.duration;this._videoNextDts=U,d.beginDts=n,d.endDts=U,d.beginPts=r,d.endPts=A,d.originalBeginDts=u[0].originalDts,d.originalEndDts=k.originalDts+k.duration,d.firstSample=new tn(u[0].dts,u[0].pts,u[0].duration,u[0].originalDts,u[0].isKeyframe),d.lastSample=new tn(k.dts,k.pts,k.duration,k.originalDts,k.isKeyframe),this._isLive||this._videoSegmentInfoList.append(d),e.samples=u,e.sequenceNumber+=e.addcoefficient,this._forceFirstIDR&&((E=u[0].flags).dependsOn=2,E.isNonSync=0);var x=Ki.moof(e,n);e.samples=[],e.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(x,s).buffer,sampleCount:u.length,info:d})}},an.prototype._mergeBoxes=function(t,e){var i=new Uint8Array(t.byteLength+e.byteLength);return i.set(t,0),i.set(e,t.byteLength),i},an);function an(t){this.TAG=this.constructor.name,this._config=t,this._isLive=!0===t.isLive,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new rn("audio"),this._videoSegmentInfoList=new rn("video"),this._onInitSegment=null,this._onMediaSegment=null,this._forceFirstIDR=!(!Qi.chrome||!(Qi.version.major<50||50===Qi.version.major&&Qi.version.build<2661)),this._fillSilentAfterSeek=Qi.msedge||Qi.msie}var un=(dn.prototype.seek=function(t){this.setflvBase=this.setflvBasefrist,null!=t&&0!=t||(t=0,this._pendingResolveSeekPoint=-1),this._tempBaseTime!=t&&(this._tempBaseTime=t,this.tagDemux._timestampBase=t,this.m4mof.seek(t),this._pendingResolveSeekPoint=t)},dn.prototype.insertDiscontinuity=function(){this.m4mof.insertDiscontinuity()},dn.prototype.setflvBasefrist=function(t,e){var i=Yi.setFlv(new Uint8Array(t));return 18!=Yi.arrTag[0].type&&this.error&&this.error(new Error("without metadata tag")),0<Yi.arrTag.length&&(this.tagDemux.hasAudio=this.hasAudio=Yi._hasAudio,this.tagDemux.hasVideo=this.hasVideo=Yi._hasVideo,0!=this._tempBaseTime&&this._tempBaseTime==Yi.arrTag[0].getTime()&&(this.tagDemux._timestampBase=0),i=this.tagDemux.moofTag(t,e),this.setflvBase=this.setflvBaseUsually),i},dn.prototype.setflvBaseUsually=function(t,e){var i=Yi.setFlv(new Uint8Array(t));return 0<Yi.arrTag.length&&(i=this.tagDemux.moofTag(t,e)),i},dn.prototype.onMdiaSegment=function(t,e){var i;this.onMediaSegment&&(e.data=new Uint8Array(e.data).buffer,this.onMediaSegment(e,e)),-1!=this._pendingResolveSeekPoint&&"video"==t&&(i=this._pendingResolveSeekPoint,this._pendingResolveSeekPoint=-1,this.seekCallBack&&this.seekCallBack(i))},dn.prototype.Metadata=function(t,e){switch(t){case"video":if(this.metas.push(e),this.m4mof._videoMeta=e,this.hasVideo)return void this.metaSucc(t,e);break;case"audio":if(this.metas.push(e),this.m4mof._audioMeta=e,this.hasAudio)return void this.metaSucc(t,e)}this.hasVideo&&this.hasAudio&&1<=this.metas.length&&this.metaSucc(t,e)},dn.prototype.metaSucc=function(t,e){if(void 0!==t&&void 0!==e){var i=null,n="mp4",r=e.codec;if("audio"===t)i="mp3"===(this._audioMeta=e).codec&&this._mp3UseMpegAudio?(n="mpeg",r="",new Uint8Array):Ki.generateInitSegment(e);else{if("video"!==t)return;this._videoMeta=e,i=Ki.generateInitSegment(e)}this.onInitSegment,this.onInitSegment&&(this.onInitSegment(t,{type:t,data:i.buffer,codec:r,container:t+"/"+n,mediaDuration:e.duration}),this.loadmetadata=!0)}},dn.prototype.onDataAvailable=function(t,e){this.m4mof.remux(t,e)},dn.prototype.setflv=function(t,e){return this.setflvBase(t,e)},dn.prototype.setflvloc=function(t){if(Yi.setFlv(new Uint8Array(t)),0<Yi.arrTag.length)return Yi.arrTag},dn);function dn(t){this.onMediaSegment=null,this.onMediaInfo=null,this.seekCallBack=null,this.loadmetadata=!1,this.ftyp_moov=null,this.metaSuccRun=!1,this.metas=[],this.parseChunk=null,this.hasVideo=!1,this.hasAudio=!1,this._pendingResolveSeekPoint=-1,this._tempBaseTime=0,this._config={_isLive:!1},this._config=Ui(this._config,t),this.onInitSegment=null,this.onMediaSegment=null,this.onMediaInfo=null,this.seekCallBack=null,this.loadmetadata=!1,this.ftyp_moov=null,this.metaSuccRun=!1,this.metas=[],this.parseChunk=null,this.hasVideo=!1,this.hasAudio=!1,this._pendingResolveSeekPoint=-1,this._tempBaseTime=0,this.setflvBase=this.setflvBasefrist,this.tagDemux=new qi,this.tagDemux._onTrackMetadata=this.Metadata.bind(this),this.tagDemux._onMediaInfo=this.metaSucc.bind(this),this.tagDemux._onDataAvailable=this.onDataAvailable.bind(this),this.m4mof=new sn(this._config),this.m4mof.onMediaSegment=this.onMdiaSegment.bind(this)}var hn=(ln.prototype.seek=function(t){this.f2m.seek(t)},ln.prototype.setflv=function(t,e){return this.f2m.setflv(t,e)},ln.prototype.insertDiscontinuity=function(){this.f2m.insertDiscontinuity()},ln.prototype.setflvloc=function(t){return this.f2m.setflvloc(t)},ln.prototype.close=function(){this.f2m.m4mof.destroy(),this.f2m.tagDemux.destroy()},Object.defineProperty(ln.prototype,"onInitSegment",{set:function(t){this._onInitSegment=t,this.f2m.onInitSegment=t},enumerable:!1,configurable:!0}),Object.defineProperty(ln.prototype,"onMediaSegment",{set:function(t){this._onMediaSegment=t,this.f2m.onMediaSegment=t},enumerable:!1,configurable:!0}),Object.defineProperty(ln.prototype,"onMediaInfo",{set:function(t){this._onMediaInfo=t,this.f2m.onMediaInfo=t},enumerable:!1,configurable:!0}),Object.defineProperty(ln.prototype,"seekCallBack",{set:function(t){this._seekCallBack=t,this.f2m.seekCallBack=t},enumerable:!1,configurable:!0}),ln);function ln(t){this.f2m=new un(t),this._onInitSegment=null,this._onMediaSegment=null,this._onMediaInfo=null,this._seekCallBack=null}var pn=(cn.prototype.mediaSoureInit=function(){var t=this;this.mediaSoure=new MediaSource,this.mediaSoure.addEventListener("sourceopen",this.sourceopenInit.bind(this),{once:!0}),this.mediaSoure.addEventListener("sourceended",function(){},{once:!0}),this.mediaSoure.addEventListener("sourceclose",function(){},{once:!0}),this.mediaSourceObjectURL=window.URL.createObjectURL(this.mediaSoure),je.options_.play.src=this.mediaSourceObjectURL,this.listeneVisibilitychange();var e=setTimeout(function(){je.videoForegin.hooks.initMediaSoureComplete&&je.videoForegin.hooks.initMediaSoureComplete(t.mediaSoure),clearTimeout(e)},0)},cn.prototype.detachMediaElement=function(){if(this.mediaSoure){var t=this.mediaSoure;for(var e in this.sourceBuffers){var i=this.pendingSegments[e];i.splice(0,i.length),this.pendingSegments[e]=null,this.pendingRemoveRanges[e]=null,this.lastInitSegments[e]=null;var n=this.sourceBuffers[e];if(n){if("closed"!==t.readyState){try{t.removeSourceBuffer(n)}catch(t){je.sendError(t)}n.removeEventListener("updatestart",this.sourceBufferUpdatestart.bind(this)),n.removeEventListener("update",this.sourceBufferUpdate.bind(this)),n.removeEventListener("updateend",this.sourceBufferUpdateend.bind(this)),n.removeEventListener("error",this.sourceBufferError.bind(this)),n.removeEventListener("abort",this.sourceBufferAbort.bind(this))}this.mimeTypes[e]=null,this.sourceBuffers[e]=null}}if("open"===t.readyState)try{t.endOfStream()}catch(t){je.sendError(t)}t.removeEventListener("sourceopen",this.sourceopenInit.bind(this)),t.removeEventListener("sourceended",function(){}),t.removeEventListener("sourceclose",function(){}),this.pendingSourceBufferInit=[],this.isBufferFull=!1,this.mediaSoure=null}je.options_.play&&(je.options_.play.src="",je.options_.play.removeAttribute("src")),this.mediaSourceObjectURL&&(window.URL.revokeObjectURL(this.mediaSourceObjectURL),this.mediaSourceObjectURL=null)},cn.prototype.removeBuffers=function(){for(var t in this.sourceBuffers)if(this.sourceBuffers[t]){var e=this.sourceBuffers[t];if("open"===this.mediaSoure.readyState)try{e.abort()}catch(t){je.sendError(t)}var i=this.pendingSegments[t];if(i.splice(0,i.length),"closed"!==this.mediaSoure.readyState){for(var n=0;n<e.buffered.length;n++){var r=e.buffered.start(n),o=e.buffered.end(n);this.pendingRemoveRanges[t].push({start:r,end:o})}e.updating||this.doRemoveRanges()}}},cn.prototype.sourceopenInit=function(){if(0<this.pendingSourceBufferInit.length)for(var t=this.pendingSourceBufferInit;t.length;){var e=t.shift();this.appendInitSegment(e,!0)}this.hasPendingSegments()&&this.doAppendSegments()},cn.prototype.appendMediaSegment=function(t){var e=t;this.pendingSegments[e.type].push(e),this.needCleanupSourceBuffer()&&this.doCleanupSourceBuffer();var i=this.sourceBuffers[e.type];!i||i.updating||this.hasPendingRemoveRanges()||this.doAppendSegments()},cn.prototype.appendInitSegment=function(t,e){if(!this.mediaSoure||"open"!==this.mediaSoure.readyState)return this.pendingSourceBufferInit.push(t.data),void this.pendingSegments[t.type].push(t);var i=t,n=""+i.container;i.codec&&0<i.codec.length&&(n+=";codecs="+i.codec);var r=!1;if(this.lastInitSegments[i.type]=i,n!==this.mimeTypes[i.type]){if(this.mimeTypes[i.type])je.sendError({message:"Notice: "+i.type+" mimeType changed, origin: "+this.mimeTypes[i.type]+", target: "+n});else{r=!0;try{var o=this.sourceBuffers[i.type]=this.mediaSoure.addSourceBuffer(n);o.addEventListener("updatestart",this.sourceBufferUpdatestart.bind(this)),o.addEventListener("update",this.sourceBufferUpdate.bind(this)),o.addEventListener("updateend",this.sourceBufferUpdateend.bind(this)),o.addEventListener("error",this.sourceBufferError.bind(this)),o.addEventListener("abort",this.sourceBufferAbort.bind(this)),je.videoForegin.hooks.initSourceBuffers&&je.videoForegin.hooks.initSourceBuffers(i.type,this.sourceBuffers[i.type])}catch(t){return void je.sendError(t)}}this.mimeTypes[i.type]=n}e||this.pendingSegments[i.type].push(i),r||this.sourceBuffers[i.type]&&!this.sourceBuffers[i.type].updating&&this.doAppendSegments()},cn.prototype.doAppendSegments=function(){var t=this.pendingSegments;for(var e in t)if(this.sourceBuffers[e]&&!this.sourceBuffers[e].updating&&0<t[e].length){var i,n,r=t[e].shift();if(r.timestampOffset&&(i=this.sourceBuffers[e].timestampOffset,n=r.timestampOffset/1e3,.1<Math.abs(i-n)&&(this.sourceBuffers[e].timestampOffset=n),delete r.timestampOffset),!r.data||0===r.data.byteLength)continue;try{this.sourceBuffers[e].appendBuffer(r.data),this.laseSourceBuffer=r.data,this.isBufferFull=!1}catch(t){this.pendingSegments[e].unshift(r),22===t.code&&(this.isBufferFull||this._onmseBufferFull(),this.isBufferFull=!0),je.sendError(t)}}},cn.prototype.sourceBufferUpdateend=function(){this.hasPendingRemoveRanges()?this.doRemoveRanges():this.hasPendingSegments()&&this.doAppendSegments(),this._onMediaSegment(),je.videoForegin.hooks.sourceBufferUpdateend&&je.videoForegin.hooks.sourceBufferUpdateend()},cn.prototype.doCleanupSourceBuffer=function(){var t=je.options_.play.currentTime;for(var e in this.sourceBuffers){var i=this.sourceBuffers[e];if(i){for(var n=i.buffered,r=!1,o=0;o<n.length;o++){var s,a=n.start(o),u=n.end(o);a<=t&&t<u+3?t-a>=this.autoCleanupMaxBackwardDuration&&(r=!0,s=t-this.autoCleanupMinBackwardDuration,this.pendingRemoveRanges[e].push({start:a,end:s})):u<t&&(r=!0,this.pendingRemoveRanges[e].push({start:a,end:u}))}r&&!i.updating&&this.doRemoveRanges()}}},cn.prototype.doRemoveRanges=function(){for(var t in this.pendingRemoveRanges)if(this.sourceBuffers[t]&&!this.sourceBuffers[t].updating)for(var e=this.sourceBuffers[t],i=this.pendingRemoveRanges[t];i.length&&!e.updating;){var n=i.shift();e.remove(n.start,n.end)}},cn.prototype.hasPendingSegments=function(){var t=this.pendingSegments;return!(!t.video||!t.audio)&&(0<t.video.length||0<t.audio.length)},cn.prototype.hasPendingRemoveRanges=function(){var t=this.pendingRemoveRanges;return!(!t.video||!t.audio)&&(0<t.video.length||0<t.audio.length)},cn.prototype.needCleanupSourceBuffer=function(){var t=je.options_.play.currentTime;for(var e in this.sourceBuffers){var i=this.sourceBuffers[e];if(i){var n=i.buffered;if(1<=n.length&&t-n.start(0)>=this.autoCleanupMaxBackwardDuration)return!0}}return!1},cn.prototype.sourceBufferError=function(t){this.error=!0,je.sendError(t)},cn.prototype.sourceBufferUpdatestart=function(){},cn.prototype.sourceBufferUpdate=function(){},cn.prototype.sourceBufferAbort=function(){},cn.prototype.listeneVisibilitychange=function(){var t=this;document.addEventListener("visibilitychange",function(){"visible"===document.visibilityState&&t.sourceBuffers.video&&(je.options_.play.currentTime=t.sourceBuffers.video.buffered.end(0)-.2)})},Object.defineProperty(cn.prototype,"onmseUpdateEnd",{set:function(t){this._onMediaSegment=t},enumerable:!1,configurable:!0}),Object.defineProperty(cn.prototype,"onmseBufferFull",{set:function(t){this._onmseBufferFull=t},enumerable:!1,configurable:!0}),cn);function cn(){this.pendingSourceBufferInit=[],this.mimeTypes={video:null,audio:null},this.sourceBuffers={video:null,audio:null},this.lastInitSegments={video:null,audio:null},this.pendingSegments={video:[],audio:[]},this.pendingRemoveRanges={video:[],audio:[]},this.autoCleanupMaxBackwardDuration=120,this.autoCleanupMinBackwardDuration=60,this.error=!1,this.firstInitSegment=!1,this._onMediaSegment=null,this._onmseBufferFull=null,this.isBufferFull=!1,this.laseSourceBuffer=null,this.mediaSourceObjectURL="",this.mediaSoureInit()}var fn=(mn.prototype.msectlDestroy=function(){this.mseControll.detachMediaElement(),this.mseControll=null},mn.prototype.unload=function(){je.options_.play&&je.options_.play.pause(),this.mseControll&&this.mseControll.removeBuffers()},mn.prototype.destroy=function(){null!=this.progressChecker&&(window.clearInterval(this.progressChecker),this.progressChecker=null),this.kernel&&(this.kernel.close(),this.kernel=null,this.unload()),this.fetchReader&&this.fetchReader.cancel()},mn.prototype.onMediaSegment=function(t){this.initSegment&&(je.options_.play.paused&&(this.updateTimeOnResume=!0),this.mseControll.appendMediaSegment(t))},mn.prototype.onInitSegment=function(t,e){this.mseControll.appendInitSegment(e,!1),this.initSegment||(this.initSegment=!0)},mn.prototype.send=function(t){var i=this,e=(this.dataSource=t).url,n=this,r=new Headers;fetch(e,{method:"GET",headers:r,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"}).then(function(t){var e=t.body.getReader();return i.kernel.onMediaSegment=i.onMediaSegment.bind(i),i.kernel.onInitSegment=i.onInitSegment.bind(i),je.videoForegin.hooks.sendRequestStart&&je.videoForegin.hooks.sendRequestStart(),i.pump.call(n,e)}).catch(function(t){je.sendError({message:t.message})})},mn.prototype.pump=function(n){var r=this;return this.fetchReader=n,this.isFistSend?n.read().then(function(t){if(r.onError)return n.cancel();if(t.done)return n.cancel();je.videoForegin.hooks.getStreamComplete&&je.videoForegin.hooks.getStreamComplete();var e=t.value.buffer,i=r.range.from+r.receivedLength;return r.receivedLength+=e.byteLength,r.onDataArrival(e,i),r.pump(n)}):(this.isFistSend=!0,this.pump(n))},mn.prototype.onDataArrival=function(t,e){var i,n,r,o,s,a,u;this.isFistSend?null!=this.kernel&&(je.videoForegin.hooks.dataArrival&&je.videoForegin.hooks.dataArrival(),this.addBytes(t.byteLength),i=this.lastSecondKBps(),this.paused||(0!==i&&(n=this.normalizeSpeed(i),this.speedNormalized!==n&&(this.speedNormalized=n,this.adjustStashSize(n))),0===this.stashUsed&&0===this.stashByteStart&&(this.stashByteStart+=e),this.stashUsed+t.byteLength<=this.stashSize?((u=new Uint8Array(this.stashBuffer,0,this.stashSize)).set(new Uint8Array(t),this.stashUsed),this.stashUsed+=t.byteLength):(u=new Uint8Array(this.stashBuffer,0,this.bufferSize),0<this.stashUsed?(r=this.stashBuffer.slice(0,this.stashUsed),this.currentRange.to=e+r.byteLength-1,(s=this.kernel.setflv(r,this.stashByteStart))<r.byteLength?0<s&&(o=new Uint8Array(r,s),u.set(o,0),this.stashUsed=o.byteLength,this.stashByteStart+=s):(this.stashUsed=0,this.stashByteStart+=s),this.stashUsed+t.byteLength>this.bufferSize&&(this.expandBuffer(this.stashUsed+t.byteLength),u=new Uint8Array(this.stashBuffer,0,this.bufferSize)),u.set(new Uint8Array(t),this.stashUsed),this.stashUsed+=t.byteLength):(this.currentRange.to=e+t.byteLength-1,(s=this.kernel.setflv(t,e))<t.byteLength&&((a=t.byteLength-s)>this.bufferSize&&(this.expandBuffer(a),u=new Uint8Array(this.stashBuffer,0,this.bufferSize)),u.set(new Uint8Array(t,s),0),this.stashUsed+=a,this.stashByteStart=e+s))))):this.isFistSend=!0},mn.prototype.lastSecondKBps=function(){return this.addBytes(0),0!==this.lastSecondBytes?this.lastSecondBytes/1024:500<=this.now()-this.lastCheckpoint?this.currentKBps():0},mn.prototype.currentKBps=function(){this.addBytes(0);var t=(this.now()-this.lastCheckpoint)/1e3;return 0==t&&(t=1),this.intervalBytes/t/1024},mn.prototype.addBytes=function(t){0===this.firstCheckpoint?(this.firstCheckpoint=this.now(),this.lastCheckpoint=this.firstCheckpoint,this.intervalBytes+=t,this.totalBytes+=t):this.now()-this.lastCheckpoint<1e3?(this.intervalBytes+=t,this.totalBytes+=t):(this.lastSecondBytes=this.intervalBytes,this.intervalBytes=t,this.totalBytes+=t,this.lastCheckpoint=this.now())},mn.prototype.normalizeSpeed=function(t){var e,i=this.speedNormalizeList,n=i.length-1,r=0,o=n;if(t<i[0])return i[0];for(;r<=o;){if((e=r+Math.floor((o-r)/2))===n||t>=i[e]&&t<i[e+1])return i[e];i[e]<t?r=e+1:o=e-1}},mn.prototype.adjustStashSize=function(t){var e=0;8192<(e=t)&&(e=8192);var i=1024*e+1048576;this.bufferSize<i&&this.expandBuffer(i),this.stashSize=1024*e},mn.prototype.expandBuffer=function(t){for(var e,i,n=this.stashSize;n+1048576<t;)n*=2;(n+=1048576)!==this.bufferSize&&(e=new ArrayBuffer(n),0<this.stashUsed&&(i=new Uint8Array(this.stashBuffer,0,this.stashUsed),new Uint8Array(e,0,n).set(i,0)),this.stashBuffer=e,this.bufferSize=n)},mn.prototype.onmseBufferFull=function(){je.sendError({message:"MSE SourceBuffer is full, suspend transmuxing task"}),this.pause(),null==this.progressChecker&&(this.progressChecker=window.setInterval(this.checkProgressAndResume.bind(this),1e3))},mn.prototype.onmseUpdateEnd=function(){if(this.lazyLoad&&!this.live){for(var t=je.options_.play.buffered,e=je.options_.play.currentTime,i=0,n=0;n<t.length;n++){var r=t.start(n),o=t.end(n);if(r<=e&&e<o){i=o;break}}i>=e+this.lazyLoadMaxDuration&&null==this.progressChecker&&(this.pause(),null==this.progressChecker&&(this.progressChecker=window.setInterval(this.checkProgressAndResume.bind(this),1e3)))}},mn.prototype.checkProgressAndResume=function(){for(var t=je.options_.play.currentTime,e=je.options_.play.buffered,i=!1,n=0;n<e.length;n++){var r=e.start(n),o=e.end(n);if(r<=t&&t<o){t>=o-this.lazyLoadRecoverDuration&&(i=!0);break}}i&&(window.clearInterval(this.progressChecker),this.progressChecker=null,i&&this.resume())},mn.prototype.pause=function(){0!==this.stashUsed?(this.resumeFrom=this.stashByteStart,this.currentRange.to=this.stashByteStart-1):this.resumeFrom=this.currentRange.to+1,this.stashUsed=0,this.stashByteStart=0,this.paused=!0},mn.prototype.resume=function(){var t;this.paused&&(this.paused=!1,t=this.resumeFrom,this.resumeFrom=0,this.internalSeek(t,!0))},mn.prototype.internalSeek=function(t,e){this.flushStashBuffer(e);var i={from:t,to:-1};this.currentRange={from:i.from,to:-1},this.reset(),this.stashSize=this.stashInitialSize,this.kernel.insertDiscontinuity()},mn.prototype.reset=function(){this.firstCheckpoint=this.lastCheckpoint=0,this.totalBytes=this.intervalBytes=0,this.lastSecondBytes=0},mn.prototype.flushStashBuffer=function(t){if(0<this.stashUsed){var e,i,n=this.stashBuffer.slice(0,this.stashUsed),r=this.kernel.setflv(n,this.stashByteStart),o=n.byteLength-r;if(r<n.byteLength){if(!t)return 0<r&&(e=new Uint8Array(this.stashBuffer,0,this.bufferSize),i=new Uint8Array(n,r),e.set(i,0),this.stashUsed=i.byteLength,this.stashByteStart+=r),0;je.sendError({message:"错误-flushStashBuffer"})}return this.stashUsed=0,this.stashByteStart=0,o}return 0},mn);function mn(t){this.range={from:0,to:-1},this.receivedLength=0,this.firstCheckpoint=0,this.lastCheckpoint=0,this.intervalBytes=0,this.totalBytes=0,this.lastSecondBytes=0,this.speedNormalizeList=[64,128,256,384,512,768,1024,1536,2048,3072,4096],this.speedNormalized=0,this.bufferSize=3145728,this.stashSize=393216,this.stashUsed=0,this.stashBuffer=new ArrayBuffer(this.bufferSize),this.stashByteStart=0,this.updateTimeOnResume=!1,this.initSegment=!1,this.resumeFrom=0,this.currentRange={from:0,to:-1},this.paused=!1,this.stashInitialSize=393216,this.lazyLoad=!0,this.lazyLoadMaxDuration=180,this.progressChecker=null,this.lazyLoadRecoverDuration=30,this.live=!0,this.kernel=new hn({_isLive:!0}),this.mseControll=new pn,performance&&performance.now?this.now=performance.now.bind(performance):this.now=Date.now,this.mseControll.onmseUpdateEnd=this.onmseUpdateEnd.bind(this),this.mseControll.onmseBufferFull=this.onmseBufferFull.bind(this),this.isFistSend=t.isFistSend,this.send(t)}var gn,yn=(t(vn,gn=je),vn.prototype.render=function(t,e){this.flvBase=new Si,this.getFlv(t,e),t?je.ischangeSource=!1:je.videoForegin.operation.playVideo()},vn.prototype.getFlv=function(t,e){var i=null!==e?e:this.options_.streamLink.flv;this.ioControll=new fn({url:i,isFistSend:t}),this.fistOpen=!0},vn.prototype.listenerReload=function(){var e=this;document.getElementsByClassName("reload")[0].addEventListener("click",function(t){e.reload(),t.stopPropagation()},!1)},vn.prototype.reload=function(){this.stop(),this.render(!1,null),je.videoForegin.hooks.reLoadComplet&&je.videoForegin.hooks.reLoadComplet()},vn.prototype.changeSource=function(t,e){this.stop(),this.render(!1,t),je.options_.streamLink[e]=t,je.ischangeSource=!0,je.videoForegin.hooks.changeSourceComplet&&je.videoForegin.hooks.changeSourceComplet()},vn.prototype.stop=function(){this.ioControll.unload(),this.detachMediaElement(),this.ioControll.destroy(),this.ioControll=null},vn.prototype.detachMediaElement=function(){je.options_.play&&(this.flvBase.removevideoListen(),this.flvBase=null,this.ioControll.mseControll.detachMediaElement()),this.ioControll&&this.ioControll.msectlDestroy()},vn);function vn(t,e,i){var n=gn.call(this,t,e,i)||this;return n.fistOpen=!1,n.renderOptions={play:t,option:e,ready:i},n.render(!0,null),n.listenerReload(),je.videoForegin.operation.reLoadVideo=n.reload.bind(n),je.videoForegin.operation.changeSource=n.changeSource.bind(n),n}je.setComponents("flv",yn);var bn=(_n.prototype.on=function(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)},_n.prototype.off=function(t,e){if(!this.listeners[t])return!1;var i=this.listeners[t].indexOf(e);return this.listeners[t].splice(i,1),-1<i},_n.prototype.trigger=function(t,e){var i,n,r,o=this.listeners[t];if(o)if(2===arguments.length)for(n=o.length,i=0;i<n;++i)o[i].call(this,e);else for(r=Array.prototype.slice.call(arguments,1),n=o.length,i=0;i<n;++i)o[i].apply(this,r)},_n.prototype.dispose=function(){this.listeners={}},_n.prototype.pipe=function(e){this.on("data",function(t){e.push(t)})},_n);function _n(){this.listeners={}}var Sn,wn=(t(Tn,Sn=bn),Tn.prototype.push=function(t){var e;for(this.buffer+=t,e=this.buffer.indexOf("\n");-1<e;e=this.buffer.indexOf("\n"))this.trigger("data",this.buffer.substring(0,e)),this.buffer=this.buffer.substring(e+1)},Tn);function Tn(){var t=Sn.call(this)||this;return t.buffer="",t}function En(t){for(var e,i=t.split(new RegExp('(?:^|,)((?:[^=]*)=(?:"[^"]*"|[^,]*))')),n={},r=i.length;r--;)""!==i[r]&&((e=/([^=]*)=(.*)/.exec(i[r]).slice(1))[0]=e[0].replace(/^\s+|\s+$/g,""),e[1]=e[1].replace(/^\s+|\s+$/g,""),e[1]=e[1].replace(/^['"](.*)['"]$/g,"$1"),n[e[0]]=e[1]);return n}var kn,Un=(t(An,kn=bn),An.prototype.push=function(n){var u,d,h=this;0!==(n=n.trim()).length&&("#"===n[0]?this.tagMappers.reduce(function(t,e){var i=e(n);return i===n?t:t.concat([i])},[n]).forEach(function(t){for(var e,i,n,r,o,s,a=0;a<h.customParsers.length;a++)if(h.customParsers[a].call(h,t))return;if(0===t.indexOf("#EXT"))if(t=t.replace("\r",""),u=/^#EXTM3U/.exec(t))h.trigger("data",{type:"tag",tagType:"m3u"});else{if(u=/^#EXTINF:?([0-9\.]*)?,?(.*)?$/.exec(t))return d={type:"tag",tagType:"inf"},u[1]&&(d.duration=parseFloat(u[1])),u[2]&&(d.title=u[2]),void h.trigger("data",d);if(u=/^#EXT-X-TARGETDURATION:?([0-9.]*)?/.exec(t))return d={type:"tag",tagType:"targetduration"},u[1]&&(d.duration=parseInt(u[1],10)),void h.trigger("data",d);if(u=/^#ZEN-TOTAL-DURATION:?([0-9.]*)?/.exec(t))return d={type:"tag",tagType:"totalduration"},u[1]&&(d.duration=parseInt(u[1],10)),void h.trigger("data",d);if(u=/^#EXT-X-VERSION:?([0-9.]*)?/.exec(t))return d={type:"tag",tagType:"version"},u[1]&&(d.version=parseInt(u[1],10)),void h.trigger("data",d);if(u=/^#EXT-X-MEDIA-SEQUENCE:?(\-?[0-9.]*)?/.exec(t))return d={type:"tag",tagType:"media-sequence"},u[1]&&(d.number=parseInt(u[1],10)),void h.trigger("data",d);if(u=/^#EXT-X-DISCONTINUITY-SEQUENCE:?(\-?[0-9.]*)?/.exec(t))return d={type:"tag",tagType:"discontinuity-sequence"},u[1]&&(d.number=parseInt(u[1],10)),void h.trigger("data",d);if(u=/^#EXT-X-PLAYLIST-TYPE:?(.*)?$/.exec(t))return d={type:"tag",tagType:"playlist-type"},u[1]&&(d.playlistType=u[1]),void h.trigger("data",d);if(u=/^#EXT-X-BYTERANGE:?([0-9.]*)?@?([0-9.]*)?/.exec(t))return d={type:"tag",tagType:"byterange"},u[1]&&(d.length=parseInt(u[1],10)),u[2]&&(d.offset=parseInt(u[2],10)),void h.trigger("data",d);if(u=/^#EXT-X-ALLOW-CACHE:?(YES|NO)?/.exec(t))return d={type:"tag",tagType:"allow-cache"},u[1]&&(d.allowed=!/NO/.test(u[1])),void h.trigger("data",d);if(u=/^#EXT-X-MAP:?(.*)$/.exec(t))return d={type:"tag",tagType:"map"},u[1]&&((e=En(u[1])).URI&&(d.uri=e.URI),e.BYTERANGE&&(n=(i=e.BYTERANGE.split("@"))[0],r=i[1],d.byterange={},n&&(d.byterange.length=parseInt(n,10)),r&&(d.byterange.offset=parseInt(r,10)))),void h.trigger("data",d);if(u=/^#EXT-X-STREAM-INF:?(.*)$/.exec(t))return d={type:"tag",tagType:"stream-inf"},u[1]&&(d.attributes=En(u[1]),d.attributes.RESOLUTION&&(s={},(o=d.attributes.RESOLUTION.split("x"))[0]&&(s.width=parseInt(o[0],10)),o[1]&&(s.height=parseInt(o[1],10)),d.attributes.RESOLUTION=s),d.attributes.BANDWIDTH&&(d.attributes.BANDWIDTH=parseInt(d.attributes.BANDWIDTH,10)),d.attributes["PROGRAM-ID"]&&(d.attributes["PROGRAM-ID"]=parseInt(d.attributes["PROGRAM-ID"],10))),void h.trigger("data",d);if(u=/^#EXT-X-MEDIA:?(.*)$/.exec(t))return d={type:"tag",tagType:"media"},u[1]&&(d.attributes=En(u[1])),void h.trigger("data",d);if(u=/^#EXT-X-ENDLIST/.exec(t))h.trigger("data",{type:"tag",tagType:"endlist"});else if(u=/^#EXT-X-DISCONTINUITY/.exec(t))h.trigger("data",{type:"tag",tagType:"discontinuity"});else{if(u=/^#EXT-X-PROGRAM-DATE-TIME:?(.*)$/.exec(t))return d={type:"tag",tagType:"program-date-time"},u[1]&&(d.dateTimeString=u[1],d.dateTimeObject=new Date(u[1])),void h.trigger("data",d);if(u=/^#EXT-X-KEY:?(.*)$/.exec(t))return d={type:"tag",tagType:"key"},u[1]&&(d.attributes=En(u[1]),d.attributes.IV&&("0x"===d.attributes.IV.substring(0,2).toLowerCase()&&(d.attributes.IV=d.attributes.IV.substring(2)),d.attributes.IV=d.attributes.IV.match(/.{8}/g),d.attributes.IV[0]=parseInt(d.attributes.IV[0],16),d.attributes.IV[1]=parseInt(d.attributes.IV[1],16),d.attributes.IV[2]=parseInt(d.attributes.IV[2],16),d.attributes.IV[3]=parseInt(d.attributes.IV[3],16),d.attributes.IV=new Uint32Array(d.attributes.IV))),void h.trigger("data",d);if(u=/^#EXT-X-START:?(.*)$/.exec(t))return d={type:"tag",tagType:"start"},u[1]&&(d.attributes=En(u[1]),d.attributes["TIME-OFFSET"]=parseFloat(d.attributes["TIME-OFFSET"]),d.attributes.PRECISE=/YES/.test(d.attributes.PRECISE)),void h.trigger("data",d);if(u=/^#EXT-X-CUE-OUT-CONT:?(.*)?$/.exec(t))return d={type:"tag",tagType:"cue-out-cont"},u[1]?d.data=u[1]:d.data="",void h.trigger("data",d);if(u=/^#EXT-X-CUE-OUT:?(.*)?$/.exec(t))return d={type:"tag",tagType:"cue-out"},u[1]?d.data=u[1]:d.data="",void h.trigger("data",d);if(u=/^#EXT-X-CUE-IN:?(.*)?$/.exec(t))return d={type:"tag",tagType:"cue-in"},u[1]?d.data=u[1]:d.data="",void h.trigger("data",d);h.trigger("data",{type:"tag",data:t.slice(4)})}}else h.trigger("data",{type:"comment",text:t.slice(1)})}):this.trigger("data",{type:"uri",uri:n}))},An.prototype.addParser=function(t){var e=this,i=t.expression,n=t.customType,r=t.dataParser,o=t.segment;"function"!=typeof r&&(r=function(t){return t}),this.customParsers.push(function(t){if(i.exec(t))return e.trigger("data",{type:"custom",data:r(t),customType:n,segment:o}),!0})},An.prototype.addTagMapper=function(t){var e=t.expression,i=t.map;this.tagMappers.push(function(t){return e.test(t)?i(t):t})},An);function An(){var t=kn.call(this)||this;return t.customParsers=[],t.tagMappers=[],t}var xn,Cn=(t(Ln,xn=bn),Ln.prototype.push=function(t){this.lineStream.push(t)},Ln.prototype.end=function(){this.lineStream.push("\n")},Ln.prototype.addParser=function(t){this.parseStream.addParser(t)},Ln.prototype.addTagMapper=function(t){this.parseStream.addTagMapper(t)},Ln);function Ln(){var t=xn.call(this)||this;t.lineStream=new wn,t.parseStream=new Un,t.lineStream.pipe(t.parseStream);var r,o,s=t,a=[],u={},d={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},h=0;return t.manifest={allowCache:!0,discontinuityStarts:[],segments:[]},t.parseStream.on("data",function(e){var i,n;function t(){}(new(t.prototype.tag=function(){function t(){}t.prototype["allow-cache"]=function(){this.manifest.allowCache=e.allowed,"allowed"in e||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},t.prototype.byterange=function(){var t={};"length"in e&&((u.byterange=t).length=e.length,"offset"in e||(this.trigger("info",{message:"defaulting offset to zero"}),e.offset=0)),"offset"in e&&((u.byterange=t).offset=e.offset)},t.prototype.endlist=function(){this.manifest.endList=!0},t.prototype.inf=function(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),0<e.duration&&(u.duration=e.duration),0===e.duration&&(u.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=a},t.prototype.key=function(){e.attributes?"NONE"!==e.attributes.METHOD?e.attributes.URI?(e.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),o={method:e.attributes.METHOD||"AES-128",uri:e.attributes.URI},void 0!==e.attributes.IV&&(o.iv=e.attributes.IV)):this.trigger("warn",{message:"ignoring key declaration without URI"}):o=null:this.trigger("warn",{message:"ignoring key declaration without attribute list"})},t.prototype["media-sequence"]=function(){isFinite(e.number)?this.manifest.mediaSequence=e.number:this.trigger("warn",{message:"ignoring invalid media sequence: "+e.number})},t.prototype["discontinuity-sequence"]=function(){isFinite(e.number)?(this.manifest.discontinuitySequence=e.number,h=e.number):this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+e.number})},t.prototype["playlist-type"]=function(){/VOD|EVENT/.test(e.playlistType)?this.manifest.playlistType=e.playlistType:this.trigger("warn",{message:"ignoring unknown playlist type: "+e.playlist})},t.prototype.map=function(){r={},e.uri&&(r.uri=e.uri),e.byterange&&(r.byterange=e.byterange)},t.prototype["stream-inf"]=function(){this.manifest.playlists=a,this.manifest.mediaGroups=this.manifest.mediaGroups||d,e.attributes?(u.attributes||(u.attributes={}),Ui(u.attributes,e.attributes)):this.trigger("warn",{message:"ignoring empty stream-inf attributes"})},t.prototype.media=function(){var t;this.manifest.mediaGroups=this.manifest.mediaGroups||d,e.attributes&&e.attributes.TYPE&&e.attributes["GROUP-ID"]&&e.attributes.NAME?((t=this.manifest.mediaGroups[e.attributes.TYPE])[e.attributes["GROUP-ID"]]=t[e.attributes["GROUP-ID"]]||{},i=t[e.attributes["GROUP-ID"]],(n={default:/yes/i.test(e.attributes.DEFAULT)}).default?n.autoselect=!0:n.autoselect=/yes/i.test(e.attributes.AUTOSELECT),e.attributes.LANGUAGE&&(n.language=e.attributes.LANGUAGE),e.attributes.URI&&(n.uri=e.attributes.URI),e.attributes["INSTREAM-ID"]&&(n.instreamId=e.attributes["INSTREAM-ID"]),e.attributes.CHARACTERISTICS&&(n.characteristics=e.attributes.CHARACTERISTICS),e.attributes.FORCED&&(n.forced=/yes/i.test(e.attributes.FORCED)),i[e.attributes.NAME]=n):this.trigger("warn",{message:"ignoring incomplete or missing media group"})},t.prototype.discontinuity=function(){h+=1,u.discontinuity=!0,this.manifest.discontinuityStarts.push(a.length)},t.prototype["program-date-time"]=function(){void 0===this.manifest.dateTimeString&&(this.manifest.dateTimeString=e.dateTimeString,this.manifest.dateTimeObject=e.dateTimeObject),u.dateTimeString=e.dateTimeString,u.dateTimeObject=e.dateTimeObject},t.prototype.targetduration=function(){!isFinite(e.duration)||e.duration<0?this.trigger("warn",{message:"ignoring invalid target duration: "+e.duration}):this.manifest.targetDuration=e.duration},t.prototype.totalduration=function(){!isFinite(e.duration)||e.duration<0?this.trigger("warn",{message:"ignoring invalid total duration: "+e.duration}):this.manifest.totalDuration=e.duration},t.prototype.start=function(){e.attributes&&!isNaN(e.attributes["TIME-OFFSET"])?this.manifest.start={timeOffset:e.attributes["TIME-OFFSET"],precise:e.attributes.PRECISE}:this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"})},t.prototype["cue-out"]=function(){u.cueOut=e.data},t.prototype["cue-out-cont"]=function(){u.cueOutCont=e.data},t.prototype["cue-in"]=function(){u.cueIn=e.data},((new t)[e.tagType]||function(){}).call(s)},t.prototype.uri=function(){u.uri=e.uri,a.push(u),!this.manifest.targetDuration||"duration"in u||(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),u.duration=this.manifest.targetDuration),o&&(u.key=o),u.timeline=h,r&&(u.map=r),u={}},t.prototype.comment=function(){},t.prototype.custom=function(){e.segment?(u.custom=u.custom||{},u.custom[e.customType]=e.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[e.customType]=e.data)},t))[e.type].call(s)}),t}function Dn(t,e){return void 0===e&&(e={}),fetch(t,e)}i(function(t,e){var i;i=function(){return r={},i.m=n=[function(t,e,i){var n,s=i(1),a=i(5),d=i(2),u=i(6);function r(i,o){return new Promise(function(n,t){var e=!o&&o instanceof s?i:new s(i,o),r=new u(e);r.on("load",function(t){var e={status:t.status,statusText:t.statusText,headers:function(t){var e=new d;if(t.getAllResponseHeaders){var i=t.getAllResponseHeaders()||"";if(/\S/.test(i))for(var n=i.split("\r\n"),r=0;r<n.length;r++){var o,s,a=n[r],u=a.indexOf(": ");0<u&&(o=a.substring(0,u).trim(),s=a.substring(u+2).trim(),e.append(o,s))}}return e}(t),url:"responseURL"in r?r.responseURL:r.getResponseHeader&&/^X-Request-URL:/m.test(r.getAllResponseHeaders())?r.getResponseHeader("X-Request-URL"):void 0},i="response"in t?t.response:t.responseText;n(new a(i,e))}),r.on("error",function(){t(new TypeError("Network request failed"))}),r.on("timeout",function(){t(new TypeError("Network request timeout"))}),r.open(e.method,e.url,!0),e.headers.forEach(function(t,e){r.setRequestHeader(e,t)}),r.send(void 0===e._body?null:e._body)})}[].forEach||(Array.prototype.forEach=function(t,e){for(var i=0,n=this.length;i<n;++i)i in this&&t.call(e,this[i],i,this)}),"司徒正美".trim||(n=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,String.prototype.trim=function(){return this.replace(n,"")}),/\scode\]\s+\}$/.test(window.fetch)||(window.fetch=r),"function"==typeof avalon&&(avalon.fetch=r),t.exports=r},function(t,e,i){var r=i(2),n=i(4);function o(t,e){var i,n=(e=e||{}).body;if(t instanceof o){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||((i=this.headers=new r(t.headers)).map["x-requested-with"]||i.set("X-Requested-With","XMLHttpRequest")),this.method=t.method,this.mode=t.mode,n||(n=t._body,t.bodyUsed=!0)}else this.url=t;if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new r(e.headers)),this.method=(e.method||this.method||"GET").toUpperCase(),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(n)}o.prototype.clone=function(){return new o(this)};function s(){}s.prototype=n.prototype,o.prototype=new s,t.exports=o},function(t,e,i){var n=i(3);function r(t){if(this.map={},t instanceof r)t.forEach(function(t,e){this.append(e,t)},this);else if(t)for(var e in t)t.hasOwnProperty(e)&&this.append(e,t[e])}function o(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function s(t){return"string"!=typeof t&&(t=String(t)),t}r.prototype.append=function(t,e){t=o(t),e=s(e);var i=this.map[t];i||(i=[],this.map[t]=i),i.push(e)},r.prototype.delete=function(t){delete this.map[o(t)]},r.prototype.get=function(t){var e=this.map[o(t)];return e?e[0]:null},r.prototype.getAll=function(t){return this.map[o(t)]||[]},r.prototype.has=function(t){return this.map.hasOwnProperty(o(t))},r.prototype.set=function(t,e){this.map[o(t)]=[s(e)]},r.prototype.forEach=function(e,i){for(var n in this.map)this.map.hasOwnProperty(n)&&this.map[n].forEach(function(t){e.call(i,t,n,this)},this)},r.prototype.keys=function(){var i=[];return this.forEach(function(t,e){i.push(e)}),iteratorFor(i)},r.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),iteratorFor(e)},r.prototype.entries=function(){var i=[];return this.forEach(function(t,e){i.push([e,t])}),iteratorFor(i)},n.iterable&&(r.prototype[Symbol.iterator]=r.prototype.entries),t.exports=r},function(t,e){t.exports={searchParams:"URLSearchParams"in window,iterable:"Symbol"in window&&"iterator"in window,blob:"FileReader"in window&&"Blob"in window&&function(){try{return new Blob,!0}catch(t){return!1}}(),formData:"FormData"in window,arrayBuffer:"ArrayBuffer"in window}},function(t,e,i){var n=i(3);function r(){this.bodyUsed=!1}var o=r.prototype;"text,blob,formData,json,arrayBuffer".replace(/\w+/g,function(r){o[r]=function(){return((t=this).bodyUsed?Promise.reject(new TypeError("Already read")):(t.bodyUsed=!0,Promise.resolve(t._body))).then(function(t){return i=r,n=a(e=t),null!=e&&n&&n!==i?s[i]&&s[i][n]?s[i][n](e):Promise.reject(new Error("Convertion from "+n+" to "+i+" not supported")):Promise.resolve(e);var e,i,n});var t}}),o._initBody=function(t){if(this._body=t,!this.headers.get("content-type"))switch(a(t)){case"text":this.headers.set("content-type","text/plain;charset=UTF-8");break;case"blob":t&&t.type&&this.headers.set("content-type",t.type);break;case"searchParams":this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8")}};var s={text:{json:function(t){return Promise.resolve(JSON.stringify(t))},blob:d,searchParams:function(t){return Promise.resolve(t.toString())}},json:{text:function(t){return Promise.resolve(h(t))},blob:function(t){return d(t).then(h)}},formData:{text:function(t){return e=t,r=new FormData,e.trim().split("&").forEach(function(t){var e,i,n;t&&(i=(e=t.split("=")).shift().replace(/\+/g," "),n=e.join("=").replace(/\+/g," "),r.append(decodeURIComponent(i),decodeURIComponent(n)))}),Promise.resolve(r);var e,r}},blob:{text:function(t){return Promise.resolve(new Blob([t]))},json:function(t){return Promise.resolve(new Blob([JSON.stringify(t)]))}},arrayBuffer:{blob:function(t){return e=t,(i=new FileReader).readAsArrayBuffer(e),u(i);var e,i}}};function a(t){return"string"==typeof t?"text":n.blob&&t instanceof Blob?"blob":n.formData&&t instanceof FormData?"formData":n.searchParams&&t instanceof URLSearchParams?"searchParams":t&&"object"==typeof t?"json":null}function u(i){return new Promise(function(t,e){i.onload=function(){t(i.result)},i.onerror=function(){e(i.error)}})}function d(t){var e=new FileReader;return e.readAsText(t),u(e)}function h(t){try{return JSON.parse(t)}catch(t){throw"Invalid JSON"}}t.exports=r},function(t,e,i){var n=i(2),r=i(4);function o(t,e){e=e||{},this.type="default",this.status=e.status,1223===this.status&&(this.status=204),this.ok=200<=this.status&&this.status<300,this.statusText=e.statusText,this.headers=e.headers instanceof n?e.headers:new n(e.headers),this.url=e.url||"",this._initBody(t)}function s(){}s.prototype=r.prototype,(o.prototype=new s).clone=function(){return new o(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new n(this.headers),url:this.url})},o.error=function(){var t=new o(null,{status:0,statusText:""});return t.type="error",t};var a=[301,302,303,307,308];o.redirect=function(t,e){if(-1===a.indexOf(e))throw new RangeError("Invalid status code");return new o(null,{status:e,headers:{location:t}})},t.exports=o},function(t,e,i){var n=i(7),r=i(8),o=i(9),s=i(10),a=0;function u(t){8===a||9===a?this.core=new o(t):a?a<=7&&("include"===t.credentials?this.core=new r(t):this.core=new n(t)):this.core=new s(t)}window.VBArray&&(a=document.documentMode||(window.XMLHttpRequest?7:6));var d=u.prototype;d.on=function(t,e){this.core.on(t,e)},d.setRequestHeader=function(t,e){this.core.setRequestHeader&&this.core.setRequestHeader(t,e)},d.open=function(t,e,i,n,r){this.core.open&&this.core.open(t,e,i,n,r)},d.send=function(t){this.core.send&&this.core.send(t)},d.abort=function(){this.core.abort&&this.core.abort()},t.exports=u},function(t,e){t.exports=function(t){var e=new ActiveXObject("Microsoft.XMLHTTP");e.onreadystatechange=function(){4===e.readyState&&(/^2\d\d|1224/.test(e.status)?i.load&&i.load(e):i.error&&i.error())};var i={};return e.on=function(t,e){i[t]=e},e.abort=function(){i={}},"number"===t.timeout&&setTimeout(function(){i.timeout&&i.timeout(),e.abort()},t.timeout),e}},function(t,e){function u(e){try{delete window[e]}catch(t){window[e]=void 0}}var i=document.createDocumentFragment(),d="textContent"in document;t.exports=function(n){var r=n.jsonpCallbackFunction||("jsonp"+Math.random()).replace(/0\./,""),o=n.jsonpCallback||"callback",s=document.createElement("script");s.charset&&(s.charset=n.charset),s.onerror=s[d?"onload":"onreadystatechange"]=function(t){var e=/loaded|complete|undefined/i.test(s.readyState);t&&"error"===t.type?a.error&&a.error():e&&setTimeout(function(){s.abort()},0)};var a={};s.on=function(t,e){a[t]=e},s.abort=function(){var t;a={},t=s,i.appendChild(t),i.removeChild(t),t.onload=onerror=onreadystatechange=function(){},u(r)},s.open=function(t,e){window[r]=function(t){a.load&&a.load({status:200,statusText:"ok",response:t}),u(r)};var i=document.getElementsTagName("head")[0];e+=-1===e.indexOf("?")?"?":"&",s.setAttribute("src",e+o+"="+r),i.insertBefore(s,i.firstChild),"number"==typeof n.timeout&&setTimeout(function(){a.timeout&&a.timeout(),s.abort()},n.timeout)}}},function(t,e){t.exports=function(t){var e=new XDomainRequest;"load,error,timeout".replace(/\w+/g,function(t){e["on"+t]=function(){i[t]&&i[t](e)}});var i={};return e.on=function(t,e){i[t]=e},e.onabort=function(){i={}},"number"==typeof t.timeout&&(e.timeout=t.timeout),e}},function(t,e){t.exports=function(t){var e=new XMLHttpRequest;"load,error,timeout".replace(/\w+/g,function(t){e["on"+t]=function(){i[t]&&i[t](e)}});var i={};return e.on=function(t,e){i[t]=e},e.onabort=function(){i={}},"include"===t.credentials&&(e.withCredentials=!0),"responseType"in e&&"Blob"in window&&(e.responseType="blob"),e}}],i.c=r,i.p="",i(0);function i(t){if(r[t])return r[t].exports;var e=r[t]={exports:{},id:t,loaded:!1};return n[t].call(e.exports,e,e.exports,i),e.loaded=!0,e.exports}var n,r},t.exports=i()});function Bn(t){return Mn.stringify.apply(Mn,arguments)}var In,Pn=e(i(function(t){t.exports={default:et,__esModule:!0}})),Mn=B.JSON||(B.JSON={stringify:JSON.stringify}),On=e(i(function(t){t.exports={default:Bn,__esModule:!0}})),Rn=(i(function(t,e){t.exports=function o(s,a,u){function d(i,t){if(!a[i]){if(!s[i]){var e=l;if(!t&&e)return e(i,!0);if(h)return h(i,!0);var n=new Error("Cannot find module '"+i+"'");throw n.code="MODULE_NOT_FOUND",n}var r=a[i]={exports:{}};s[i][0].call(r.exports,function(t){var e=s[i][1][t];return d(e||t)},r,r.exports,o,s,a,u)}return a[i].exports}for(var h=l,t=0;t<u.length;t++)d(u[t]);return d}({1:[function(t,e,i){var n,r=t("../utils/stream.js");(n=function(){var a=new Uint8Array,u=0;n.prototype.init.call(this),this.setTimestamp=function(t){u=t},this.parseId3TagSize=function(t,e){var i=t[e+6]<<21|t[e+7]<<14|t[e+8]<<7|t[e+9],n=t[e+5],r=(16&n)>>4;return r?20+i:10+i},this.parseAdtsSize=function(t,e){var i=(224&t[e+5])>>5,n=t[e+4]<<3,r=6144&t[e+3];return r|n|i},this.push=function(t){var e,i,n,r,o=0,s=0;for(a.length?(r=a.length,(a=new Uint8Array(t.byteLength+r)).set(a.subarray(0,r)),a.set(t,r)):a=t;3<=a.length-s;)if(a[s]!=="I".charCodeAt(0)||a[s+1]!=="D".charCodeAt(0)||a[s+2]!=="3".charCodeAt(0))if(!0&a[s]&&240==(240&a[s+1])){if(a.length-s<7)break;if((o=this.parseAdtsSize(a,s))>a.length)break;n={type:"audio",data:a.subarray(s,s+o),pts:u,dts:u},this.trigger("data",n),s+=o}else s++;else{if(a.length-s<10)break;if((o=this.parseId3TagSize(a,s))>a.length)break;i={type:"timed-metadata",data:a.subarray(s,s+o)},this.trigger("data",i),s+=o}e=a.length-s,a=0<e?a.subarray(s):new Uint8Array}}).prototype=new r,e.exports=n},{"../utils/stream.js":25}],2:[function(t,e,i){var n=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],d=function(t){return t[0]<<21|t[1]<<14|t[2]<<7|t[3]},h=function(t,e,i){return unescape(function(t,e,i){var n,r="";for(n=e;n<i;n++){r+="%"+("00"+t[n].toString(16)).slice(-2)}return r}(t,e,i))};e.exports={parseId3TagSize:function(t,e){var i=t[e+6]<<21|t[e+7]<<14|t[e+8]<<7|t[e+9],n,r;if((t[e+5]&16)>>4){return i+20}return i+10},parseAdtsSize:function(t,e){var i=(t[e+5]&224)>>5,n=t[e+4]<<3,r;return t[e+3]&3<<11|n|i},parseType:function(t,e){if(t[e]==="I".charCodeAt(0)&&t[e+1]==="D".charCodeAt(0)&&t[e+2]==="3".charCodeAt(0)){return"timed-metadata"}else if(t[e]&255===255&&(t[e+1]&240)===240){return"audio"}return null},parseSampleRate:function(t){var e=0;while(e+5<t.length){if(t[e]!==255||(t[e+1]&246)!==240){e++;continue}return n[(t[e+2]&60)>>>2]}return null},parseAacTimestamp:function(t){var e,i,n,r;if(e=10,t[5]&64){e+=4;e+=d(t.subarray(10,14))}do{i=d(t.subarray(e+4,e+8));if(i<1){return null}r=String.fromCharCode(t[e],t[e+1],t[e+2],t[e+3]);if(r==="PRIV"){n=t.subarray(e+10,e+i+10);for(var o=0;o<n.byteLength;o++){if(n[o]===0){var s=h(n,0,o);if(s==="com.apple.streaming.transportStreamTimestamp"){var a=n.subarray(o+1);var u=(a[3]&1)<<30|a[4]<<22|a[5]<<14|a[6]<<6|a[7]>>>2;u*=4;u+=a[7]&3;return u}break}}}e+=10;e+=i}while(e<t.byteLength);return null}}},{}],3:[function(t,e,i){var n,r=t("../utils/stream.js"),h=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];(n=function(){var d;n.prototype.init.call(this),this.push=function(t){var e,i,n,r,o,s,a=0,u=0;if("audio"===t.type)for(d?(r=d,(d=new Uint8Array(r.byteLength+t.data.byteLength)).set(r),d.set(t.data,r.byteLength)):d=t.data;a+5<d.length;)if(255===d[a]&&240==(246&d[a+1])){if(i=2*(1&~d[a+1]),e=(3&d[a+3])<<11|d[a+4]<<3|(224&d[a+5])>>5,o=1024*(1+(3&d[a+6])),s=9e4*o/h[(60&d[a+2])>>>2],n=a+e,d.byteLength<n)return;if(this.trigger("data",{pts:t.pts+u*s,dts:t.dts+u*s,sampleCount:o,audioobjecttype:1+(d[a+2]>>>6&3),channelcount:(1&d[a+2])<<2|(192&d[a+3])>>>6,samplerate:h[(60&d[a+2])>>>2],samplingfrequencyindex:(60&d[a+2])>>>2,samplesize:16,data:d.subarray(a+7+i,n)}),d.byteLength===n)return void(d=void 0);u++,d=d.subarray(n)}else a++},this.flush=function(){this.trigger("done")}}).prototype=new r,e.exports=n},{"../utils/stream.js":25}],4:[function(t,e,i){var u,d,_,n=t("../utils/stream.js"),S=t("../utils/exp-golomb.js");(d=function(){var i,n,r=0;d.prototype.init.call(this),this.push=function(t){var e;for(n=n?((e=new Uint8Array(n.byteLength+t.data.byteLength)).set(n),e.set(t.data,n.byteLength),e):t.data;r<n.byteLength-3;r++)if(1===n[r+2]){i=r+5;break}for(;i<n.byteLength;)switch(n[i]){case 0:if(0!==n[i-1]){i+=2;break}if(0!==n[i-2]){i++;break}for(r+3!==i-2&&this.trigger("data",n.subarray(r+3,i-2));1!==n[++i]&&i<n.length;);r=i-2,i+=3;break;case 1:if(0!==n[i-1]||0!==n[i-2]){i+=3;break}this.trigger("data",n.subarray(r+3,i-2)),r=i-2,i+=3;break;default:i+=3}n=n.subarray(r),i-=r,r=0},this.flush=function(){n&&3<n.byteLength&&this.trigger("data",n.subarray(r+3)),n=null,r=0,this.trigger("done")}}).prototype=new n,_={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0},(u=function(){var i,n,r,o,s,a,b,e=new d;u.prototype.init.call(this),(i=this).push=function(t){"video"===t.type&&(n=t.trackId,r=t.pts,o=t.dts,e.push(t))},e.on("data",function(t){var e={trackId:n,pts:r,dts:o,data:t};switch(31&t[0]){case 5:e.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:e.nalUnitType="sei_rbsp",e.escapedRBSP=s(t.subarray(1));break;case 7:e.nalUnitType="seq_parameter_set_rbsp",e.escapedRBSP=s(t.subarray(1)),e.config=a(e.escapedRBSP);break;case 8:e.nalUnitType="pic_parameter_set_rbsp";break;case 9:e.nalUnitType="access_unit_delimiter_rbsp"}i.trigger("data",e)}),e.on("done",function(){i.trigger("done")}),this.flush=function(){e.flush()},b=function(t,e){var i,n,r=8,o=8;for(i=0;i<t;i++)0!==o&&(n=e.readExpGolomb(),o=(r+n+256)%256),r=0===o?r:o},s=function(t){for(var e,i,n=t.byteLength,r=[],o=1;o<n-2;)0===t[o]&&0===t[o+1]&&3===t[o+2]?(r.push(o+2),o+=2):o++;if(0===r.length)return t;e=n-r.length,i=new Uint8Array(e);var s=0;for(o=0;o<e;s++,o++)s===r[0]&&(s++,r.shift()),i[o]=t[s];return i},a=function(t){var e,i,n,r,o,s,a,u,d,h,l,p,c,f=0,m=0,g=0,y=0,v=1;if(e=new S(t),i=e.readUnsignedByte(),r=e.readUnsignedByte(),n=e.readUnsignedByte(),e.skipUnsignedExpGolomb(),_[i]&&(3===(o=e.readUnsignedExpGolomb())&&e.skipBits(1),e.skipUnsignedExpGolomb(),e.skipUnsignedExpGolomb(),e.skipBits(1),e.readBoolean()))for(l=3!==o?8:12,c=0;c<l;c++)e.readBoolean()&&b(c<6?16:64,e);if(e.skipUnsignedExpGolomb(),0===(s=e.readUnsignedExpGolomb()))e.readUnsignedExpGolomb();else if(1===s)for(e.skipBits(1),e.skipExpGolomb(),e.skipExpGolomb(),a=e.readUnsignedExpGolomb(),c=0;c<a;c++)e.skipExpGolomb();if(e.skipUnsignedExpGolomb(),e.skipBits(1),u=e.readUnsignedExpGolomb(),d=e.readUnsignedExpGolomb(),0===(h=e.readBits(1))&&e.skipBits(1),e.skipBits(1),e.readBoolean()&&(f=e.readUnsignedExpGolomb(),m=e.readUnsignedExpGolomb(),g=e.readUnsignedExpGolomb(),y=e.readUnsignedExpGolomb()),e.readBoolean()&&e.readBoolean()){switch(e.readUnsignedByte()){case 1:p=[1,1];break;case 2:p=[12,11];break;case 3:p=[10,11];break;case 4:p=[16,11];break;case 5:p=[40,33];break;case 6:p=[24,11];break;case 7:p=[20,11];break;case 8:p=[32,11];break;case 9:p=[80,33];break;case 10:p=[18,11];break;case 11:p=[15,11];break;case 12:p=[64,33];break;case 13:p=[160,99];break;case 14:p=[4,3];break;case 15:p=[3,2];break;case 16:p=[2,1];break;case 255:p=[e.readUnsignedByte()<<8|e.readUnsignedByte(),e.readUnsignedByte()<<8|e.readUnsignedByte()]}p&&(v=p[0]/p[1])}return{profileIdc:i,levelIdc:n,profileCompatibility:r,width:Math.ceil((16*(u+1)-2*f-2*m)*v),height:(2-h)*(d+1)*16-2*g-2*y}}}).prototype=new n,e.exports={H264Stream:u,NalByteStream:d}},{"../utils/exp-golomb.js":24,"../utils/stream.js":25}],5:[function(t,e,i){e.exports={adts:t("./adts"),h264:t("./h264")}},{"./adts":3,"./h264":4}],6:[function(t,e,i){var d;(d=function(t,i){var e,n=0,r=16384,o=function(t,e){var i,n=t.position+e;n<t.bytes.byteLength||((i=new Uint8Array(2*n)).set(t.bytes.subarray(0,t.position),0),t.bytes=i,t.view=new DataView(t.bytes.buffer))},s=d.widthBytes||new Uint8Array("width".length),a=d.heightBytes||new Uint8Array("height".length),u=d.videocodecidBytes||new Uint8Array("videocodecid".length);if(!d.widthBytes){for(e=0;e<"width".length;e++)s[e]="width".charCodeAt(e);for(e=0;e<"height".length;e++)a[e]="height".charCodeAt(e);for(e=0;e<"videocodecid".length;e++)u[e]="videocodecid".charCodeAt(e);d.widthBytes=s,d.heightBytes=a,d.videocodecidBytes=u}switch(this.keyFrame=!1,t){case d.VIDEO_TAG:this.length=16,r*=6;break;case d.AUDIO_TAG:this.length=13,this.keyFrame=!0;break;case d.METADATA_TAG:this.length=29,this.keyFrame=!0;break;default:throw new Error("Unknown FLV tag type")}this.bytes=new Uint8Array(r),this.view=new DataView(this.bytes.buffer),this.bytes[0]=t,this.position=this.length,this.keyFrame=i,this.pts=0,this.dts=0,this.writeBytes=function(t,e,i){var n,r=e||0;i=i||t.byteLength,n=r+i,o(this,i),this.bytes.set(t.subarray(r,n),this.position),this.position+=i,this.length=Math.max(this.length,this.position)},this.writeByte=function(t){o(this,1),this.bytes[this.position]=t,this.position++,this.length=Math.max(this.length,this.position)},this.writeShort=function(t){o(this,2),this.view.setUint16(this.position,t),this.position+=2,this.length=Math.max(this.length,this.position)},this.negIndex=function(t){return this.bytes[this.length-t]},this.nalUnitSize=function(){return 0===n?0:this.length-(n+4)},this.startNalUnit=function(){if(0<n)throw new Error("Attempted to create new NAL wihout closing the old one");n=this.length,this.length+=4,this.position=this.length},this.endNalUnit=function(t){var e,i;this.length===n+4?this.length-=4:0<n&&(e=n+4,i=this.length-e,this.position=n,this.view.setUint32(this.position,i),this.position=this.length,t&&t.push(this.bytes.subarray(e,e+i))),n=0},this.writeMetaDataDouble=function(t,e){var i;if(o(this,2+t.length+9),this.view.setUint16(this.position,t.length),this.position+=2,"width"===t)this.bytes.set(s,this.position),this.position+=5;else if("height"===t)this.bytes.set(a,this.position),this.position+=6;else if("videocodecid"===t)this.bytes.set(u,this.position),this.position+=12;else for(i=0;i<t.length;i++)this.bytes[this.position]=t.charCodeAt(i),this.position++;this.position++,this.view.setFloat64(this.position,e),this.position+=8,this.length=Math.max(this.length,this.position),++n},this.writeMetaDataBoolean=function(t,e){var i;for(o(this,2),this.view.setUint16(this.position,t.length),this.position+=2,i=0;i<t.length;i++)o(this,1),this.bytes[this.position]=t.charCodeAt(i),this.position++;o(this,2),this.view.setUint8(this.position,1),this.position++,this.view.setUint8(this.position,e?1:0),this.position++,this.length=Math.max(this.length,this.position),++n},this.finalize=function(){var t,e;switch(this.bytes[0]){case d.VIDEO_TAG:this.bytes[11]=7|(this.keyFrame||i?16:32),this.bytes[12]=i?0:1,t=this.pts-this.dts,this.bytes[13]=(16711680&t)>>>16,this.bytes[14]=(65280&t)>>>8,this.bytes[15]=(255&t)>>>0;break;case d.AUDIO_TAG:this.bytes[11]=175,this.bytes[12]=i?0:1;break;case d.METADATA_TAG:this.position=11,this.view.setUint8(this.position,2),this.position++,this.view.setUint16(this.position,10),this.position+=2,this.bytes.set([111,110,77,101,116,97,68,97,116,97],this.position),this.position+=10,this.bytes[this.position]=8,this.position++,this.view.setUint32(this.position,n),this.position=this.length,this.bytes.set([0,0,9],this.position),this.position+=3,this.length=this.position}return e=this.length-11,this.bytes[1]=(16711680&e)>>>16,this.bytes[2]=(65280&e)>>>8,this.bytes[3]=(255&e)>>>0,this.bytes[4]=(16711680&this.dts)>>>16,this.bytes[5]=(65280&this.dts)>>>8,this.bytes[6]=(255&this.dts)>>>0,this.bytes[7]=(4278190080&this.dts)>>>24,this.bytes[8]=0,this.bytes[9]=0,this.bytes[10]=0,o(this,4),this.view.setUint32(this.length,this.length),this.length+=4,this.position+=4,this.bytes=this.bytes.subarray(0,this.length),this.frameTime=d.frameTime(this.bytes),this}}).AUDIO_TAG=8,d.VIDEO_TAG=9,d.METADATA_TAG=18,d.isAudioFrame=function(t){return d.AUDIO_TAG===t[0]},d.isVideoFrame=function(t){return d.VIDEO_TAG===t[0]},d.isMetaData=function(t){return d.METADATA_TAG===t[0]},d.isKeyFrame=function(t){return d.isVideoFrame(t)?23===t[11]:!!d.isAudioFrame(t)||!!d.isMetaData(t)},d.frameTime=function(t){var e=t[4]<<16;return e|=t[5]<<8,e|=t[6]<<0,e|=t[7]<<24},e.exports=d},{}],7:[function(t,e,i){e.exports={tag:t("./flv-tag"),Transmuxer:t("./transmuxer")}},{"./flv-tag":6,"./transmuxer":8}],8:[function(t,e,i){var f,m,g,y,a,s,u,n=t("../utils/stream.js"),v=t("./flv-tag.js"),b=t("../m2ts/m2ts.js"),_=t("../codecs/adts.js"),S=t("../codecs/h264").H264Stream;a=function(t,e){"number"==typeof e.pts&&(void 0===t.timelineStartInfo.pts?t.timelineStartInfo.pts=e.pts:t.timelineStartInfo.pts=Math.min(t.timelineStartInfo.pts,e.pts)),"number"==typeof e.dts&&(void 0===t.timelineStartInfo.dts?t.timelineStartInfo.dts=e.dts:t.timelineStartInfo.dts=Math.min(t.timelineStartInfo.dts,e.dts))},s=function(t,e){var i=new v(v.METADATA_TAG);return i.dts=e,i.pts=e,i.writeMetaDataDouble("videocodecid",7),i.writeMetaDataDouble("width",t.width),i.writeMetaDataDouble("height",t.height),i},u=function(t,e){var i,n=new v(v.VIDEO_TAG,!0);for(n.dts=e,n.pts=e,n.writeByte(1),n.writeByte(t.profileIdc),n.writeByte(t.profileCompatibility),n.writeByte(t.levelIdc),n.writeByte(255),n.writeByte(225),n.writeShort(t.sps[0].length),n.writeBytes(t.sps[0]),n.writeByte(t.pps.length),i=0;i<t.pps.length;++i)n.writeShort(t.pps[i].length),n.writeBytes(t.pps[i]);return n},(g=function(r){var o,s=[];g.prototype.init.call(this),this.push=function(t){a(r,t),r&&void 0===r.channelcount&&(r.audioobjecttype=t.audioobjecttype,r.channelcount=t.channelcount,r.samplerate=t.samplerate,r.samplingfrequencyindex=t.samplingfrequencyindex,r.samplesize=t.samplesize,r.extraData=r.audioobjecttype<<11|r.samplingfrequencyindex<<7|r.channelcount<<3),t.pts=Math.round(t.pts/90),t.dts=Math.round(t.dts/90),s.push(t)},this.flush=function(){var t,e,i,n=[];if(0!==s.length){for(i=-1/0;s.length;)t=s.shift(),(r.extraData!==o||1e3<=t.pts-i)&&((e=new v(v.METADATA_TAG)).pts=t.pts,e.dts=t.dts,e.writeMetaDataDouble("audiocodecid",10),e.writeMetaDataBoolean("stereo",2===r.channelcount),e.writeMetaDataDouble("audiosamplerate",r.samplerate),e.writeMetaDataDouble("audiosamplesize",16),n.push(e),o=r.extraData,(e=new v(v.AUDIO_TAG,!0)).pts=t.pts,e.dts=t.dts,e.view.setUint16(e.position,r.extraData),e.position+=2,e.length=Math.max(e.length,e.position),n.push(e),i=t.pts),(e=new v(v.AUDIO_TAG)).pts=t.pts,e.dts=t.dts,e.writeBytes(t.data),n.push(e);o=null,this.trigger("data",{track:r,tags:n}),this.trigger("done")}else this.trigger("done")}}).prototype=new n,(m=function(i){var n,r,o=[];m.prototype.init.call(this),this.finishFrame=function(t,e){e&&(n&&i&&i.newMetadata&&(e.keyFrame||0===t.length)&&(t.push(s(n,e.pts)),t.push(u(i,e.pts)),i.newMetadata=!1),e.endNalUnit(),t.push(e))},this.push=function(t){a(i,t),t.pts=Math.round(t.pts/90),t.dts=Math.round(t.dts/90),o.push(t)},this.flush=function(){for(var t,e=[];o.length&&"access_unit_delimiter_rbsp"!==o[0].nalUnitType;)o.shift();if(0!==o.length){for(;o.length;)"seq_parameter_set_rbsp"===(t=o.shift()).nalUnitType?(i.newMetadata=!0,n=t.config,i.width=n.width,i.height=n.height,i.sps=[t.data],i.profileIdc=n.profileIdc,i.levelIdc=n.levelIdc,i.profileCompatibility=n.profileCompatibility,r.endNalUnit()):"pic_parameter_set_rbsp"===t.nalUnitType?(i.newMetadata=!0,i.pps=[t.data],r.endNalUnit()):"access_unit_delimiter_rbsp"===t.nalUnitType?(r&&this.finishFrame(e,r),(r=new v(v.VIDEO_TAG)).pts=t.pts,r.dts=t.dts):("slice_layer_without_partitioning_rbsp_idr"===t.nalUnitType&&(r.keyFrame=!0),r.endNalUnit()),r.startNalUnit(),r.writeBytes(t.data);r&&this.finishFrame(e,r),this.trigger("data",{track:i,tags:e}),this.trigger("done")}else this.trigger("done")}}).prototype=new n,(y=function(t){this.numberOfTracks=0,this.metadataStream=t.metadataStream,this.videoTags=[],this.audioTags=[],this.videoTrack=null,this.audioTrack=null,this.pendingCaptions=[],this.pendingMetadata=[],this.pendingTracks=0,y.prototype.init.call(this),this.push=function(t){return t.text?this.pendingCaptions.push(t):t.frames?this.pendingMetadata.push(t):("video"===t.track.type&&(this.videoTrack=t.track,this.videoTags=t.tags,this.pendingTracks++),void("audio"===t.track.type&&(this.audioTrack=t.track,this.audioTags=t.tags,this.pendingTracks++)))}}).prototype=new n,y.prototype.flush=function(){var t,e,i,n,r={tags:{},captions:[],metadata:[]};if(!(this.pendingTracks<this.numberOfTracks)){for(this.videoTrack?n=this.videoTrack.timelineStartInfo.pts:this.audioTrack&&(n=this.audioTrack.timelineStartInfo.pts),r.tags.videoTags=this.videoTags,r.tags.audioTags=this.audioTags,i=0;i<this.pendingCaptions.length;i++)(e=this.pendingCaptions[i]).startTime=e.startPts-n,e.startTime/=9e4,e.endTime=e.endPts-n,e.endTime/=9e4,r.captions.push(e);for(i=0;i<this.pendingMetadata.length;i++)(t=this.pendingMetadata[i]).cueTime=t.pts-n,t.cueTime/=9e4,r.metadata.push(t);r.metadata.dispatchType=this.metadataStream.dispatchType,this.videoTrack=null,this.audioTrack=null,this.videoTags=[],this.audioTags=[],this.pendingCaptions.length=0,this.pendingMetadata.length=0,this.pendingTracks=0,this.trigger("data",r),this.trigger("done")}},(f=function(t){var e,i,n,r,o,s,a,u,d,h,l,p,c=this;f.prototype.init.call(this),t=t||{},this.metadataStream=new b.MetadataStream,t.metadataStream=this.metadataStream,e=new b.TransportPacketStream,i=new b.TransportParseStream,n=new b.ElementaryStream,r=new b.TimestampRolloverStream("video"),o=new b.TimestampRolloverStream("audio"),s=new b.TimestampRolloverStream("timed-metadata"),a=new _,u=new S,p=new y(t),e.pipe(i).pipe(n),n.pipe(r).pipe(u),n.pipe(o).pipe(a),n.pipe(s).pipe(this.metadataStream).pipe(p),l=new b.CaptionStream,u.pipe(l).pipe(p),n.on("data",function(t){var e,i,n;if("metadata"===t.type){for(e=t.tracks.length;e--;)"video"===t.tracks[e].type?i=t.tracks[e]:"audio"===t.tracks[e].type&&(n=t.tracks[e]);i&&!d&&(p.numberOfTracks++,d=new m(i),u.pipe(d).pipe(p)),n&&!h&&(p.numberOfTracks++,h=new g(n),a.pipe(h).pipe(p))}}),this.push=function(t){e.push(t)},this.flush=function(){e.flush()},p.on("data",function(t){c.trigger("data",t)}),p.on("done",function(){c.trigger("done")}),this.getFlvHeader=function(t,e,i){var n,r,o,s=new Uint8Array(9),a=new DataView(s.buffer);return t=t||0,e=void 0===e||e,i=void 0===i||i,a.setUint8(0,70),a.setUint8(1,76),a.setUint8(2,86),a.setUint8(3,1),a.setUint8(4,(e?4:0)|(i?1:0)),a.setUint32(5,s.byteLength),t<=0?((r=new Uint8Array(s.byteLength+4)).set(s),r.set([0,0,0,0],s.byteLength)):((n=new v(v.METADATA_TAG)).pts=n.dts=0,n.writeMetaDataDouble("duration",t),o=n.finalize().length,(r=new Uint8Array(s.byteLength+o)).set(s),r.set(a.byteLength,o)),r}}).prototype=new n,e.exports=f},{"../codecs/adts.js":3,"../codecs/h264":4,"../m2ts/m2ts.js":12,"../utils/stream.js":25,"./flv-tag.js":6}],9:[function(t,e,i){var n={codecs:t("./codecs"),mp4:t("./mp4"),flv:t("./flv"),mp2t:t("./m2ts")};n.mp4.tools=t("./tools/mp4-inspector"),n.flv.tools=t("./tools/flv-inspector"),n.mp2t.tools=t("./tools/ts-inspector"),e.exports=n,window.muxjs=n},{"./codecs":5,"./flv":7,"./m2ts":11,"./mp4":17,"./tools/flv-inspector":21,"./tools/mp4-inspector":22,"./tools/ts-inspector":23}],10:[function(t,e,i){var o=4,s=128,n=t("../utils/stream"),r=function t(){t.prototype.init.call(this),this.captionPackets_=[],this.field1_=new h,this.field1_.on("data",this.trigger.bind(this,"data")),this.field1_.on("done",this.trigger.bind(this,"done"))};(r.prototype=new n).push=function(t){var e,i;"sei_rbsp"===t.nalUnitType&&4===(e=function(t){var e=0,i={payloadType:-1,payloadSize:0},n=0,r=0;while(e<t.byteLength){if(t[e]===s){break}while(t[e]===255){n+=255;e++}n+=t[e++];while(t[e]===255){r+=255;e++}r+=t[e++];if(!i.payload&&n===o){i.payloadType=n;i.payloadSize=r;i.payload=t.subarray(e,e+r);break}e+=r;n=0;r=0}return i}(t.escapedRBSP)).payloadType&&(i=function(t){return 181===t.payload[0]?49==(t.payload[1]<<8|t.payload[2])&&"GA94"===String.fromCharCode(t.payload[3],t.payload[4],t.payload[5],t.payload[6])&&3===t.payload[7]?t.payload.subarray(8,t.payload.length-1):null:null}(e))&&(this.captionPackets_=this.captionPackets_.concat(function(t,e){var i=[],n,r,o,s;if(!(e[0]&64)){return i}for(r=e[0]&31,n=0;n<r;n++){o=n*3;s={type:e[o+2]&3,pts:t};if(e[o+2]&4){s.ccData=e[o+3]<<8|e[o+4];i.push(s)}}return i}(t.pts,i)))},r.prototype.flush=function(){this.captionPackets_.length&&(this.captionPackets_.forEach(function(t,e){t.presortIndex=e}),this.captionPackets_.sort(function(t,e){return t.pts===e.pts?t.presortIndex-e.presortIndex:t.pts-e.pts}),this.captionPackets_.forEach(this.field1_.push,this.field1_),this.captionPackets_.length=0),this.field1_.flush()};var a={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608},u=function(t){return null===t?"":(t=a[t]||t,String.fromCharCode(t))},d=function(){for(var t=[],e=15;e--;)t.push("");return t},h=function t(){t.prototype.init.call(this),this.mode_="popOn",this.topRow_=0,this.startPts_=0,this.displayed_=d(),this.nonDisplayed_=d(),this.lastControlCode_=null,this.push=function(t){var e,i,n,r;if(0===t.type)if((e=32639&t.ccData)!==this.lastControlCode_)switch(this.lastControlCode_=4096==(61440&e)?e:null,e){case 0:break;case 5152:this.mode_="popOn";break;case 5167:this.flushDisplayed(t.pts),i=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=i,this.startPts_=t.pts;break;case 5157:this.topRow_=13,this.mode_="rollUp";break;case 5158:this.topRow_=12,this.mode_="rollUp";break;case 5159:this.topRow_=11,this.mode_="rollUp";break;case 5165:this.flushDisplayed(t.pts),this.shiftRowsUp_(),this.startPts_=t.pts;break;case 5153:"popOn"===this.mode_?this.nonDisplayed_[14]=this.nonDisplayed_[14].slice(0,-1):this.displayed_[14]=this.displayed_[14].slice(0,-1);break;case 5164:this.flushDisplayed(t.pts),this.displayed_=d();break;case 5166:this.nonDisplayed_=d();break;default:if(r=255&e,16<=(n=e>>>8)&&n<=23&&64<=r&&r<=127&&(16!==n||r<96)&&(n=32,r=null),(17===n||25===n)&&48<=r&&r<=63&&(n=9834,r=""),16==(240&n))return;this[this.mode_](t.pts,n,r)}else this.lastControlCode_=null}};h.prototype=new n,h.prototype.flushDisplayed=function(t){var e=this.displayed_.map(function(t){return t.trim()}).filter(function(t){return t.length}).join("\n");e.length&&this.trigger("data",{startPts:this.startPts_,endPts:t,text:e})},h.prototype.popOn=function(t,e,i){var n=this.nonDisplayed_[14];n+=u(e),n+=u(i),this.nonDisplayed_[14]=n},h.prototype.rollUp=function(t,e,i){var n=this.displayed_[14];""===n&&(this.flushDisplayed(t),this.startPts_=t),n+=u(e),n+=u(i),this.displayed_[14]=n},h.prototype.shiftRowsUp_=function(){var t;for(t=0;t<this.topRow_;t++)this.displayed_[t]="";for(t=this.topRow_;t<14;t++)this.displayed_[t]=this.displayed_[t+1];this.displayed_[14]=""},e.exports={CaptionStream:r,Cea608Stream:h}},{"../utils/stream":25}],11:[function(t,e,i){e.exports=t("./m2ts")},{"./m2ts":12}],12:[function(t,e,i){var n,a,r,o=t("../utils/stream.js"),s=t("./caption-stream"),u=t("./stream-types"),d=t("./timestamp-rollover-stream").TimestampRolloverStream,h=t("./stream-types.js");(n=function(){var r=new Uint8Array(188),o=0;n.prototype.init.call(this),this.push=function(t){var e,i=0,n=188;for(o?((e=new Uint8Array(t.byteLength+o)).set(r.subarray(0,o)),e.set(t,o),o=0):e=t;n<e.byteLength;)71!==e[i]||71!==e[n]?(i++,n++):(this.trigger("data",e.subarray(i,n)),i+=188,n+=188);i<e.byteLength&&(r.set(e.subarray(i),0),o=e.byteLength-i)},this.flush=function(){188===o&&71===r[0]&&(this.trigger("data",r),o=0),this.trigger("done")}}).prototype=new o,(a=function(){var n,r,o,s;a.prototype.init.call(this),(s=this).packetsWaitingForPmt=[],this.programMapTable=void 0,n=function(t,e){var i=0;e.payloadUnitStartIndicator&&(i+=t[i]+1),("pat"===e.type?r:o)(t.subarray(i),e)},r=function(t,e){e.section_number=t[7],e.last_section_number=t[8],s.pmtPid=(31&t[10])<<8|t[11],e.pmtPid=s.pmtPid},o=function(t,e){var i,n,r,o;if(1&t[5]){for(s.programMapTable={},i=(15&t[1])<<8|t[2],n=3+i-4,r=(15&t[10])<<8|t[11],o=12+r;o<n;)s.programMapTable[(31&t[o+1])<<8|t[o+2]]=t[o],o+=5+((15&t[o+3])<<8|t[o+4]);for(e.programMapTable=s.programMapTable;s.packetsWaitingForPmt.length;)s.processPes_.apply(s,s.packetsWaitingForPmt.shift())}},this.push=function(t){var e={},i=4;e.payloadUnitStartIndicator=!!(64&t[1]),e.pid=31&t[1],e.pid<<=8,e.pid|=t[2],1<(48&t[3])>>>4&&(i+=t[i]+1),0===e.pid?(e.type="pat",n(t.subarray(i),e),this.trigger("data",e)):e.pid===this.pmtPid?(e.type="pmt",n(t.subarray(i),e),this.trigger("data",e)):void 0===this.programMapTable?this.packetsWaitingForPmt.push([t,i,e]):this.processPes_(t,i,e)},this.processPes_=function(t,e,i){i.streamType=this.programMapTable[i.pid],i.type="pes",i.data=t.subarray(e),this.trigger("data",i)}}).prototype=new o,a.STREAM_TYPES={h264:27,adts:15},(r=function(){var s=this,i={data:[],size:0},n={data:[],size:0},o={data:[],size:0},a=function(t,e){var i,n=new Uint8Array(t.size),r={type:e},o=0;if(t.data.length){for(r.trackId=t.data[0].pid;t.data.length;)i=t.data.shift(),n.set(i.data,o),o+=i.data.byteLength;!function(t,e){var i;if(e.dataAlignmentIndicator=(t[6]&4)!==0,(i=t[7])&192){e.pts=(t[9]&14)<<27|(t[10]&255)<<20|(t[11]&254)<<12|(t[12]&255)<<5|(t[13]&254)>>>3;e.pts*=4;e.pts+=(t[13]&6)>>>1;e.dts=e.pts;if(i&64){e.dts=(t[14]&14)<<27|(t[15]&255)<<20|(t[16]&254)<<12|(t[17]&255)<<5|(t[18]&254)>>>3;e.dts*=4;e.dts+=(t[18]&6)>>>1}}e.data=t.subarray(9+t[8])}(n,r),t.size=0,s.trigger("data",r)}};r.prototype.init.call(this),this.push=function(r){({pat:function(){},pes:function(){var t,e;switch(r.streamType){case u.H264_STREAM_TYPE:case h.H264_STREAM_TYPE:t=i,e="video";break;case u.ADTS_STREAM_TYPE:t=n,e="audio";break;case u.METADATA_STREAM_TYPE:t=o,e="timed-metadata";break;default:return}r.payloadUnitStartIndicator&&a(t,e),t.data.push(r),t.size+=r.data.byteLength},pmt:function(){var t,e,i={type:"metadata",tracks:[]},n=r.programMapTable;for(t in n)n.hasOwnProperty(t)&&((e={timelineStartInfo:{baseMediaDecodeTime:0}}).id=+t,n[t]===h.H264_STREAM_TYPE?(e.codec="avc",e.type="video"):n[t]===h.ADTS_STREAM_TYPE&&(e.codec="adts",e.type="audio"),i.tracks.push(e));s.trigger("data",i)}})[r.type]()},this.flush=function(){a(i,"video"),a(n,"audio"),a(o,"timed-metadata"),this.trigger("done")}}).prototype=new o;var l={PAT_PID:0,MP2T_PACKET_LENGTH:188,TransportPacketStream:n,TransportParseStream:a,ElementaryStream:r,TimestampRolloverStream:d,CaptionStream:s.CaptionStream,Cea608Stream:s.Cea608Stream,MetadataStream:t("./metadata-stream")};for(var p in u)u.hasOwnProperty(p)&&(l[p]=u[p]);e.exports=l},{"../utils/stream.js":25,"./caption-stream":10,"./metadata-stream":13,"./stream-types":15,"./stream-types.js":15,"./timestamp-rollover-stream":16}],13:[function(t,e,i){var n,r=t("../utils/stream"),o=t("./stream-types"),s=function(t,e,i){var n,r="";for(n=e;n<i;n++)r+="%"+("00"+t[n].toString(16)).slice(-2);return r},a=function(t,e,i){return decodeURIComponent(s(t,e,i))},c=function(t){return t[0]<<21|t[1]<<14|t[2]<<7|t[3]},f={TXXX:function(t){var e;if(3===t.data[0]){for(e=1;e<t.data.length;e++)if(0===t.data[e]){t.description=a(t.data,1,e),t.value=a(t.data,e+1,t.data.length-1);break}t.data=t.value}},WXXX:function(t){var e;if(3===t.data[0])for(e=1;e<t.data.length;e++)if(0===t.data[e]){t.description=a(t.data,1,e),t.url=a(t.data,e+1,t.data.length);break}},PRIV:function(t){var e;for(e=0;e<t.data.length;e++)if(0===t.data[e]){t.owner=function(t,e,i){return unescape(s(t,e,i))}(t.data,0,e);break}t.privateData=t.data.subarray(e+1),t.data=t.privateData}};(n=function(t){var e,d={debug:!(!t||!t.debug),descriptor:t&&t.descriptor},h=0,l=[],p=0;if(n.prototype.init.call(this),this.dispatchType=o.METADATA_STREAM_TYPE.toString(16),d.descriptor)for(e=0;e<d.descriptor.length;e++)this.dispatchType+=("00"+d.descriptor[e].toString(16)).slice(-2);this.push=function(t){var e,i,n,r,o,s,a,u;if("timed-metadata"===t.type)if(t.dataAlignmentIndicator&&(p=0,l.length=0),0===l.length&&(t.data.length<10||t.data[0]!=="I".charCodeAt(0)||t.data[1]!=="D".charCodeAt(0)||t.data[2]!=="3".charCodeAt(0)))d.debug;else if(l.push(t),p+=t.data.byteLength,1===l.length&&(h=c(t.data.subarray(6,10)),h+=10),!(p<h)){for(e={data:new Uint8Array(h),frames:[],pts:l[0].pts,dts:l[0].dts},o=0;o<h;)e.data.set(l[0].data.subarray(0,h-o),o),o+=l[0].data.byteLength,p-=l[0].data.byteLength,l.shift();i=10,64&e.data[5]&&(i+=4,i+=c(e.data.subarray(10,14)),h-=c(e.data.subarray(16,20)));do{if((n=c(e.data.subarray(i+4,i+8)))<1)return;s=String.fromCharCode(e.data[i],e.data[i+1],e.data[i+2],e.data[i+3]),(r={id:s,data:e.data.subarray(i+10,i+n+10)}).key=r.id,f[r.id]&&(f[r.id](r),"com.apple.streaming.transportStreamTimestamp"===r.owner&&(a=r.data,u=(1&a[3])<<30|a[4]<<22|a[5]<<14|a[6]<<6|a[7]>>>2,u*=4,u+=3&a[7],r.timeStamp=u,void 0===e.pts&&void 0===e.dts&&(e.pts=r.timeStamp,e.dts=r.timeStamp),this.trigger("timestamp",r))),e.frames.push(r),i+=10,i+=n}while(i<h);this.trigger("data",e)}}}).prototype=new r,e.exports=n},{"../utils/stream":25,"./stream-types":15}],14:[function(t,e,i){var r=t("./stream-types.js"),o=function(t){var e=31&t[1];return e<<=8,e|=t[2]},d=function(t){return!!(64&t[1])},h=function(t){var e=0;return 1<(48&t[3])>>>4&&(e+=t[4]+1),e},a=function(t){switch(t){case 5:return"slice_layer_without_partitioning_rbsp_idr";case 6:return"sei_rbsp";case 7:return"seq_parameter_set_rbsp";case 8:return"pic_parameter_set_rbsp";case 9:return"access_unit_delimiter_rbsp";default:return null}};e.exports={parseType:function(t,e){var i=o(t);if(i===0){return"pat"}else if(i===e){return"pmt"}else if(e){return"pes"}return null},parsePat:function(t){var e=d(t),i=4+h(t);if(e){i+=t[i]+1}return(t[i+10]&31)<<8|t[i+11]},parsePmt:function(t){var e={},i=d(t),n=4+h(t),r,o,s;if(i){n+=t[n]+1}if(!(t[n+5]&1)){return}r=(t[n+1]&15)<<8|t[n+2],o=3+r-4;var a=12+(s=(t[n+10]&15)<<8|t[n+11]);while(a<o){var u=n+a;e[(t[u+1]&31)<<8|t[u+2]]=t[u];a+=((t[u+3]&15)<<8|t[u+4])+5}return e},parsePayloadUnitStartIndicator:d,parsePesType:function(t,e){var i=o(t),n;switch(e[i]){case r.H264_STREAM_TYPE:return"video";case r.ADTS_STREAM_TYPE:return"audio";case r.METADATA_STREAM_TYPE:return"timed-metadata";default:return null}},parsePesTime:function(t){var e;if(!d(t)){return null}var i=4+h(t),n={},r;if((r=t[i+7])&192){n.pts=(t[i+9]&14)<<27|(t[i+10]&255)<<20|(t[i+11]&254)<<12|(t[i+12]&255)<<5|(t[i+13]&254)>>>3;n.pts*=4;n.pts+=(t[i+13]&6)>>>1;n.dts=n.pts;if(r&64){n.dts=(t[i+14]&14)<<27|(t[i+15]&255)<<20|(t[i+16]&254)<<12|(t[i+17]&255)<<5|(t[i+18]&254)>>>3;n.dts*=4;n.dts+=(t[i+18]&6)>>>1}}return n},videoPacketContainsKeyFrame:function(t){for(var e=4+h(t),i=t.subarray(e),n=0,r=0,o=false,s;r<i.byteLength-3;r++){if(i[r+2]===1){n=r+5;break}}while(n<i.byteLength){switch(i[n]){case 0:if(i[n-1]!==0){n+=2;break}else if(i[n-2]!==0){n++;break}if(r+3!==n-2){s=a(i[r+3]&31);if(s==="slice_layer_without_partitioning_rbsp_idr"){o=true}}do{n++}while(i[n]!==1&&n<i.length);r=n-2;n+=3;break;case 1:if(i[n-1]!==0||i[n-2]!==0){n+=3;break}s=a(i[r+3]&31);if(s==="slice_layer_without_partitioning_rbsp_idr"){o=true}r=n-2;n+=3;break;default:n+=3;break}}if(i=i.subarray(r),n-=r,r=0,i&&i.byteLength>3){s=a(i[r+3]&31);if(s==="slice_layer_without_partitioning_rbsp_idr"){o=true}}return o}}},{"./stream-types.js":15}],15:[function(t,e,i){e.exports={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21}},{}],16:[function(t,e,i){var n=t("../utils/stream"),r=function(t,e){var i=1;for(e<t&&(i=-1);4294967296<Math.abs(e-t);)t+=8589934592*i;return t},o=function t(e){var i,n;t.prototype.init.call(this),this.type_=e,this.push=function(t){t.type===this.type_&&(void 0===n&&(n=t.dts),t.dts=r(t.dts,n),t.pts=r(t.pts,n),i=t.dts,this.trigger("data",t))},this.flush=function(){n=i,this.trigger("done")}};o.prototype=new n,e.exports={TimestampRolloverStream:o,handleRollover:r}},{"../utils/stream":25}],17:[function(t,e,i){e.exports={generator:t("./mp4-generator"),Transmuxer:t("./transmuxer").Transmuxer,AudioSegmentStream:t("./transmuxer").AudioSegmentStream,VideoSegmentStream:t("./transmuxer").VideoSegmentStream}},{"./mp4-generator":18,"./transmuxer":20}],18:[function(t,e,i){var a,n,r,o,s,u,d,h,l,p,c,f,m,g,y,v,b,_,S,w,T,E,k,U,A,x,C,L,D,B,I,P,M,O,R,F,V=Math.pow(2,32)-1;!function(){var t;if(k={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]},"undefined"!=typeof Uint8Array){for(t in k)k.hasOwnProperty(t)&&(k[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);U=new Uint8Array(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]),x=new Uint8Array(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]),A=new Uint8Array([0,0,0,1]),C=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),L=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),D={video:C,audio:L},P=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),I=new Uint8Array([0,0,0,0,0,0,0,0]),M=new Uint8Array([0,0,0,0,0,0,0,0]),O=M,R=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),F=M,B=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}}(),a=function(t){var e,i,n=[],r=0;for(e=1;e<arguments.length;e++)n.push(arguments[e]);for(e=n.length;e--;)r+=n[e].byteLength;for(i=new Uint8Array(r+8),new DataView(i.buffer,i.byteOffset,i.byteLength).setUint32(0,i.byteLength),i.set(t,4),e=0,r=8;e<n.length;e++)i.set(n[e],r),r+=n[e].byteLength;return i},n=function(){return a(k.dinf,a(k.dref,P))},r=function(t){return a(k.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,t.audioobjecttype<<3|t.samplingfrequencyindex>>>1,t.samplingfrequencyindex<<7|t.channelcount<<3,6,1,2]))},o=function(){return a(k.ftyp,U,A,U,x)},v=function(t){return a(k.hdlr,D[t])},s=function(t){return a(k.mdat,t)},y=function(t){var e=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,t.duration>>>24&255,t.duration>>>16&255,t.duration>>>8&255,255&t.duration,85,196,0,0]);return t.samplerate&&(e[12]=t.samplerate>>>24&255,e[13]=t.samplerate>>>16&255,e[14]=t.samplerate>>>8&255,e[15]=255&t.samplerate),a(k.mdhd,e)},g=function(t){return a(k.mdia,y(t),v(t.type),d(t))},u=function(t){return a(k.mfhd,new Uint8Array([0,0,0,0,(4278190080&t)>>24,(16711680&t)>>16,(65280&t)>>8,255&t]))},d=function(t){return a(k.minf,"video"===t.type?a(k.vmhd,B):a(k.smhd,I),n(),_(t))},h=function(t,e){for(var i=[],n=e.length;n--;)i[n]=w(e[n]);return a.apply(null,[k.moof,u(t)].concat(i))},l=function(t){for(var e=t.length,i=[];e--;)i[e]=f(t[e]);return a.apply(null,[k.moov,c(4294967295)].concat(i).concat(p(t)))},p=function(t){for(var e=t.length,i=[];e--;)i[e]=T(t[e]);return a.apply(null,[k.mvex].concat(i))},c=function(t){var e=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(4278190080&t)>>24,(16711680&t)>>16,(65280&t)>>8,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return a(k.mvhd,e)},b=function(t){var e,i,n=t.samples||[],r=new Uint8Array(4+n.length);for(i=0;i<n.length;i++)e=n[i].flags,r[i+4]=e.dependsOn<<4|e.isDependedOn<<2|e.hasRedundancy;return a(k.sdtp,r)},_=function(t){return a(k.stbl,S(t),a(k.stts,F),a(k.stsc,O),a(k.stsz,R),a(k.stco,M))},function(){var e,i;S=function(t){return a(k.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),("video"===t.type?e:i)(t))},e=function(t){var e,i=t.sps||[],n=t.pps||[],r=[],o=[];for(e=0;e<i.length;e++)r.push((65280&i[e].byteLength)>>>8),r.push(255&i[e].byteLength),r=r.concat(Array.prototype.slice.call(i[e]));for(e=0;e<n.length;e++)o.push((65280&n[e].byteLength)>>>8),o.push(255&n[e].byteLength),o=o.concat(Array.prototype.slice.call(n[e]));return a(k.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(65280&t.width)>>8,255&t.width,(65280&t.height)>>8,255&t.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a(k.avcC,new Uint8Array([1,t.profileIdc,t.profileCompatibility,t.levelIdc,255].concat([i.length]).concat(r).concat([n.length]).concat(o))),a(k.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])))},i=function(t){return a(k.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(65280&t.channelcount)>>8,255&t.channelcount,(65280&t.samplesize)>>8,255&t.samplesize,0,0,0,0,(65280&t.samplerate)>>8,255&t.samplerate,0,0]),r(t))}}(),m=function(t){var e=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(4278190080&t.id)>>24,(16711680&t.id)>>16,(65280&t.id)>>8,255&t.id,0,0,0,0,(4278190080&t.duration)>>24,(16711680&t.duration)>>16,(65280&t.duration)>>8,255&t.duration,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(65280&t.width)>>8,255&t.width,0,0,(65280&t.height)>>8,255&t.height,0,0]);return a(k.tkhd,e)},w=function(t){var e,i,n,r,o,s;return e=a(k.tfhd,new Uint8Array([0,0,0,58,(4278190080&t.id)>>24,(16711680&t.id)>>16,(65280&t.id)>>8,255&t.id,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),o=Math.floor(t.baseMediaDecodeTime/(1+V)),s=Math.floor(t.baseMediaDecodeTime%(1+V)),i=a(k.tfdt,new Uint8Array([1,0,0,0,o>>>24&255,o>>>16&255,o>>>8&255,255&o,s>>>24&255,s>>>16&255,s>>>8&255,255&s])),"audio"===t.type?(n=E(t,92),a(k.traf,e,i,n)):(r=b(t),n=E(t,r.length+92),a(k.traf,e,i,n,r))},f=function(t){return t.duration=t.duration||4294967295,a(k.trak,m(t),g(t))},T=function(t){var e=new Uint8Array([0,0,0,0,(4278190080&t.id)>>24,(16711680&t.id)>>16,(65280&t.id)>>8,255&t.id,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return"video"!==t.type&&(e[e.length-1]=0),a(k.trex,e)},function(){var i,n,s;s=function(t,e){var i=0,n=0,r=0,o=0;return t.length&&(void 0!==t[0].duration&&(i=1),void 0!==t[0].size&&(n=2),void 0!==t[0].flags&&(r=4),void 0!==t[0].compositionTimeOffset&&(o=8)),[0,0,i|n|r|o,1,(4278190080&t.length)>>>24,(16711680&t.length)>>>16,(65280&t.length)>>>8,255&t.length,(4278190080&e)>>>24,(16711680&e)>>>16,(65280&e)>>>8,255&e]},n=function(t,e){var i,n,r,o;for(n=t.samples||[],i=s(n,e+=20+16*n.length),o=0;o<n.length;o++)r=n[o],i=i.concat([(4278190080&r.duration)>>>24,(16711680&r.duration)>>>16,(65280&r.duration)>>>8,255&r.duration,(4278190080&r.size)>>>24,(16711680&r.size)>>>16,(65280&r.size)>>>8,255&r.size,r.flags.isLeading<<2|r.flags.dependsOn,r.flags.isDependedOn<<6|r.flags.hasRedundancy<<4|r.flags.paddingValue<<1|r.flags.isNonSyncSample,61440&r.flags.degradationPriority,15&r.flags.degradationPriority,(4278190080&r.compositionTimeOffset)>>>24,(16711680&r.compositionTimeOffset)>>>16,(65280&r.compositionTimeOffset)>>>8,255&r.compositionTimeOffset]);return a(k.trun,new Uint8Array(i))},i=function(t,e){var i,n,r,o;for(n=t.samples||[],i=s(n,e+=20+8*n.length),o=0;o<n.length;o++)r=n[o],i=i.concat([(4278190080&r.duration)>>>24,(16711680&r.duration)>>>16,(65280&r.duration)>>>8,255&r.duration,(4278190080&r.size)>>>24,(16711680&r.size)>>>16,(65280&r.size)>>>8,255&r.size]);return a(k.trun,new Uint8Array(i))},E=function(t,e){return("audio"===t.type?i:n)(t,e)}}(),e.exports={ftyp:o,mdat:s,moof:h,moov:l,initSegment:function(t){var e,i=o(),n=l(t);return(e=new Uint8Array(i.byteLength+n.byteLength)).set(i),e.set(n,i.byteLength),e}}},{}],19:[function(t,e,i){var u,d,n,r;u=function(t,e){var i,n,r,o,s,a=[];if(!e.length)return null;for(i=0;i<t.byteLength;)n=t[i]<<24,n|=t[i+1]<<16,n|=t[i+2]<<8,n|=t[i+3],r=d(t.subarray(i+4,i+8)),o=1<n?i+n:t.byteLength,r===e[0]&&(1===e.length?a.push(t.subarray(i+8,o)):(s=u(t.subarray(i+8,o),e.slice(1))).length&&(a=a.concat(s))),i=o;return a},d=function(t){var e="";return e+=String.fromCharCode(t[0]),e+=String.fromCharCode(t[1]),e+=String.fromCharCode(t[2]),e+=String.fromCharCode(t[3])},n=function(t){var e=u(t,["moov","trak"]);return e.reduce(function(t,e){var i,n,r,o,s;return(i=u(e,["tkhd"])[0])?(n=i[0],o=i[r=0===n?12:20]<<24|i[1+r]<<16|i[2+r]<<8|i[3+r],(s=u(e,["mdia","mdhd"])[0])?(n=s[0],r=0===n?12:20,t[o]=s[r]<<24|s[1+r]<<16|s[2+r]<<8|s[3+r],t):null):null},{})},r=function(r,t){var e,i,n;return e=u(t,["moof","traf"]),i=[].concat.apply([],e.map(function(n){return u(n,["tfhd"]).map(function(t){var e,i;return e=t[4]<<24|t[5]<<16|t[6]<<8|t[7],i=r[e]||9e4,(u(n,["tfdt"]).map(function(t){var e,i;return e=t[0],i=t[4]<<24|t[5]<<16|t[6]<<8|t[7],1===e&&(i*=Math.pow(2,32),i+=t[8]<<24|t[9]<<16|t[10]<<8|t[11]),i})[0]||1/0)/i})})),n=Math.min.apply(null,i),isFinite(n)?n:0},e.exports={parseType:d,timescale:n,startTime:r}},{}],20:[function(t,e,i){var d,a,s,u,h,l,p,c,f,m,g,n=t("../utils/stream.js"),y=t("./mp4-generator.js"),v=t("../m2ts/m2ts.js"),b=t("../codecs/adts.js"),_=t("../codecs/h264").H264Stream,S=t("../aac"),w=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"],T=["width","height","profileIdc","levelIdc","profileCompatibility"];h=function(){return{size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0}}},l=function(t){return t[0]==="I".charCodeAt(0)&&t[1]==="D".charCodeAt(0)&&t[2]==="3".charCodeAt(0)},m=function(t,e){var i;if(t.length!==e.length)return!1;for(i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0},g=function(t){var e,i,n=0;for(e=0;e<t.length;e++)i=t[e],n+=i.data.byteLength;return n},(a=function(r){var o=[],s=0,e=0;a.prototype.init.call(this),this.push=function(e){p(r,e),r&&w.forEach(function(t){r[t]=e[t]}),o.push(e)},this.setEarliestDts=function(t){e=t-r.timelineStartInfo.baseMediaDecodeTime},this.flush=function(){var t,e,i,n;0!==o.length&&(t=this.trimAdtsFramesByEarliestDts_(o),r.samples=this.generateSampleTable_(t),i=y.mdat(this.concatenateFrameData_(t)),o=[],f(r),e=y.moof(s,[r]),n=new Uint8Array(e.byteLength+i.byteLength),s++,n.set(e),n.set(i,e.byteLength),c(r),this.trigger("data",{track:r,boxes:n})),this.trigger("done","AudioSegmentStream")},this.trimAdtsFramesByEarliestDts_=function(t){return r.minSegmentDts>=e?t:(r.minSegmentDts=1/0,t.filter(function(t){return t.dts>=e&&(r.minSegmentDts=Math.min(r.minSegmentDts,t.dts),r.minSegmentPts=r.minSegmentDts,!0)}))},this.generateSampleTable_=function(t){var e,i,n=[];for(e=0;e<t.length;e++)i=t[e],n.push({size:i.data.byteLength,duration:1024});return n},this.concatenateFrameData_=function(t){var e,i,n=0,r=new Uint8Array(g(t));for(e=0;e<t.length;e++)i=t[e],r.set(i.data,n),n+=i.data.byteLength;return r}}).prototype=new n,(d=function(a){var e,i,s=0,u=[];d.prototype.init.call(this),delete a.minPTS,this.gopCache_=[],this.push=function(t){p(a,t),"seq_parameter_set_rbsp"!==t.nalUnitType||e||(e=t.config,a.sps=[t.data],T.forEach(function(t){a[t]=e[t]},this)),"pic_parameter_set_rbsp"!==t.nalUnitType||i||(i=t.data,a.pps=[t.data]),u.push(t)},this.flush=function(){for(var t,e,i,n,r,o;u.length&&"access_unit_delimiter_rbsp"!==u[0].nalUnitType;)u.shift();if(0===u.length)return this.resetStream_(),void this.trigger("done","VideoSegmentStream");t=this.groupNalsIntoFrames_(u),(i=this.groupFramesIntoGops_(t))[0][0].keyFrame||((e=this.getGopForFusion_(u[0],a))?(i.unshift(e),i.byteLength+=e.byteLength,i.nalCount+=e.nalCount,i.pts=e.pts,i.dts=e.dts,i.duration+=e.duration):i=this.extendFirstKeyFrame_(i)),p(a,i),a.samples=this.generateSampleTable_(i),r=y.mdat(this.concatenateNalData_(i)),this.gopCache_.unshift({gop:i.pop(),pps:a.pps,sps:a.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),u=[],f(a),this.trigger("timelineStartInfo",a.timelineStartInfo),n=y.moof(s,[a]),o=new Uint8Array(n.byteLength+r.byteLength),s++,o.set(n),o.set(r,n.byteLength),this.trigger("data",{track:a,boxes:o}),this.resetStream_(),this.trigger("done","VideoSegmentStream")},this.resetStream_=function(){c(a),i=e=void 0},this.getGopForFusion_=function(t){var e,i,n,r,o,s=1/0;for(o=0;o<this.gopCache_.length;o++)r=this.gopCache_[o],n=r.gop,a.pps&&m(a.pps[0],r.pps[0])&&a.sps&&m(a.sps[0],r.sps[0])&&(n.dts<a.timelineStartInfo.dts||-1e4<=(e=t.dts-n.dts-n.duration)&&e<=45e3&&(!i||e<s)&&(i=r,s=e));return i?i.gop:null},this.extendFirstKeyFrame_=function(t){var e;return t[0][0].keyFrame||(e=t.shift(),t.byteLength-=e.byteLength,t.nalCount-=e.nalCount,t[0][0].dts=e.dts,t[0][0].pts=e.pts,t[0][0].duration+=e.duration),t},this.groupNalsIntoFrames_=function(t){var e,i,n=[],r=[];for(n.byteLength=0,e=0;e<t.length;e++)"access_unit_delimiter_rbsp"===(i=t[e]).nalUnitType?(n.length&&(n.duration=i.dts-n.dts,r.push(n)),(n=[i]).byteLength=i.data.byteLength,n.pts=i.pts,n.dts=i.dts):("slice_layer_without_partitioning_rbsp_idr"===i.nalUnitType&&(n.keyFrame=!0),n.duration=i.dts-n.dts,n.byteLength+=i.data.byteLength,n.push(i));return r.length&&(!n.duration||n.duration<=0)&&(n.duration=r[r.length-1].duration),r.push(n),r},this.groupFramesIntoGops_=function(t){var e,i,n=[],r=[];for(n.byteLength=0,n.nalCount=0,n.duration=0,n.pts=t[0].pts,n.dts=t[0].dts,r.byteLength=0,r.nalCount=0,r.duration=0,r.pts=t[0].pts,r.dts=t[0].dts,e=0;e<t.length;e++)(i=t[e]).keyFrame?(n.length&&(r.push(n),r.byteLength+=n.byteLength,r.nalCount+=n.nalCount,r.duration+=n.duration),(n=[i]).nalCount=i.length,n.byteLength=i.byteLength,n.pts=i.pts,n.dts=i.dts,n.duration=i.duration):(n.duration+=i.duration,n.nalCount+=i.length,n.byteLength+=i.byteLength,n.push(i));return r.length&&n.duration<=0&&(n.duration=r[r.length-1].duration),r.byteLength+=n.byteLength,r.nalCount+=n.nalCount,r.duration+=n.duration,r.push(n),r},this.generateSampleTable_=function(t,e){var i,n,r,o,s,a=e||0,u=[];for(i=0;i<t.length;i++)for(o=t[i],n=0;n<o.length;n++)s=o[n],(r=h()).dataOffset=a,r.compositionTimeOffset=s.pts-s.dts,r.duration=s.duration,r.size=4*s.length,r.size+=s.byteLength,s.keyFrame&&(r.flags.dependsOn=2),a+=r.size,u.push(r);return u},this.concatenateNalData_=function(t){var e,i,n,r,o,s,a=0,u=t.byteLength,d=t.nalCount,h=u+4*d,l=new Uint8Array(h),p=new DataView(l.buffer);for(e=0;e<t.length;e++)for(r=t[e],i=0;i<r.length;i++)for(o=r[i],n=0;n<o.length;n++)s=o[n],p.setUint32(a,s.data.byteLength),a+=4,l.set(s.data,a),a+=s.data.byteLength;return l}}).prototype=new n,p=function(t,e){"number"==typeof e.pts&&(void 0===t.timelineStartInfo.pts&&(t.timelineStartInfo.pts=e.pts),void 0===t.minSegmentPts?t.minSegmentPts=e.pts:t.minSegmentPts=Math.min(t.minSegmentPts,e.pts),void 0===t.maxSegmentPts?t.maxSegmentPts=e.pts:t.maxSegmentPts=Math.max(t.maxSegmentPts,e.pts)),"number"==typeof e.dts&&(void 0===t.timelineStartInfo.dts&&(t.timelineStartInfo.dts=e.dts),void 0===t.minSegmentDts?t.minSegmentDts=e.dts:t.minSegmentDts=Math.min(t.minSegmentDts,e.dts),void 0===t.maxSegmentDts?t.maxSegmentDts=e.dts:t.maxSegmentDts=Math.max(t.maxSegmentDts,e.dts))},c=function(t){delete t.minSegmentDts,delete t.maxSegmentDts,delete t.minSegmentPts,delete t.maxSegmentPts},f=function(t){var e,i=t.minSegmentDts-t.timelineStartInfo.dts,n=t.minSegmentPts-t.minSegmentDts;t.baseMediaDecodeTime=t.timelineStartInfo.baseMediaDecodeTime,t.baseMediaDecodeTime+=i,t.baseMediaDecodeTime-=n,t.baseMediaDecodeTime=Math.max(0,t.baseMediaDecodeTime),"audio"===t.type&&(e=t.samplerate/9e4,t.baseMediaDecodeTime*=e,t.baseMediaDecodeTime=Math.floor(t.baseMediaDecodeTime))},(u=function(t,e){this.numberOfTracks=0,this.metadataStream=e,void 0!==t.remux?this.remuxTracks=!!t.remux:this.remuxTracks=!0,this.pendingTracks=[],this.videoTrack=null,this.pendingBoxes=[],this.pendingCaptions=[],this.pendingMetadata=[],this.pendingBytes=0,this.emittedTracks=0,u.prototype.init.call(this),this.push=function(t){return t.text?this.pendingCaptions.push(t):t.frames?this.pendingMetadata.push(t):(this.pendingTracks.push(t.track),this.pendingBoxes.push(t.boxes),this.pendingBytes+=t.boxes.byteLength,"video"===t.track.type&&(this.videoTrack=t.track),void("audio"===t.track.type&&(this.audioTrack=t.track)))}}).prototype=new n,u.prototype.flush=function(t){var e,i,n,r,o=0,s={captions:[],metadata:[],info:{}},a=0;if(this.pendingTracks.length<this.numberOfTracks){if("VideoSegmentStream"!==t&&"AudioSegmentStream"!==t)return;if(this.remuxTracks)return;if(0===this.pendingTracks.length)return this.emittedTracks++,void(this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0))}for(this.videoTrack?(a=this.videoTrack.timelineStartInfo.pts,T.forEach(function(t){s.info[t]=this.videoTrack[t]},this)):this.audioTrack&&(a=this.audioTrack.timelineStartInfo.pts,w.forEach(function(t){s.info[t]=this.audioTrack[t]},this)),1===this.pendingTracks.length?s.type=this.pendingTracks[0].type:s.type="combined",this.emittedTracks+=this.pendingTracks.length,n=y.initSegment(this.pendingTracks),s.initSegment=new Uint8Array(n.byteLength),s.initSegment.set(n),s.data=new Uint8Array(this.pendingBytes),r=0;r<this.pendingBoxes.length;r++)s.data.set(this.pendingBoxes[r],o),o+=this.pendingBoxes[r].byteLength;for(r=0;r<this.pendingCaptions.length;r++)(e=this.pendingCaptions[r]).startTime=e.startPts-a,e.startTime/=9e4,e.endTime=e.endPts-a,e.endTime/=9e4,s.captions.push(e);for(r=0;r<this.pendingMetadata.length;r++)(i=this.pendingMetadata[r]).cueTime=i.pts-a,i.cueTime/=9e4,s.metadata.push(i);s.metadata.dispatchType=this.metadataStream.dispatchType,this.pendingTracks.length=0,this.videoTrack=null,this.pendingBoxes.length=0,this.pendingCaptions.length=0,this.pendingBytes=0,this.pendingMetadata.length=0,this.trigger("data",s),this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0)},(s=function(t){var n,r,o=this,i=!0;s.prototype.init.call(this),t=t||{},this.baseMediaDecodeTime=t.baseMediaDecodeTime||0,this.transmuxPipeline_={},this.setupAacPipeline=function(){var e={};(this.transmuxPipeline_=e).type="aac",e.metadataStream=new v.MetadataStream,e.aacStream=new S,e.audioTimestampRolloverStream=new v.TimestampRolloverStream("audio"),e.timedMetadataTimestampRolloverStream=new v.TimestampRolloverStream("timed-metadata"),e.adtsStream=new b,e.coalesceStream=new u(t,e.metadataStream),e.headOfPipeline=e.aacStream,e.aacStream.pipe(e.audioTimestampRolloverStream).pipe(e.adtsStream),e.aacStream.pipe(e.timedMetadataTimestampRolloverStream).pipe(e.metadataStream).pipe(e.coalesceStream),e.metadataStream.on("timestamp",function(t){e.aacStream.setTimestamp(t.timeStamp)}),e.aacStream.on("data",function(t){"timed-metadata"!==t.type||e.audioSegmentStream||(r=r||{timelineStartInfo:{baseMediaDecodeTime:o.baseMediaDecodeTime},codec:"adts",type:"audio"},e.coalesceStream.numberOfTracks++,e.audioSegmentStream=new a(r),e.adtsStream.pipe(e.audioSegmentStream).pipe(e.coalesceStream))}),e.coalesceStream.on("data",this.trigger.bind(this,"data")),e.coalesceStream.on("done",this.trigger.bind(this,"done"))},this.setupTsPipeline=function(){var i={};(this.transmuxPipeline_=i).type="ts",i.metadataStream=new v.MetadataStream,i.packetStream=new v.TransportPacketStream,i.parseStream=new v.TransportParseStream,i.elementaryStream=new v.ElementaryStream,i.videoTimestampRolloverStream=new v.TimestampRolloverStream("video"),i.audioTimestampRolloverStream=new v.TimestampRolloverStream("audio"),i.timedMetadataTimestampRolloverStream=new v.TimestampRolloverStream("timed-metadata"),i.adtsStream=new b,i.h264Stream=new _,i.captionStream=new v.CaptionStream,i.coalesceStream=new u(t,i.metadataStream),i.headOfPipeline=i.packetStream,i.packetStream.pipe(i.parseStream).pipe(i.elementaryStream),i.elementaryStream.pipe(i.videoTimestampRolloverStream).pipe(i.h264Stream),i.elementaryStream.pipe(i.audioTimestampRolloverStream).pipe(i.adtsStream),i.elementaryStream.pipe(i.timedMetadataTimestampRolloverStream).pipe(i.metadataStream).pipe(i.coalesceStream),i.h264Stream.pipe(i.captionStream).pipe(i.coalesceStream),i.elementaryStream.on("data",function(t){var e;if("metadata"===t.type){for(e=t.tracks.length;e--;)n||"video"!==t.tracks[e].type?r||"audio"!==t.tracks[e].type||((r=t.tracks[e]).timelineStartInfo.baseMediaDecodeTime=o.baseMediaDecodeTime):(n=t.tracks[e]).timelineStartInfo.baseMediaDecodeTime=o.baseMediaDecodeTime;n&&!i.videoSegmentStream&&(i.coalesceStream.numberOfTracks++,i.videoSegmentStream=new d(n),i.videoSegmentStream.on("timelineStartInfo",function(t){r&&(r.timelineStartInfo=t,i.audioSegmentStream.setEarliestDts(t.dts))}),i.h264Stream.pipe(i.videoSegmentStream).pipe(i.coalesceStream)),r&&!i.audioSegmentStream&&(i.coalesceStream.numberOfTracks++,i.audioSegmentStream=new a(r),i.adtsStream.pipe(i.audioSegmentStream).pipe(i.coalesceStream))}}),i.coalesceStream.on("data",this.trigger.bind(this,"data")),i.coalesceStream.on("done",this.trigger.bind(this,"done"))},this.setBaseMediaDecodeTime=function(t){var e=this.transmuxPipeline_;this.baseMediaDecodeTime=t,r&&(r.timelineStartInfo.dts=void 0,r.timelineStartInfo.pts=void 0,c(r),r.timelineStartInfo.baseMediaDecodeTime=t),n&&(e.videoSegmentStream&&(e.videoSegmentStream.gopCache_=[]),n.timelineStartInfo.dts=void 0,n.timelineStartInfo.pts=void 0,c(n),n.timelineStartInfo.baseMediaDecodeTime=t)},this.push=function(t){var e;i&&((e=l(t))&&"aac"!==this.transmuxPipeline_.type?this.setupAacPipeline():e||"ts"===this.transmuxPipeline_.type||this.setupTsPipeline(),i=!1),this.transmuxPipeline_.headOfPipeline.push(t)},this.flush=function(){i=!0,this.transmuxPipeline_.headOfPipeline.flush()}}).prototype=new n,e.exports={Transmuxer:s,VideoSegmentStream:d,AudioSegmentStream:a,AUDIO_PROPERTIES:w,VIDEO_PROPERTIES:T}},{"../aac":1,"../codecs/adts.js":3,"../codecs/h264":4,"../m2ts/m2ts.js":12,"../utils/stream.js":25,"./mp4-generator.js":18}],21:[function(t,e,i){var n={8:"audio",9:"video",18:"metadata"},r=function(t){for(var e,i=[];0<t.byteLength;)e=0,i.push(function(t){return"0x"+("00"+t.toString(16)).slice(-2).toUpperCase()}(t[e++])),t=t.subarray(1);return i.join(" ")},o=function(t,e){var i=t[0]&parseInt("00001111",2);return(e=e||{}).frameType=["Unknown","Keyframe (for AVC, a seekable frame)","Inter frame (for AVC, a nonseekable frame)","Disposable inter frame (H.263 only)","Generated keyframe (reserved for server use only)","Video info/command frame"][(t[0]&parseInt("11110000",2))>>>4],7==(e.codecID=i)?function(t,e){var i=["AVC Sequence Header","AVC NALU","AVC End-of-Sequence"],n=t[1]&parseInt("01111111",2)<<16|t[2]<<8|t[3];if((e=e||{}).avcPacketType=i[t[0]],e.CompositionTime=t[1]&parseInt("10000000",2)?-n:n,t[0]===1){e.nalUnitTypeRaw=r(t.subarray(4,100))}else{e.data=r(t.subarray(4))}return e}(t.subarray(1),e):e},s=function(t,e){var i=(t[0]&parseInt("11110000",2))>>>4;return(e=e||{}).soundFormat=["Linear PCM, platform endian","ADPCM","MP3","Linear PCM, little endian","Nellymoser 16-kHz mono","Nellymoser 8-kHz mono","Nellymoser","G.711 A-law logarithmic PCM","G.711 mu-law logarithmic PCM","reserved","AAC","Speex","MP3 8-Khz","Device-specific sound"][i],e.soundRate=["5.5-kHz","11-kHz","22-kHz","44-kHz"][(t[0]&parseInt("00001100",2))>>>2],e.soundSize=(t[0]&parseInt("00000010",2))>>>1?"16-bit":"8-bit",e.soundType=t[0]&parseInt("00000001",2)?"Stereo":"Mono",10==i?function(t,e){var i=["AAC Sequence Header","AAC Raw"];return(e=e||{}).aacPacketType=i[t[0]],e.data=r(t.subarray(1)),e}(t.subarray(1),e):e},a=function(t){var e=function(t){return{tagType:n[t[0]],dataSize:t[1]<<16|t[2]<<8|t[3],timestamp:t[7]<<24|t[4]<<16|t[5]<<8|t[6],streamID:t[8]<<16|t[9]<<8|t[10]}}(t);switch(t[0]){case 8:s(t.subarray(11),e);break;case 9:o(t.subarray(11),e)}return e};e.exports={inspectTag:a,inspect:function(t){var e=9,i,n=[],r;e+=4;while(e<t.byteLength){i=t[e+1]<<16;i|=t[e+2]<<8;i|=t[e+3];i+=11;r=t.subarray(e,e+i);n.push(a(r));e+=i+4}return n},textify:function(t){return On(t,null,2)}}},{}],22:[function(t,e,i){(function(r){var n,i,l=t("../mp4/probe").parseType,o=function(t){return new Date(1e3*t-20828448e5)},p=function(t){return{isLeading:(12&t[0])>>>2,dependsOn:3&t[0],isDependedOn:(192&t[1])>>>6,hasRedundancy:(48&t[1])>>>4,paddingValue:(14&t[1])>>>1,isNonSyncSample:1&t[1],degradationPriority:t[2]<<8|t[3]}},c={avc1:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength);return{dataReferenceIndex:e.getUint16(6),width:e.getUint16(24),height:e.getUint16(26),horizresolution:e.getUint16(28)+e.getUint16(30)/16,vertresolution:e.getUint16(32)+e.getUint16(34)/16,frameCount:e.getUint16(40),depth:e.getUint16(74),config:n(t.subarray(78,t.byteLength))}},avcC:function(t){var e,i,n,r,o=new DataView(t.buffer,t.byteOffset,t.byteLength),s={configurationVersion:t[0],avcProfileIndication:t[1],profileCompatibility:t[2],avcLevelIndication:t[3],lengthSizeMinusOne:3&t[4],sps:[],pps:[]},a=31&t[5];for(n=6,r=0;r<a;r++)i=o.getUint16(n),n+=2,s.sps.push(new Uint8Array(t.subarray(n,n+i))),n+=i;for(e=t[n],n++,r=0;r<e;r++)i=o.getUint16(n),n+=2,s.pps.push(new Uint8Array(t.subarray(n,n+i))),n+=i;return s},btrt:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength);return{bufferSizeDB:e.getUint32(0),maxBitrate:e.getUint32(4),avgBitrate:e.getUint32(8)}},esds:function(t){return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),esId:t[6]<<8|t[7],streamPriority:31&t[8],decoderConfig:{objectProfileIndication:t[11],streamType:t[12]>>>2&63,bufferSize:t[13]<<16|t[14]<<8|t[15],maxBitrate:t[16]<<24|t[17]<<16|t[18]<<8|t[19],avgBitrate:t[20]<<24|t[21]<<16|t[22]<<8|t[23],decoderConfigDescriptor:{tag:t[24],length:t[25],audioObjectType:t[26]>>>3&31,samplingFrequencyIndex:(7&t[26])<<1|t[27]>>>7&1,channelConfiguration:t[27]>>>3&15}}}},ftyp:function(t){for(var e=new DataView(t.buffer,t.byteOffset,t.byteLength),i={majorBrand:l(t.subarray(0,4)),minorVersion:e.getUint32(4),compatibleBrands:[]},n=8;n<t.byteLength;)i.compatibleBrands.push(l(t.subarray(n,n+4))),n+=4;return i},dinf:function(t){return{boxes:n(t)}},dref:function(t){return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),dataReferences:n(t.subarray(8))}},hdlr:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength),i={version:e.getUint8(0),flags:new Uint8Array(t.subarray(1,4)),handlerType:l(t.subarray(8,12)),name:""},n=8;for(n=24;n<t.byteLength;n++){if(0===t[n]){n++;break}i.name+=String.fromCharCode(t[n])}return i.name=decodeURIComponent(r.escape(i.name)),i},mdat:function(t){return{byteLength:t.byteLength,nals:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength),i=[],n,r;for(n=0;n+4<t.length;n+=r){r=e.getUint32(n);n+=4;if(r<=0){i.push("<span style='color:red;'>MALFORMED DATA</span>");continue}switch(t[n]&31){case 1:i.push("slice_layer_without_partitioning_rbsp");break;case 5:i.push("slice_layer_without_partitioning_rbsp_idr");break;case 6:i.push("sei_rbsp");break;case 7:i.push("seq_parameter_set_rbsp");break;case 8:i.push("pic_parameter_set_rbsp");break;case 9:i.push("access_unit_delimiter_rbsp");break;default:i.push("UNKNOWN NAL - "+t[n]&31);break}}return i}(t)}},mdhd:function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength),n=4,r={version:i.getUint8(0),flags:new Uint8Array(t.subarray(1,4)),language:""};return 1===r.version?(n+=4,r.creationTime=o(i.getUint32(n)),n+=8,r.modificationTime=o(i.getUint32(n)),n+=4,r.timescale=i.getUint32(n),n+=8):(r.creationTime=o(i.getUint32(n)),n+=4,r.modificationTime=o(i.getUint32(n)),n+=4,r.timescale=i.getUint32(n),n+=4),r.duration=i.getUint32(n),n+=4,e=i.getUint16(n),r.language+=String.fromCharCode(96+(e>>10)),r.language+=String.fromCharCode(96+((960&e)>>5)),r.language+=String.fromCharCode(96+(31&e)),r},mdia:function(t){return{boxes:n(t)}},mfhd:function(t){return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),sequenceNumber:t[4]<<24|t[5]<<16|t[6]<<8|t[7]}},minf:function(t){return{boxes:n(t)}},mp4a:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength),i={dataReferenceIndex:e.getUint16(6),channelcount:e.getUint16(16),samplesize:e.getUint16(18),samplerate:e.getUint16(24)+e.getUint16(26)/65536};return 28<t.byteLength&&(i.streamDescriptor=n(t.subarray(28))[0]),i},moof:function(t){return{boxes:n(t)}},moov:function(t){return{boxes:n(t)}},mvex:function(t){return{boxes:n(t)}},mvhd:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength),i=4,n={version:e.getUint8(0),flags:new Uint8Array(t.subarray(1,4))};return 1===n.version?(i+=4,n.creationTime=o(e.getUint32(i)),i+=8,n.modificationTime=o(e.getUint32(i)),i+=4,n.timescale=e.getUint32(i),i+=8):(n.creationTime=o(e.getUint32(i)),i+=4,n.modificationTime=o(e.getUint32(i)),i+=4,n.timescale=e.getUint32(i),i+=4),n.duration=e.getUint32(i),i+=4,n.rate=e.getUint16(i)+e.getUint16(i+2)/16,i+=4,n.volume=e.getUint8(i)+e.getUint8(i+1)/8,i+=2,i+=2,i+=8,n.matrix=new Uint32Array(t.subarray(i,i+36)),i+=36,i+=24,n.nextTrackId=e.getUint32(i),n},pdin:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength);return{version:e.getUint8(0),flags:new Uint8Array(t.subarray(1,4)),rate:e.getUint32(4),initialDelay:e.getUint32(8)}},sdtp:function(t){var e,i={version:t[0],flags:new Uint8Array(t.subarray(1,4)),samples:[]};for(e=4;e<t.byteLength;e++)i.samples.push({dependsOn:(48&t[e])>>4,isDependedOn:(12&t[e])>>2,hasRedundancy:3&t[e]});return i},sidx:function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength),n={version:t[0],flags:new Uint8Array(t.subarray(1,4)),references:[],referenceId:i.getUint32(4),timescale:i.getUint32(8),earliestPresentationTime:i.getUint32(12),firstOffset:i.getUint32(16)},r=i.getUint16(22);for(e=24;r;e+=12,r--)n.references.push({referenceType:(128&t[e])>>>7,referencedSize:2147483647&i.getUint32(e),subsegmentDuration:i.getUint32(e+4),startsWithSap:!!(128&t[e+8]),sapType:(112&t[e+8])>>>4,sapDeltaTime:268435455&i.getUint32(e+8)});return n},smhd:function(t){return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),balance:t[4]+t[5]/256}},stbl:function(t){return{boxes:n(t)}},stco:function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength),n={version:t[0],flags:new Uint8Array(t.subarray(1,4)),chunkOffsets:[]},r=i.getUint32(4);for(e=8;r;e+=4,r--)n.chunkOffsets.push(i.getUint32(e));return n},stsc:function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength),n=i.getUint32(4),r={version:t[0],flags:new Uint8Array(t.subarray(1,4)),sampleToChunks:[]};for(e=8;n;e+=12,n--)r.sampleToChunks.push({firstChunk:i.getUint32(e),samplesPerChunk:i.getUint32(e+4),sampleDescriptionIndex:i.getUint32(e+8)});return r},stsd:function(t){return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),sampleDescriptions:n(t.subarray(8))}},stsz:function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength),n={version:t[0],flags:new Uint8Array(t.subarray(1,4)),sampleSize:i.getUint32(4),entries:[]};for(e=12;e<t.byteLength;e+=4)n.entries.push(i.getUint32(e));return n},stts:function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength),n={version:t[0],flags:new Uint8Array(t.subarray(1,4)),timeToSamples:[]},r=i.getUint32(4);for(e=8;r;e+=8,r--)n.timeToSamples.push({sampleCount:i.getUint32(e),sampleDelta:i.getUint32(e+4)});return n},styp:function(t){return c.ftyp(t)},tfdt:function(t){var e={version:t[0],flags:new Uint8Array(t.subarray(1,4)),baseMediaDecodeTime:t[4]<<24|t[5]<<16|t[6]<<8|t[7]};return 1===e.version&&(e.baseMediaDecodeTime*=Math.pow(2,32),e.baseMediaDecodeTime+=t[8]<<24|t[9]<<16|t[10]<<8|t[11]),e},tfhd:function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength),n={version:t[0],flags:new Uint8Array(t.subarray(1,4)),trackId:i.getUint32(4)},r=1&n.flags[2],o=2&n.flags[2],s=8&n.flags[2],a=16&n.flags[2],u=32&n.flags[2];return e=8,r&&(e+=4,n.baseDataOffset=i.getUint32(12),e+=4),o&&(n.sampleDescriptionIndex=i.getUint32(e),e+=4),s&&(n.defaultSampleDuration=i.getUint32(e),e+=4),a&&(n.defaultSampleSize=i.getUint32(e),e+=4),u&&(n.defaultSampleFlags=i.getUint32(e)),n},tkhd:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength),i=4,n={version:e.getUint8(0),flags:new Uint8Array(t.subarray(1,4))};return 1===n.version?(i+=4,n.creationTime=o(e.getUint32(i)),i+=8,n.modificationTime=o(e.getUint32(i)),i+=4,n.trackId=e.getUint32(i),i+=4,i+=8):(n.creationTime=o(e.getUint32(i)),i+=4,n.modificationTime=o(e.getUint32(i)),i+=4,n.trackId=e.getUint32(i),i+=4,i+=4),n.duration=e.getUint32(i),i+=4,i+=8,n.layer=e.getUint16(i),i+=2,n.alternateGroup=e.getUint16(i),i+=2,n.volume=e.getUint8(i)+e.getUint8(i+1)/8,i+=2,i+=2,n.matrix=new Uint32Array(t.subarray(i,i+36)),i+=36,n.width=e.getUint16(i)+e.getUint16(i+2)/16,i+=4,n.height=e.getUint16(i)+e.getUint16(i+2)/16,n},traf:function(t){return{boxes:n(t)}},trak:function(t){return{boxes:n(t)}},trex:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength);return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),trackId:e.getUint32(4),defaultSampleDescriptionIndex:e.getUint32(8),defaultSampleDuration:e.getUint32(12),defaultSampleSize:e.getUint32(16),sampleDependsOn:3&t[20],sampleIsDependedOn:(192&t[21])>>6,sampleHasRedundancy:(48&t[21])>>4,samplePaddingValue:(14&t[21])>>1,sampleIsDifferenceSample:!!(1&t[21]),sampleDegradationPriority:e.getUint16(22)}},trun:function(t){var e,i={version:t[0],flags:new Uint8Array(t.subarray(1,4)),samples:[]},n=new DataView(t.buffer,t.byteOffset,t.byteLength),r=1&i.flags[2],o=4&i.flags[2],s=1&i.flags[1],a=2&i.flags[1],u=4&i.flags[1],d=8&i.flags[1],h=n.getUint32(4),l=8;for(r&&(i.dataOffset=n.getUint32(l),l+=4),o&&h&&(e={flags:p(t.subarray(l,l+4))},l+=4,s&&(e.duration=n.getUint32(l),l+=4),a&&(e.size=n.getUint32(l),l+=4),d&&(e.compositionTimeOffset=n.getUint32(l),l+=4),i.samples.push(e),h--);h--;)e={},s&&(e.duration=n.getUint32(l),l+=4),a&&(e.size=n.getUint32(l),l+=4),u&&(e.flags=p(t.subarray(l,l+4)),l+=4),d&&(e.compositionTimeOffset=n.getUint32(l),l+=4),i.samples.push(e);return i},"url ":function(t){return{version:t[0],flags:new Uint8Array(t.subarray(1,4))}},vmhd:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength);return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),graphicsmode:e.getUint16(4),opcolor:new Uint16Array([e.getUint16(6),e.getUint16(8),e.getUint16(10)])}}};n=function(t){for(var e,i,n,r,o,s=0,a=[],u=new ArrayBuffer(t.length),d=new Uint8Array(u),h=0;h<t.length;++h)d[h]=t[h];for(e=new DataView(u);s<t.byteLength;)i=e.getUint32(s),n=l(t.subarray(s+4,s+8)),r=1<i?s+i:t.byteLength,(o=(c[n]||function(t){return{data:t}})(t.subarray(s+8,r))).size=i,o.type=n,a.push(o),s=r;return a},i=function(t,e){var o;return e=e||0,o=new Array(2*e+1).join(" "),t.map(function(r,t){return o+r.type+"\n"+Pn(r).filter(function(t){return"type"!==t&&"boxes"!==t}).map(function(t){var e=o+"  "+t+": ",i=r[t];if(i instanceof Uint8Array||i instanceof Uint32Array){var n=Array.prototype.slice.call(new Uint8Array(i.buffer,i.byteOffset,i.byteLength)).map(function(t){return" "+("00"+t.toString(16)).slice(-2)}).join("").match(/.{1,24}/g);return n?1===n.length?e+"<"+n.join("").slice(1)+">":e+"<\n"+n.map(function(t){return o+"  "+t}).join("\n")+"\n"+o+"  >":e+"<>"}return e+On(i,null,2).split("\n").map(function(t,e){return 0===e?t:o+"  "+t}).join("\n")}).join("\n")+(r.boxes?"\n"+i(r.boxes,e+1):"")}).join("\n")},e.exports={inspect:n,textify:i}}).call(this,void 0!==r?r:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../mp4/probe":19}],23:[function(t,e,i){var o=t("../m2ts/stream-types.js"),s=t("../m2ts/timestamp-rollover-stream.js").handleRollover,m={};m.ts=t("../m2ts/probe.js"),m.aac=t("../aac/probe.js");var g=188,y=71,r=function(t){return t[0]==="I".charCodeAt(0)&&t[1]==="D".charCodeAt(0)&&t[2]==="3".charCodeAt(0)},a=function(t,e){var i,n,r;t.audio&&t.audio.length&&(void 0===(i=e)&&(i=t.audio[0].dts),t.audio.forEach(function(t){t.dts=s(t.dts,i),t.pts=s(t.pts,i),t.dtsTime=t.dts/9e4,t.ptsTime=t.pts/9e4})),t.video&&t.video.length&&(void 0===(n=e)&&(n=t.video[0].dts),t.video.forEach(function(t){t.dts=s(t.dts,n),t.pts=s(t.pts,n),t.dtsTime=t.dts/9e4,t.ptsTime=t.pts/9e4}),t.firstKeyFrame&&((r=t.firstKeyFrame).dts=s(r.dts,n),r.pts=s(r.pts,n),r.dtsTime=r.dts/9e4,r.ptsTime=r.dts/9e4))},u=function(t){for(var e,i=!1,n=0,r=null,o=null,s=0,a=0;3<=t.length-a;){var u=m.aac.parseType(t,a);switch(u){case"timed-metadata":if(t.length-a<10){i=!0;break}if((s=m.aac.parseId3TagSize(t,a))>t.length){i=!0;break}null===o&&(e=t.subarray(a,a+s),o=m.aac.parseAacTimestamp(e)),a+=s;break;case"audio":if(t.length-a<7){i=!0;break}if((s=m.aac.parseAdtsSize(t,a))>t.length){i=!0;break}null===r&&(e=t.subarray(a,a+s),r=m.aac.parseSampleRate(e)),n++,a+=s;break;default:a++}if(i)return null}if(null===r||null===o)return null;var d=9e4/r,h={audio:[{type:"audio",dts:o,pts:o},{type:"audio",dts:o+1024*n*d,pts:o+1024*n*d}]};return h},d=function(t){var e={pid:null,table:null},i={};for(var n in!function(t,e){var i=0,n=g,r,o;while(n<t.byteLength){if(t[i]===y&&t[n]===y){r=t.subarray(i,n);o=m.ts.parseType(r,e.pid);switch(o){case"pat":if(!e.pid){e.pid=m.ts.parsePat(r)}break;case"pmt":if(!e.table){e.table=m.ts.parsePmt(r)}break}if(e.pid&&e.table){return}i+=g;n+=g;continue}i++;n++}}(t,e),e.table)if(e.table.hasOwnProperty(n)){var r=e.table[n];switch(r){case o.H264_STREAM_TYPE:i.video=[],function(t,e,i){var n=0,r=g,o,s,a,u,d,h,l,p,c=false,f={data:[],size:0};while(r<t.byteLength){if(t[n]===y&&t[r]===y){o=t.subarray(n,r);s=m.ts.parseType(o,e.pid);switch(s){case"pes":a=m.ts.parsePesType(o,e.table);u=m.ts.parsePayloadUnitStartIndicator(o);if(a==="video"){if(u&&!c){d=m.ts.parsePesTime(o);d.type="video";i.video.push(d);c=true}if(!i.firstKeyFrame){if(u){if(f.size!==0){h=new Uint8Array(f.size);l=0;while(f.data.length){p=f.data.shift();h.set(p,l);l+=p.byteLength}if(m.ts.videoPacketContainsKeyFrame(h)){i.firstKeyFrame=m.ts.parsePesTime(h);i.firstKeyFrame.type="video"}f.size=0}}f.data.push(o);f.size+=o.byteLength}}break}if(c&&i.firstKeyFrame){break}n+=g;r+=g;continue}n++;r++}r=t.byteLength,n=r-g,c=false;while(n>=0){if(t[n]===y&&t[r]===y){o=t.subarray(n,r);s=m.ts.parseType(o,e.pid);switch(s){case"pes":a=m.ts.parsePesType(o,e.table);u=m.ts.parsePayloadUnitStartIndicator(o);if(a==="video"&&u){d=m.ts.parsePesTime(o);d.type="video";i.video.push(d);c=true}break}if(c){break}n-=g;r-=g;continue}n--;r--}}(t,e,i),0===i.video.length&&delete i.video;break;case o.ADTS_STREAM_TYPE:i.audio=[],function(t,e,i){var n=0,r=g,o,s,a,u,d,h=false;while(r<t.byteLength){if(t[n]===y&&t[r]===y){o=t.subarray(n,r);s=m.ts.parseType(o,e.pid);switch(s){case"pes":a=m.ts.parsePesType(o,e.table);u=m.ts.parsePayloadUnitStartIndicator(o);if(a==="audio"&&u){d=m.ts.parsePesTime(o);d.type="audio";i.audio.push(d);h=true}break}if(h){break}n+=g;r+=g;continue}n++;r++}r=t.byteLength,n=r-g,h=false;while(n>=0){if(t[n]===y&&t[r]===y){o=t.subarray(n,r);s=m.ts.parseType(o,e.pid);switch(s){case"pes":a=m.ts.parsePesType(o,e.table);u=m.ts.parsePayloadUnitStartIndicator(o);if(a==="audio"&&u){d=m.ts.parsePesTime(o);d.type="audio";i.audio.push(d);h=true}break}if(h){break}n-=g;r-=g;continue}n--;r--}}(t,e,i),0===i.audio.length&&delete i.audio}}return i};e.exports={inspect:function(t,e){var i,n;if(r(t)){n=u(t)}else{n=d(t)}return n&&(n.audio||n.video)?(a(n,e),n):null}}},{"../aac/probe.js":2,"../m2ts/probe.js":14,"../m2ts/stream-types.js":15,"../m2ts/timestamp-rollover-stream.js":16}],24:[function(t,e,i){var n;n=function(n){var r=n.byteLength,o=0,s=0;this.length=function(){return 8*r},this.bitsAvailable=function(){return 8*r+s},this.loadWord=function(){var t=n.byteLength-r,e=new Uint8Array(4),i=Math.min(4,r);if(0===i)throw new Error("no bytes available");e.set(n.subarray(t,t+i)),o=new DataView(e.buffer).getUint32(0),s=8*i,r-=i},this.skipBits=function(t){var e;t<s||(t-=s,e=Math.floor(t/8),t-=8*e,r-=e,this.loadWord()),o<<=t,s-=t},this.readBits=function(t){var e=Math.min(s,t),i=o>>>32-e;return 0<(s-=e)?o<<=e:0<r&&this.loadWord(),0<(e=t-e)?i<<e|this.readBits(e):i},this.skipLeadingZeros=function(){var t;for(t=0;t<s;++t)if(0!=(o&2147483648>>>t))return o<<=t,s-=t,t;return this.loadWord(),t+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var t=this.skipLeadingZeros();return this.readBits(t+1)-1},this.readExpGolomb=function(){var t=this.readUnsignedExpGolomb();return 1&t?1+t>>>1:-1*(t>>>1)},this.readBoolean=function(){return 1===this.readBits(1)},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()},e.exports=n},{}],25:[function(t,e,i){var n=function(){this.init=function(){var o={};this.on=function(t,e){o[t]||(o[t]=[]),o[t]=o[t].concat(e)},this.off=function(t,e){var i;return!!o[t]&&(i=o[t].indexOf(e),o[t]=o[t].slice(),o[t].splice(i,1),-1<i)},this.trigger=function(t){var e,i,n,r;if(e=o[t])if(2===arguments.length)for(n=e.length,i=0;i<n;++i)e[i].call(this,arguments[1]);else{for(r=[],i=arguments.length,i=1;i<arguments.length;++i)r.push(arguments[i]);for(n=e.length,i=0;i<n;++i)e[i].apply(this,r)}},this.dispose=function(){o={}}}};n.prototype.pipe=function(e){return this.on("data",function(t){e.push(t)}),this.on("done",function(t){e.flush(t)}),e},n.prototype.push=function(t){this.trigger("data",t)},n.prototype.flush=function(t){this.trigger("done",t)},e.exports=n},{}]},{},[9])(9)}),t(Fn,In=je),Fn.prototype.render=function(t){this.transmuxer=new muxjs.mp4.Transmuxer,this.mediaSoureInit(),t?je.ischangeSource=!1:je.videoForegin.operation.playVideo()},Fn.prototype.addMux=function(t){var e=this.createEl("script",{className:"load-waiting"},{src:"./utils/mux/mux.js"});document.body.appendChild(e).onload=function(){t()}},Fn.prototype.reLoad=function(){this.unLoad(),this.detachMediaElement(),this.render(!1),je.videoForegin.hooks.reLoadComplet&&je.videoForegin.hooks.reLoadComplet()},Fn.prototype.changeSource=function(t,e){this.unLoad(),this.detachMediaElement(),t&&(this.changeSourceUrl=t),this.render(!1),je.options_.streamLink[e]=t,je.ischangeSource=!0,je.videoForegin.hooks.changeSourceComplet&&je.videoForegin.hooks.changeSourceComplet()},Fn.prototype.listenerReload=function(){var e=this;document.getElementsByClassName("reload")[0].addEventListener("click",function(t){e.reLoad(),t.stopPropagation()},!1)},Fn.prototype.unLoad=function(){if(je.options_.play&&je.options_.play.pause(),this.setTimeoutFetchHls&&(clearTimeout(this.setTimeoutFetchHls),this.setTimeoutFetchHls=null),"open"===this.mediaSoure.readyState)try{this.sourceBuffer.abort()}catch(t){je.sendError(t)}},Fn.prototype.detachMediaElement=function(){if(je.options_.play&&this.removevideoListen(),this.transmuxer&&(this.transmuxer=null),this.mediaSoure){var t=this.sourceBuffer;if(t){if("closed"!==this.mediaSoure.readyState){try{this.mediaSoure.removeSourceBuffer(t)}catch(t){je.sendError(t)}t.removeEventListener("updatestart",this.updatestart.bind(this)),t.removeEventListener("update",this.update.bind(this)),t.removeEventListener("updateend",this.updateend.bind(this)),t.removeEventListener("error",this.error.bind(this)),t.removeEventListener("abort",this.abort.bind(this))}this.sourceBuffer=null}if("open"===this.mediaSoure.readyState)try{this.mediaSoure.endOfStream()}catch(t){je.sendError(t)}this.mediaSoure.removeEventListener("sourceopen",this.init.bind(this)),this.mediaSoure.removeEventListener("sourceended",function(){}),this.mediaSoure.removeEventListener("sourceclose",function(){}),this.mediaSoure=null}je.options_.play.src&&window.URL.revokeObjectURL(je.options_.play.src),je.options_.play&&(je.options_.play.src="",je.options_.play.removeAttribute("src"))},Fn.prototype.removevideoListen=function(){je.options_.play.removeEventListener("play",function(t){}),je.options_.play.removeEventListener("waiting",function(t){}),je.options_.play.removeEventListener("pause",function(t){}),je.options_.play.removeEventListener("canplay",function(t){}),je.options_.play.removeEventListener("seeked",function(t){}),je.options_.play.removeEventListener("seeking",function(t){}),je.options_.play.removeEventListener("loadstart",function(t){}),je.options_.play.removeEventListener("timeupdate",function(t){}),je.options_.play.removeEventListener("canplaythrough",function(t){}),je.options_.play.removeEventListener("loadeddata",function(t){}),je.options_.play.removeEventListener("loadedmetadata",function(t){}),je.options_.play.removeEventListener("progress",function(t){}),je.options_.play.removeEventListener("stalled",function(t){})},Fn.prototype.init=function(){this.sourceinit(),this.transmuxerbind(),this.getarticulation()},Fn.prototype.getarticulation=function(){var e=this,i=new Cn,n=null!==this.changeSourceUrl?this.changeSourceUrl:this.options_.streamLink.hls;Dn(n).then(function(t){return t.text()}).then(function(t){return e.changeSourceUrl=null,je.videoForegin.hooks.sendRequestStart&&je.videoForegin.hooks.sendRequestStart(),i.push(t),i.end(),e.playManifest||(e.playManifest={}),e.playManifest.streamSrc=e.options_.streamLink.hls,0<=t.indexOf("#EXT-X-STREAM-INF:")?(e.streamfest=i.manifest,void e.definition()):(e.playManifest=Be(e.playManifest,i.manifest),e.playManifest.streamxhrSrc=n,void e.fetchHls())}).catch(function(t){e.requesttimeout(),je.sendError(t)})},Fn.prototype.fetchHls=function(){var e=this,i=new Cn;fetch(this.playManifest.streamxhrSrc).then(function(t){return t.text()}).then(function(t){je.videoForegin.hooks.getStreamComplete&&je.videoForegin.hooks.getStreamComplete(),i.push(t),i.end(),e.streamRepeat(i)}).catch(function(t){e.requesttimeout(),je.sendError(t)})},Fn.prototype.streamRepeat=function(t){if(je.videoForegin.hooks.dataArrival&&je.videoForegin.hooks.dataArrival(),this.playManifest.segments){for(var e=-1,i=0;i<t.manifest.segments.length;i++)if(t.manifest.segments[i].uri===this.lastTsSrc){e=i;break}if(-1<e&&(t.manifest.segments=t.manifest.segments.slice(e+1)),t.manifest.segments.length<=0)return void((n=this).setTimeoutFetchHls=setTimeout(function(){n.fetchHls.call(n)},n.longTime));this.playManifest=Be(this.playManifest,t.manifest)}else this.playManifest=Be(this.playManifest,t.manifest);var n;0<t.manifest.segments.length&&(this.lastTsSrc=t.manifest.segments[t.manifest.segments.length-1].uri),this.getduration(),this.transmuxerInit()},Fn.prototype.getduration=function(){0<this.allTime&&(this.broferTime=this.allTime);for(var t=0;t<this.playManifest.segments.length;t++)this.allTime+=this.playManifest.segments[t].duration},Fn.prototype.definition=function(){var t=this.streamfest.playlists[this.streamType];this.playManifest.streamxhrSrc=Fn.resolveUrl(this.playManifest.streamSrc,t.uri),this.fetchHls()},Fn.prototype.mediaSoureInit=function(){this.mediaSoure=new MediaSource,je.options_.play.src=URL.createObjectURL(this.mediaSoure),this.mediaSoure.addEventListener("sourceopen",this.init.bind(this),{once:!0}),this.mediaSoure.addEventListener("sourceended",function(){},{once:!0}),this.mediaSoure.addEventListener("sourceclose",function(){},{once:!0}),je.videoForegin.hooks.initMediaSoureComplete&&je.videoForegin.hooks.initMediaSoureComplete(this.mediaSoure)},Fn.prototype.sourceinit=function(){URL.revokeObjectURL(je.options_.play.src),this.sourceBufferInit()},Fn.prototype.sourceBufferInit=function(){var t='video/mp4; codecs="avc1.42E01E, mp4a.40.2"';this.sourceBuffer=this.mediaSoure.addSourceBuffer(t),this.sourceBuffer.addEventListener("updatestart",this.updatestart.bind(this)),this.sourceBuffer.addEventListener("update",this.update.bind(this)),this.sourceBuffer.addEventListener("updateend",this.updateend.bind(this)),this.sourceBuffer.addEventListener("error",this.error.bind(this)),this.sourceBuffer.addEventListener("abort",this.abort.bind(this)),je.videoForegin.hooks.initSourceBuffers&&je.videoForegin.hooks.initSourceBuffers(t,this.sourceBuffer)},Fn.prototype.updatestart=function(){},Fn.prototype.update=function(){},Fn.prototype.error=function(t){je.sendError(t)},Fn.prototype.abort=function(){},Fn.prototype.updateend=function(){if(this.offset=0,je.videoForegin.hooks.sourceBufferUpdateend&&je.videoForegin.hooks.sourceBufferUpdateend(),!this.sourceBuffer.updating&&"open"===this.mediaSoure.readyState&&this.index==this.playManifest.segments.length-1)return this.createInitSegment=!0,this.playManifest.endList?void this.mediaSoure.endOfStream():void(je.options_.play.currentTime>this.cacheTime?(this.sourceBuffer.remove(0,this.cacheTime),this.cacheTime+=this.cacheTime):(this.index=0,this.remuxedSegs=[],(t=this).setTimeoutFetchHls=setTimeout(function(){t.fetchHls.call(t)},t.longTime)));var t;this.fetchNextSegment()},Fn.prototype.fetchNextSegment=function(){var e=this;this.index+=1;var t=Fn.resolveUrl(this.playManifest.streamxhrSrc,this.playManifest.segments[this.index].uri);fetch(t).then(function(t){return t.arrayBuffer()}).then(function(t){e.transmuxer.push(new Uint8Array(t)),e.transmuxer.flush()}).catch(function(t){je.sendError(t)})},Fn.prototype.transmuxerInit=function(){var e=this,t=Fn.resolveUrl(this.playManifest.streamxhrSrc,this.playManifest.segments[this.index].uri);Dn(t).then(function(t){return t.arrayBuffer()}).then(function(t){e.transmuxer.push(new Uint8Array(t)),e.transmuxer.flush()}).catch(function(t){je.sendError(t),e.requesttimeout()})},Fn.prototype.transmuxerbind=function(){var e=this;this.transmuxer.on("data",function(t){e.remuxedSegs.push(t),e.remuxedBytesLength=t.data.byteLength,e.remuxedInitSegment||(e.remuxedInitSegment=t.initSegment),e.appendBuffer.call(e)})},Fn.prototype.appendBuffer=function(){var t,e;this.createInitSegment?("segments"===this.sourceBuffer.mode&&0<je.options_.play.currentTime&&(this.sourceBuffer.mode="sequence"),(t=new Uint8Array(this.remuxedInitSegment.byteLength+this.remuxedBytesLength)).set(this.remuxedInitSegment,this.offset),this.offset+=this.remuxedInitSegment.byteLength,this.createInitSegment=!1):t=new Uint8Array(this.remuxedBytesLength),e=this.offset,t.set(this.remuxedSegs[this.index].data,e),this.remuxedBytesLength=0,this.sourceBuffer.appendBuffer(t)},Fn.prototype.buffer=function(){je.options_.play.buffered.end(0)},Fn.prototype.requesttimeout=function(){this.timoutNumber+=1,this.getarticulation()},Fn);function Fn(t,e,i){var n=In.call(this,t,e,i)||this;return n.streamType=0,n.longTime=1e3,n.cacheTime=10,n.allTime=0,n.broferTime=0,n.timoutNumber=0,n.remuxedSegs=[],n.remuxedBytesLength=0,n.remuxedInitSegment=null,n.createInitSegment=!0,n.offset=0,n.index=0,n.changeSourceUrl=null,n.render.call(n,!0),je.videoForegin.operation.reLoadVideo=n.reLoad.bind(n),je.videoForegin.operation.changeSource=n.changeSource.bind(n),n.listenerReload(),n}Rn.resolveUrl=function(t,e){return/^[a-z]+:/i.test(e)?e:/\/\//i.test(t)?(0<=t.indexOf("?")&&(t=t.slice(0,t.indexOf("?"))),(t=t.slice(0,t.lastIndexOf("/")+1)+"/")+e):void 0},je.setComponents("hls",Rn);var Vn,jn=(t(Nn,Vn=je),Nn.prototype.changeSource=function(t,e){je.options_.streamLink[e]=t,je.options_.play.src=je.options_.streamLink.mp4,je.ischangeSource=!0,je.videoForegin.hooks.changeSourceComplet&&je.videoForegin.hooks.changeSourceComplet()},Nn.prototype.mediaSoureInit=function(){},Nn.prototype.sourceended=function(){},Nn.prototype.sourceopenInit=function(t){var e='video/mp4; codecs="avc1.42E01E, mp4a.40.2"';this.sourceBuffer=this.mediaSoure.addSourceBuffer(e),URL.revokeObjectURL(je.options_.play.src),je.videoForegin.hooks.initSourceBuffers&&je.videoForegin.hooks.initSourceBuffers(e,this.sourceBuffer),this.getMediaResources()},Nn.prototype.getMediaResources=function(){var e=this,t=je.options_.streamLink.mp4;je.videoForegin.hooks.sendRequestStart&&je.videoForegin.hooks.sendRequestStart(),fetch(t).then(function(t){return t.arrayBuffer()}).then(function(t){je.videoForegin.hooks.getStreamComplete&&je.videoForegin.hooks.getStreamComplete(),e.buffer=t,e.sourceBufferUpdateend(),e.appendBuffer()})},Nn.prototype.sourceBufferUpdateend=function(){var e=this;this.sourceBuffer.addEventListener("updateend",function(t){je.videoForegin.hooks.sourceBufferUpdateend&&je.videoForegin.hooks.sourceBufferUpdateend(),e.sourceBuffer.updating||"open"!==e.mediaSoure.readyState||e.mediaSoure.endOfStream()}),this.sourceBuffer.addEventListener("error",function(t){je.sendError(t)})},Nn.prototype.appendBuffer=function(){this.sourceBuffer.appendBuffer(this.buffer)},Nn);function Nn(t,e,i){var n=Vn.call(this,t,e,i)||this;return n.arr=[],n.index=0,je.videoForegin.operation.changeSource=n.changeSource.bind(n),je.options_.play.src=je.options_.streamLink.mp4,n}je.setComponents("mp4",jn);var zn,Gn=(t(Hn,zn=je),Hn.prototype.videoListen=function(){var t=this,e=0,i=!0,n=setTimeout(function(){je.videoForegin.hooks.completecreateVideo&&je.videoForegin.hooks.completecreateVideo(t.el_),clearTimeout(n)},1e3);je.options_.play.addEventListener("play",function(t){je.options_.loadWaitingDom.hide(je.options_.loadWaitingDom.dom),je.videoForegin.hooks.videoPlay&&je.videoForegin.hooks.videoPlay()}),je.options_.play.addEventListener("waiting",function(t){je.options_.loadWaitingDom.show(je.options_.loadWaitingDom.dom),je.videoForegin.hooks.videoWaiting&&je.videoForegin.hooks.videoWaiting()}),je.options_.play.addEventListener("pause",function(t){je.videoForegin.hooks.videoPause&&je.videoForegin.hooks.videoPause()}),je.options_.play.addEventListener("canplay",function(t){document.addEventListener("touchstart",function(){je.options_.play.paused||(je.options_.play.play(),document.removeEventListener("touchstart",function(){}))}),document.addEventListener("WeixinJSBridgeReady",function(){je.options_.play.play()},!1),je.videoForegin.hooks.videoCanplay&&je.videoForegin.hooks.videoCanplay()}),je.options_.play.addEventListener("seeked",function(t){je.videoForegin.hooks.videoSeeked&&je.videoForegin.hooks.videoSeeked()}),je.options_.play.addEventListener("seeking",function(t){je.videoForegin.hooks.videoSeeking&&je.videoForegin.hooks.videoSeeking()}),je.options_.play.addEventListener("loadstart",function(t){je.videoForegin.hooks.videoLoadstart&&je.videoForegin.hooks.videoLoadstart()}),je.options_.play.addEventListener("timeupdate",function(t){(10<=++e||i)&&(je.options_.loadWaitingDom.hide(je.options_.loadWaitingDom.dom),je.options_.errorDom.hide(je.options_.errorDom.dom),e=0,i=!1),je.videoEmit.timeupdate&&je.videoEmit.timeupdate(),je.videoForegin.hooks.videoTimeupdate&&je.videoForegin.hooks.videoTimeupdate()}),je.options_.play.addEventListener("canplaythrough",function(t){je.videoForegin.hooks.videoCanplaythrough&&je.videoForegin.hooks.videoCanplaythrough(),je.options_.loadWaitingDom.hide(je.options_.loadWaitingDom.dom),je.options_.errorDom.hide(je.options_.errorDom.dom)}),je.options_.play.addEventListener("loadeddata",function(t){je.videoEmit.loadeddata&&je.videoEmit.loadeddata(),je.videoForegin.hooks.videoLoadeddata&&je.videoForegin.hooks.videoLoadeddata()}),je.options_.play.addEventListener("loadedmetadata",function(t){je.videoForegin.hooks.videoLoadedmetadata&&je.videoForegin.hooks.videoLoadedmetadata()}),je.options_.play.addEventListener("progress",function(t){je.videoEmit.progress&&je.videoEmit.progress(),je.videoForegin.hooks.videoProgress&&je.videoForegin.hooks.videoProgress()}),je.options_.play.addEventListener("stalled",function(t){je.videoEmit.stalled&&je.videoEmit.stalled(),je.videoForegin.hooks.videoStalled&&je.videoForegin.hooks.videoStalled()})},Hn.prototype.create=function(){return this.el_=zn.prototype.createEl.call(this,"video",{id:"videojs_"+je.guid_},function(){var t;return t={preload:this.options_.preload,poster:this.options_.poster,width:this.options_.width,height:this.options_.height,src:"","x5-video-player-type":"h5"},this.options_.loop&&(t.loop=this.options_.loop),this.options_.autoplay&&(t.autoplay=this.options_.autoplay),t}.call(this)),this.play_.insertAdjacentElement("beforeBegin",this.el_),this.play_.remove(),this.play_=this.el_,this.el_},Hn.prototype.liveStream=function(){},Hn.players={},Hn);function Hn(t,e,i){var n=zn.call(this,t,e,i)||this;n.options_=Be(je.options_,n.options_),n.el_=n.create(),je.options_.play=n.el_,je.options_.autoplay&&(je.options_.play.muted=!0);var r=je.getComponents("videoToolBar");n.videoToolBarDom=new r(null,e,i),n.videoToolBarDom.show();var o=je.getComponents("errorBar");je.options_.errorDom=new o(null,e,i);var s=je.getComponents("loadWaitingBar");je.options_.loadWaitingDom=new s(null,e,i);var a=je.getComponents("centerControl");je.options_.centerControlDom=new a(null,e,i);var u=je.getComponents("livStream");return Hn.liveStreamOption=new u(t,{teachOrder:je.options_.teachOrder,streamLink:je.options_.streamLink},i),n.videoListen(),n}Gn.prototype.options_=je.components_,je.setComponents("Play",Gn);var qn={errorMessage:{noStream:"直播流不存在",noString:"不是字符串",noMediaSource:"不支持MediaSource的API",loadError:"加载错误，请刷新后重新加载"},tips:{loadWaiting:"加载中！"}},Xn=function(){switch(je.options_.languages){case"en":return qn;case"cn":default:return Ve}},Wn={},Yn=(Object.defineProperty(Kn.prototype,"videoPlay",{get:function(){return this._videoPlay},set:function(t){this._videoPlay=t},enumerable:!1,configurable:!0}),Object.defineProperty(Kn.prototype,"reLoadComplet",{get:function(){return this._reLoadComplet},set:function(t){this._reLoadComplet=t},enumerable:!1,configurable:!0}),Object.defineProperty(Kn.prototype,"changeSourceComplet",{get:function(){return this._changeSourceComplet},set:function(t){this._changeSourceComplet=t},enumerable:!1,configurable:!0}),Object.defineProperty(Kn.prototype,"completecreateVideo",{get:function(){return this._completecreateVideo},set:function(t){this._completecreateVideo=t},enumerable:!1,configurable:!0}),Object.defineProperty(Kn.prototype,"videoWaiting",{get:function(){return this._waiting},set:function(t){this._waiting=t},enumerable:!1,configurable:!0}),Object.defineProperty(Kn.prototype,"videoPause",{get:function(){return this._pause},set:function(t){this._pause=t},enumerable:!1,configurable:!0}),Object.defineProperty(Kn.prototype,"videoCanplay",{get:function(){return this._canplay},set:function(t){this._canplay=t},enumerable:!1,configurable:!0}),Object.defineProperty(Kn.prototype,"videoSeeking",{get:function(){return this._seeking},set:function(t){this._seeking=t},enumerable:!1,configurable:!0}),Object.defineProperty(Kn.prototype,"videoSeeked",{get:function(){return this._seeked},set:function(t){this._seeked=t},enumerable:!1,configurable:!0}),Object.defineProperty(Kn.prototype,"videoLoadstart",{get:function(){return this._loadstart},set:function(t){this._loadstart=t},enumerable:!1,configurable:!0}),Object.defineProperty(Kn.prototype,"videoLoadeddata",{get:function(){return this._loadeddata},set:function(t){this._loadeddata=t},enumerable:!1,configurable:!0}),Object.defineProperty(Kn.prototype,"videoLoadedmetadata",{get:function(){return this._loadedmetadata},set:function(t){this._loadedmetadata=t},enumerable:!1,configurable:!0}),Object.defineProperty(Kn.prototype,"videoCanplaythrough",{get:function(){return this._canplaythrough},set:function(t){this._canplaythrough=t},enumerable:!1,configurable:!0}),Object.defineProperty(Kn.prototype,"videoProgress",{get:function(){return this._progress},set:function(t){this._progress=t},enumerable:!1,configurable:!0}),Object.defineProperty(Kn.prototype,"videoTimeupdate",{get:function(){return this._timeupdate},set:function(t){this._timeupdate=t},enumerable:!1,configurable:!0}),Object.defineProperty(Kn.prototype,"videoStalled",{get:function(){return this._stalled},set:function(t){this._stalled=t},enumerable:!1,configurable:!0}),Object.defineProperty(Kn.prototype,"videoAbort",{get:function(){return this._abort},set:function(t){this._abort=t},enumerable:!1,configurable:!0}),Object.defineProperty(Kn.prototype,"initMediaSoureComplete",{get:function(){return this._initMediaSoureComplete},set:function(t){this._initMediaSoureComplete=t},enumerable:!1,configurable:!0}),Object.defineProperty(Kn.prototype,"initSourceBuffers",{get:function(){return this._initSourceBuffers},set:function(t){this._initSourceBuffers=t},enumerable:!1,configurable:!0}),Object.defineProperty(Kn.prototype,"sourceBufferUpdateend",{get:function(){return this._sourceBufferUpdateend},set:function(t){this._sourceBufferUpdateend=t},enumerable:!1,configurable:!0}),Object.defineProperty(Kn.prototype,"sendRequestStart",{get:function(){return this._sendRequestStart},set:function(t){this._sendRequestStart=t},enumerable:!1,configurable:!0}),Object.defineProperty(Kn.prototype,"getStreamComplete",{get:function(){return this._getStreamComplete},set:function(t){this._getStreamComplete=t},enumerable:!1,configurable:!0}),Object.defineProperty(Kn.prototype,"dataArrival",{get:function(){return this._dataArrival},set:function(t){this._dataArrival=t},enumerable:!1,configurable:!0}),Object.defineProperty(Kn.prototype,"error",{get:function(){return this._error},set:function(t){this._error=t},enumerable:!1,configurable:!0}),Kn);function Kn(){}var $n=(Object.defineProperty(Jn.prototype,"playVideo",{get:function(){return this._playVideo},set:function(t){this._playVideo=t},enumerable:!1,configurable:!0}),Object.defineProperty(Jn.prototype,"hideCenterControl",{get:function(){return this._hideCenterControl},set:function(t){this._hideCenterControl=t},enumerable:!1,configurable:!0}),Object.defineProperty(Jn.prototype,"showCenterControl",{get:function(){return this._showCenterControl},set:function(t){this._showCenterControl=t},enumerable:!1,configurable:!0}),Object.defineProperty(Jn.prototype,"updateVisitorsNum",{get:function(){return this._updateVisitorsNum},set:function(t){this._updateVisitorsNum=t},enumerable:!1,configurable:!0}),Object.defineProperty(Jn.prototype,"pauseVideo",{get:function(){return this._pauseVideo},set:function(t){this._pauseVideo=t},enumerable:!1,configurable:!0}),Object.defineProperty(Jn.prototype,"reLoadVideo",{get:function(){return this._reLoadVideo},set:function(t){this._reLoadVideo=t},enumerable:!1,configurable:!0}),Object.defineProperty(Jn.prototype,"fullScreenVideo",{get:function(){return this._fullScreenVideo},set:function(t){this._fullScreenVideo=t},enumerable:!1,configurable:!0}),Object.defineProperty(Jn.prototype,"muteVideo",{get:function(){return this._muteVideo},set:function(t){this._muteVideo=t},enumerable:!1,configurable:!0}),Object.defineProperty(Jn.prototype,"restoreVoice",{get:function(){return this._restoreVoice},set:function(t){this._restoreVoice=t},enumerable:!1,configurable:!0}),Object.defineProperty(Jn.prototype,"seekTo",{get:function(){return this._seekTo},set:function(t){this._seekTo=t},enumerable:!1,configurable:!0}),Object.defineProperty(Jn.prototype,"load",{get:function(){return this._load},set:function(t){this._load=t},enumerable:!1,configurable:!0}),Object.defineProperty(Jn.prototype,"changeSource",{get:function(){return this._changeSource},set:function(t){this._changeSource=t},enumerable:!1,configurable:!0}),Jn);function Jn(){}var Zn=function(){this.hooks=new Yn,this.operation=new $n,(window.BlVideo=Wn).hooks=this.hooks,Wn.operation=this.operation},Qn=(Object.defineProperty(tr.prototype,"loadeddata",{get:function(){return this._loadeddata},set:function(t){this._loadeddata=t},enumerable:!1,configurable:!0}),Object.defineProperty(tr.prototype,"stalled",{get:function(){return this._stalled},set:function(t){this._stalled=t},enumerable:!1,configurable:!0}),Object.defineProperty(tr.prototype,"progress",{get:function(){return this._progress},set:function(t){this._progress=t},enumerable:!1,configurable:!0}),Object.defineProperty(tr.prototype,"timeupdate",{get:function(){return this._timeupdate},set:function(t){this._timeupdate=t},enumerable:!1,configurable:!0}),tr);function tr(){}var er=new Je;function ir(t,e,i){document.getElementById(t).parentElement.innerHTML='\n    <div class="main">\n        <div class="live-player" id="live-player">               \n            <video id="videojs" src="" controls >\n            </video>\n        </div>\n    </div>\n    ';var n=ir.getPlayer(t);ir.addoption(n),je.options_=Be(er,e),je.languages=Xn();new(je.getComponents("play"))(n,e,i)}je.options_=er,je.videoForegin=new Zn,je.videoEmit=new Qn,ir.getPlayer=function(t){var e,i,n=Gn.players;if("string"==typeof t){var r=0===(i=t).indexOf("#")?i.slice(1):i,o=n[t];if(o)return o;e=document.getElementById(r)}else e=t;if(Oe(e))return n[t]=e;je.sendError({message:"id为"+t+"的播放器不存在！"})},ir.addoption=function(t){je.options_.loop=t.loop||je.options_.loop,je.options_.autoplay=t.autoplay||je.options_.autoplay,je.options_.preload=t.preload||je.options_.preload,je.options_.poster=t.poster||je.options_.poster},je.videoForegin.operation.load=ir;var nr={streamLink:{mp4:"https://file.wbp5.com/upload/files/master/2020/03/17/211551574.mp4"},mode:2,poster:"https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=3893146502,314297687&fm=27&gp=0.jpg",loop:!0,iconfont:{play:"&#xE001;",pause:"&#xE002;",volume:"&#xE001;",volumeSilent:"&#xE001;",fullScreen:"&#xE001;",exitFullScreen:"&#xE001;"},fullScreenDom:document.getElementById("fullDom")};BlVideo.operation.load("videojs",nr),BlVideo.hooks.videoTimeupdate=function(){},BlVideo.hooks.videoPlay=function(){},BlVideo.hooks.videoPause=function(){}});
